<!-- Dependencies -->
<link rel="import" href="../../bower_components/polymer/polymer.html" />
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html" />

<!-- Styles -->
<link rel="import" href="../../css/px-hero-image-styles.html">

<dom-module id="px-hero-image">
  <template>
    <style include="px-hero-image-styles" is="custom-style"></style>

    <iron-media-query query='(min-width: 719px)' query-matches="{{largeScreen}}">
    </iron-media-query>
    <div class="hero-container">

      <div class="hero-slot">
        <slot name="content"></slot>
      </div>

      <template is="dom-if" if="{{largeScreen}}">
        <div class="hero-animation-slot">
          <slot name="animation"></slot>
        </div>
      </template>

      <template is="dom-if" if="{{!largeScreen}}">
        <template is="dom-if" if="{{!dark}}">

          <picture class="hero-image--background">
            <source srcset="../img/mobile_hero_bkd_light.webp" type="image/webp">
            <source srcset="../img/mobile_hero_bkd_light.png" type="image/png">
            <img src="../img/mobile_hero_bkd_light.png" alt="hero-background-image" style="width:100%; height: 100%">
          </picture>
          <picture class="hero-image--foreground">
            <source srcset="../img/mobile_hero_light.webp" type="image/webp">
            <source srcset="../img/mobile_hero_light.png" type="image/png">
            <img src="../img/mobile_hero_light.png" alt="hero-image">
          </picture>

        </template>

        <template is="dom-if" if="{{dark}}">

          <picture class="hero-image--background">
            <source srcset="../img/mobile_hero_bkd_dark.webp" type="image/webp">
            <source srcset="../img/mobile_hero_bkd_dark.png" type="image/png">
            <img src="../img/mobile_hero_bkd_dark.png" alt="hero-background-image" style="width:100%; height: 100%">
          </picture>
          <picture class="hero-image--foreground">
            <source srcset="../img/mobile_hero_dark.webp" type="image/webp">
            <source srcset="../img/mobile_hero_dark.png" type="image/png">
            <img src="../img/mobile_hero_dark.png" alt="hero-image">
          </picture>

        </template>
      </template>

    </div>

  </template>
  <script>
    Polymer({
      is: 'px-hero-image',

      properties: {
        dark:{
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        largeScreen: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },

      },

      observers: [
        '_tryLoadAnimation(largeScreen, dark)'
      ],

      created: function() {
        this.animationLoaded = false;
      },

      _tryLoadAnimation: function(isLargeScreen, isDark){
        if (!this.animationLoaded && isLargeScreen) {
          this.animationLoaded = true;

          if(isDark) {
            var entrypointId = 'heroimagedark_hype_container'
            var loadAnimationSrc = 'hero-image-dark.hyperesources/heroimagedark_hype_generated_script.js?70708'
          }
          else {
            var entrypointId = 'heroimagelight_hype_container'
            var loadAnimationSrc = 'hero-image-light.hyperesources/heroimagelight_hype_generated_script.js?70708'
          }

          // Create animation container and append to the light DOM so
          // the Hype script can find it in the document
          var animationContainer = document.createElement('div');
          animationContainer.id = 'animationContainer';
          animationContainer.className = 'hero-image--desktop';
          animationContainer.setAttribute('slot', 'animation');
          var animationEntrypoint = document.createElement('div');
          animationEntrypoint.id = entrypointId;
          animationEntrypoint.className = 'hero-animation';
          Polymer.dom(this).appendChild(animationContainer);
          Polymer.dom(animationContainer).appendChild(animationEntrypoint);

          // Create and append the Hype script
          var loadAnimation = document.createElement('script');
          loadAnimation.setAttribute('type', 'text/javascript');
          loadAnimation.setAttribute('charset', 'utf-8');
          loadAnimation.setAttribute('src', loadAnimationSrc);
          document.head.appendChild(loadAnimation);
        }
      }

    })
  </script>
</dom-module>
