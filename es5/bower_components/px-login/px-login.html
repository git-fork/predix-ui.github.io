<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="css/px-login-styles.html"><link rel="import" href="../promise-polyfill/promise-polyfill-lite.html"><link rel="import" href="../px-popover/px-popover.html"><link rel="import" href="../iron-ajax/iron-ajax.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"></head><body><dom-module id="px-login"><template><style include="px-login-styles"></style><iron-ajax id="userInfoAjax" url="{{userInfoUrl}}" handle-as="json" method="GET"></iron-ajax><div><div hidden$="{{!_showLogin}}"><button class="btn btn--bare login-button" id="loginButton"><px-icon icon="px-nav:generic-user" class="login-button--user-icon text--center"></px-icon><template is="dom-if" if="[[!collapsed]]">[[localize("Sign In")]]</template></button></div><div hidden$="{{_showLogin}}"><px-popover id="userPopover" orientation="[[popoverLocation]]" enhanced="true" for="userNameButton" hide-overlay="true"><ul class="list-bare"><template is="dom-repeat" items="{{menuItems}}"><li class="login-menu--item truncate"><a class="actionable actionable--action" href$="{{item.url}}" title="{{item.label}}">{{item.label}}</a></li></template><li id="logoutButton"><a href="#" class="actionable actionable--action">[[localize("Sign Out")]]</a></li></ul></px-popover><button id="userNameButton" name="userNameButton" class="btn btn--bare login-button"><template is="dom-if" if="[[!customUserIcon]]"><px-icon icon="px-nav:generic-user" class="login-button--user-icon text--center"></px-icon></template><template is="dom-if" if="[[customUserIcon]]"><div class="custom-icon"><slot name="custom-icon"></slot></div></template><template is="dom-if" if="[[!collapsed]]"><div class="truncate" title="{{userName}}">{{userName}}</div><px-icon icon="px-utl:chevron" class="login-button--chevron-icon"></px-icon></template></button></div></div></template></dom-module><script>Polymer({is:'px-login',behaviors:[Polymer.AppLocalizeBehavior],properties:{loginUrl:{type:String,value:'/login'},userInfoUrl:{type:String,value:'/userinfo'},logoutUrl:{type:String,value:'/logout'},userName:{type:String},userInfo:{type:Object,notify:!0},userNameKey:{type:String,value:'user_name'},doNotFetchUserInfoOnLoad:{type:Boolean,value:!1},popoverLocation:{type:String,value:'bottom'},language:{type:String,value:'en'},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function(){return{en:{"Sign In":'Sign In',"Sign Out":'Sign Out'}}}},menuItems:{type:Array},_showLogin:{type:Boolean,value:!0,computed:'_computeShowLogin(userName)'},customUserIcon:{type:Boolean,value:!1},collapsed:{type:Boolean,value:!1,observer:'_hidePopover'}},loginClicked:function(){window.location=Polymer.dom(this).getOwnerRoot().host.loginUrl},logoutClicked:function(a){a.preventDefault();var b=Polymer.dom(this).getOwnerRoot().host;b.userName=null,b.userInfo=null,window.location=b.logoutUrl},_computeShowLogin:function(a){return!a||1>a.length},_fetchUserInfo:function(a){this.$.userInfoAjax.url=a,a&&!this.doNotFetchUserInfoOnLoad&&this.$.userInfoAjax.generateRequest()},_hidePopover:function(a){a&&this.$.userPopover.hide()},ready:function(){var a=this;this.$.loginButton.addEventListener('click',this.loginClicked),this.$.logoutButton.addEventListener('click',this.logoutClicked),this.$.userNameButton.addEventListener('click',function(){setTimeout(function(){a.$.userPopover.show()},10)}),this.$.userInfoAjax.addEventListener('response',function(b){b.detail.response&&(a.userInfo=b.detail.response,a.userName=b.detail.response[a.userNameKey],this.fire('px-login-response-received',b.detail.response))}),this.$.userInfoAjax.addEventListener('error',function(a){this.fire('px-login-error-received',a.detail.error),console.log(a.detail.error)}),this._fetchUserInfo(this.userInfoUrl)}});</script></body></html>