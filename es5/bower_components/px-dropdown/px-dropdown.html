<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../iron-dropdown/iron-dropdown.html"><link rel="import" href="../iron-selector/iron-selector.html"><link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html"><link rel="import" href="../iron-media-query/iron-media-query.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="css/px-dropdown-styles.html"></head><body><dom-module id="px-dropdown"><template><style include="px-dropdown-styles"></style><iron-media-query query$="(max-width: {{mobileAt}}px)" query-matches="{{mobile}}"></iron-media-query><iron-a11y-keys id="keys" keys="up down space enter tab esc" target="[[_keyBindingsTarget]]" on-keys-pressed="_handleKeyPress"></iron-a11y-keys><div on-tap="toggle" class="trigger"><slot name="trigger"><div id="trigger" class$="dropdown-trigger btn {{_getDisabledClass(disabled)}} {{_getClass(buttonStyle)}}" tabindex="0"><template is="dom-if" if="{{!_isEqual(buttonStyle,'icon')}}"><div id="label" title="{{_displayValueSelected}}" class="dropdown-label">{{_displayValueSelected}}</div></template><template is="dom-if" if="{{_isEqual(buttonStyle,'icon')}}"><px-icon class="custom-icon" icon="{{icon}}"></px-icon></template><template is="dom-if" if="{{_showClearButton(disableClear,buttonStyle,opened,selected,selectedValues,selectedValues.*)}}"><px-icon class="dropdown-icon" icon="px-nav:close" on-tap="_clear"></px-icon></template><template is="dom-if" if="{{_showChevron(disableClear,hideChevron,buttonStyle,opened,selected,selectedValues,selectedValues.*)}}"><px-icon class="dropdown-icon" icon="px-utl:chevron"></px-icon></template></div></slot></div><iron-dropdown id="dropdown" class$="dropdown {{_getCaretClass(showCaret,mobile,verticalAlign,horizontalAlign)}}" auto-fit-on-attach="" fit-into="{{_getFitElement(boundTarget)}}" position-target="{{_getPositionElement(mobile)}}" dynamic-align="{{!disableDynamicAlign}}" vertical-offset="{{_getOffset(showCaret,triggerHeight,mobile)}}" vertical-align="{{_getVertical(verticalAlign,mobile)}}" horizontal-align="{{_getHorizontal(horizontalAlign,mobile)}}" opened="{{opened}}" hover="{{hover}}" no-cancel-on-outside-click="{{preventCloseOnOutsideClick}}" allow-outside-scroll="{{allowOutsideScroll}}" disabled$="{{disabled}}" with-backdrop="{{mobile}}"><div slot="dropdown-content" class="dropdown-content shadow-temporary"><slot name="header"></slot><template is="dom-if" if="{{searchMode}}" value="{{searchTerm::input}}"><div class="u-p- fixed"><div class="search__form"><input id="searchbox" class="text-input search__box" disabled$="[[disabled]]" placeholder="{{placeholder}}" value="{{searchTerm::input}}" on-input="_notifyResize" autocomplete="off"><px-icon class="search__icon" icon="px-utl:search"></px-icon></div></div></template><iron-selector id="selector" class="selector" multi="{{multi}}" selected="{{selected}}" selected-values="{{selectedValues}}" selected-items="{{selectedItems}}" attr-for-selected="{{selectBy}}"><template is="dom-repeat" id="dropdownItems" items="{{_computedItems}}" strip-whitespace=""><div class="dropdown-option" key="{{item.key}}" val="{{item.val}}" disabled$="{{item.disabled}}" disable-select="{{item.disableSelect}}" on-mouseover="_hoverOn" on-mouseout="_hoverOff" title="{{item.val}}"><template is="dom-if" if="{{_showCheckmark(multi,mobile)}}"><px-icon icon="px-utl:check" class="select-icon u-pr--"></px-icon></template><template is="dom-if" if="{{item.icon}}"><px-icon icon="{{item.icon}}" class="item-icon u-mr-" style$="color:{{item.color}};stroke:{{item.color}}"></px-icon></template><span class="dropdown-option__item truncate">{{item.val}}</span></div></template></iron-selector><template is="dom-if" if="{{_showButtons(mobile,hideMobileButtons)}}"><div class="flex flex--middle flex--right u-m- fixed"><template is="dom-if" if="{{!disableClear}}"><button class$="btn {{_showMobileClearButton(mobile,disableClear,selected,selectedValues,selectedValues.*)}}" on-tap="_clear">[[localize('Clear')]]</button></template><template is="dom-if" if="{{multi}}"><button class="btn btn--primary u-ml-" on-tap="toggle">[[localize('Apply')]]</button></template></div></template><slot name="footer"></slot></div></iron-dropdown></template></dom-module><script>Polymer({is:'px-dropdown',behaviors:[Polymer.AppLocalizeBehavior],properties:{opened:{type:Boolean,notify:!0,value:!1},hover:{type:Boolean,notify:!0,value:!1},focusedItem:{observer:'_focusedItemChanged',readOnly:!0,type:Object},hideChevron:{type:Boolean,value:!1},boundTarget:{type:String},preventCloseOnOutsideClick:{type:Boolean,value:!1},displayValue:{type:String,notify:!0,value:'Select',observer:'_displayValueChanged'},disableClear:{type:Boolean,value:!1},disableSelect:{type:Boolean,value:!1},_displayValueSelected:{type:String},items:{type:Array,notify:!0,value:function(){return[]}},_computedItems:{type:Array,value:function(){return[]}},multi:{type:Boolean,value:!1},selectBy:{type:String,value:'key',observer:'_updateSelection'},selected:{type:String,value:null,notify:!0},selectedValues:{type:Array,value:function(){return[]},notify:!0},selectedItems:{type:Array,value:function(){return[]},readOnly:!0},allowOutsideScroll:{type:Boolean,value:!1},buttonStyle:{type:String,value:'default'},disabled:{type:Boolean,value:!1},searchMode:{type:Boolean,value:!1},searchTerm:{type:String,value:'',observer:'_computeFilter'},sortMode:{type:String},hideSelected:{type:Boolean,value:!1},icon:{type:String,value:''},clearSelectionsOnChange:{type:Boolean,value:!1},triggerHeight:{type:Number,value:30},showCaret:{type:Boolean,value:!1},disableDynamicAlign:{type:Boolean,value:!1},verticalAlign:{type:String,value:'top'},horizontalAlign:{type:String,value:'left',observer:'_changeHorizontal'},mobile:{type:Boolean,reflectToAttribute:!0},mobileAt:{type:Number,value:400},hideMobileButtons:{type:Boolean,value:!1},language:{type:String,value:'en'},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function(){return{en:{selected:'selected',Clear:'Clear',Apply:'Apply'}}}},_keyBindingsTarget:{type:Object,value:function(){return this}},_focusedOption:{type:HTMLElement},_keyboardBeingUsed:{type:Boolean,value:!1}},listeners:{"iron-activate":'_handleActivate',"iron-select":'_handleSelection',"iron-deselect":'_handleDeselection'},observers:['_initSort(sortMode, _computedItems)','_itemsChanged(items, items.*)'],toggle:function(){this.$.dropdown.toggle(),this.$.dropdown.style.minWidth=window.getComputedStyle(this.$.trigger).width},_clear:function(a){a.stopPropagation(),this.set('selected',null),this.set('selectedValues',[]),this.multi&&Polymer.dom(this.$.dropdown).querySelectorAll('input#option:checked').forEach(function(a){a.checked=!1}),this.mobile||this.$.dropdown.close()},attached:function(){this.$.dropdown.style.minWidth=window.getComputedStyle(this.$.trigger).width,this._updateSelection()},_isEqual:function(c,a){return c===a},_getDisabledClass:function(){return this.disabled?'btn--disabled':''},_getClass:function(){return'bare'===this.buttonStyle?'btn--bare u-ph0':'bare--primary'===this.buttonStyle?'btn--bare--primary u-ph0':'tertiary'===this.buttonStyle?'btn--tertiary':'icon'===this.buttonStyle?'btn--bare btn--icon':''},_getFitElement:function(a){return Polymer.dom(document).querySelector(a)},_getPositionElement:function(a){return a?window:this},_displayValueChanged:function(){this._displayValueSelected=this.displayValue},_itemsChanged:function(a){if(void 0!==a){var b=[];null!==a&&a.forEach(function(a,c){b[c]='string'===typeof a?{key:c,val:a}:a}.bind(this)),this._computedItems=b,this.clearSelectionsOnChange&&(this.set('selected',null),this.set('selectedValues',[])),this._updateSelection(),this._notifyResize()}},_updateSelection:function(){if(this.items&&0<this.items.length)if(this.multi){var a,b=this.items.length,c=this.selectedValues;for(a=0;a<b;a++)void 0!==this.items[a].selected&&'true'===this.items[a].selected.toString()&&c&&-1===c.indexOf(this.items[a][this.selectBy])&&c.push(this.items[a][this.selectBy]);this.set('selectedValues',[]),this.set('selectedValues',c)}else{var a,b=this.items.length,c=this.selected;for(a=0;a<b;a++)if(void 0!==this.items[a].selected&&'true'===this.items[a].selected.toString()&&c!==this.items[a][this.selectBy]){this.set('selected',this.items[a][this.selectBy]);break}}},_handleActivate:function(a){a.detail.item.hasAttribute('disabled')?a.preventDefault():this.disableSelect||a.detail.item.disableSelect?(a.preventDefault(),this.fire('px-dropdown-click',a),this.$.dropdown.close()):this.fire('px-dropdown-click',a)},_handleSelection:function(a){this.multi&&1===this.selectedValues.length&&!this.hideSelected?this._displayValueSelected=this.$.selector.selectedItems[0].innerText.trim():this.multi&&1<this.selectedValues.length&&!this.hideSelected?this._displayValueSelected=this.selectedValues.length+' '+this.localize('selected'):!this.hideSelected&&(this._displayValueSelected=this.$.selector.selectedItem?this.$.selector.selectedItem.val:this.displayValue,this.$.dropdown.close()),this.$.dropdown.notifyResize(),this.fire('px-dropdown-selection-changed',{val:a.detail.item.val,key:a.detail.item.key,selected:!0})},_handleDeselection:function(a){this._displayValueSelected=this.multi&&1===this.$.selector.selectedItems.length&&!this.hideSelected?this.$.selector.selectedItems[0].innerText.trim():this.multi&&1<this.selectedValues.length&&!this.hideSelected?this.selectedValues.length+' '+this.localize('selected'):this.displayValue,this.$.dropdown.notifyResize(),this.fire('px-dropdown-selection-changed',{val:a.detail.item.val,key:a.detail.item.key,selected:!1})},_notifyResize:function(){this.$.dropdown.notifyResize()},_computeFilter:function(){if(this.searchMode){var a,b=this.searchTerm.toLowerCase(),c=this.$.dropdown.querySelectorAll('.dropdown-option'),d=c.length;for(a=0;a<d;a++)this.toggleClass('hidden',-1===c[a].val.toString().toLowerCase().indexOf(b)&&-1===c[a].key.toString().toLowerCase().indexOf(b),c[a])}},_showClearButton:function(a,b,c,d,e){return a||'icon'===b?!1:c&&('string'===typeof d||'number'===typeof d||0<e.length)},_showMobileClearButton:function(a,b,c,d){return a&&('string'===typeof c||'number'===typeof c||0<d.length)?'':'btn--disabled'},_showChevron:function(a,b,c,d,e,f){return b||'icon'===c?!1:!d||a||d&&!e&&0===f.length},_initSort:function(a,b){a!==void 0&&b!==void 0&&(this.$.dropdownItems.sort='_computeSort',this.$.dropdownItems.render())},_bindMouse:function(){this._keyboardBeingUsed=!1,this.removeEventListener('mousemove',this._bindMouse)},_computeSort:function(c,a){var b=0;if(!this.sortMode)return-1;if(this.sortMode&&0===b&&('key'===this.sortMode&&(b=c.key-a.key),'val'===this.sortMode)){var d=c.val.toUpperCase(),e=a.val.toUpperCase();d<e&&b--,d>e&&b++}return b},_setFocusedOption:function(a,b){this._focusedOption=a,a&&this.toggleClass('focused',!0,a),b&&this.toggleClass('focused',!1,b)},_handleKeyPress:function(a){this._keyboardBeingUsed=!0,this.addEventListener('mousemove',this._bindMouse.bind(this));var b=a.detail.combo,c=this.$.selector.getEffectiveChildren().filter(function(a){return a.nodeType===Node.ELEMENT_NODE&&'DIV'===a.nodeName&&!a.hasAttribute('disabled')&&!a.classList.contains('hidden')}),d=c.indexOf(this._focusedOption),e=this.searchMode&&Polymer.dom(this.$.dropdown).querySelector(':focus')===Polymer.dom(this.$.dropdown).querySelector('#searchbox');switch(b){case'space':case'enter':if(e)break;this.opened?-1!==d&&c[d].click():this.toggle(),a.detail.keyboardEvent.preventDefault();break;case'esc':this.$.trigger.focus(),this.$.dropdown.close();break;case'tab':this.opened&&this.$.dropdown.close();break;case'down':if(this.opened||this.toggle(),-1<d&&d<c.length-1)this._setFocusedOption(c[d+1],c[d]),this.$.dropdown.querySelector('.dropdown-content').scrollTop+=c[d+1].offsetHeight;else if(d===c.length-1)break;else-1===d&&this.searchMode&&!e?Polymer.dom(this.$.dropdown).querySelector('#searchbox').focus():e?(Polymer.dom(this.$.dropdown).querySelector('#searchbox').blur(),this.$.trigger.focus(),this._setFocusedOption(c[0])):this._setFocusedOption(c[0]);a.detail.keyboardEvent.preventDefault();break;case'up':this.opened||this.toggle(),0<d?(this._setFocusedOption(c[d-1],c[d]),Polymer.dom(this.$.dropdown).querySelector('.dropdown-content').scrollTop-=c[d].offsetHeight):0===d&&this.searchMode&&!e?(Polymer.dom(this.$.dropdown).querySelector('#searchbox').focus(),this._setFocusedOption(null,c[0])):-1===d&&!e&&this._setFocusedOption(c[c.length-1]),a.detail.keyboardEvent.preventDefault();}},_hoverOn:function(a){if(!this._keyboardBeingUsed&&!this.mobile){var b=this.querySelector('.dropdown-option.focused');b&&this.toggleClass('focused',!1,b),this.toggleClass('focused',!0,Polymer.dom(a).localTarget)}},_hoverOff:function(a){this.toggleClass('focused',!1,Polymer.dom(a).localTarget)},_getCaretClass:function(a,b,c,d){return a&&!b?c+' '+d:''},_getOffset:function(a,b,c){return c?0:a?b+5:b},_changeHorizontal:function(){this.style.flexDirection='right'===this.horizontalAlign?'row-reverse':'row'},_getVertical:function(a,b){return b?'middle':a},_getHorizontal:function(a,b){return b?'left':a},_showCheckmark:function(a,b){return a&&!b},_showButtons:function(a,b){return a&&!b}});</script></body></html>