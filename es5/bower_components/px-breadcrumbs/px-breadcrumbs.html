<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../px-dropdown/px-dropdown.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-graph.html"><link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-selectable.html"><link rel="import" href="css/px-breadcrumbs-styles.html"></head><body><dom-module id="px-breadcrumbs"><template><style include="px-breadcrumbs-styles"></style><div class="container flex"><ul class="topPath"><template is="dom-repeat" items="[[_mainPathItems]]"><template is="dom-if" if="[[_isNotFirstItemInData(index, _mainPathItems)]]"><li class="breadcrumbTopItem flex flex--middle"><span class$="rightAngle [[_getSeparatorSize(clickOnlyMode)]]"><px-icon icon="px-utl:chevron-right"></px-icon></span></li></template><li data-text="[[_getItemProp(item, keys.label)]]" data-item="[[item]]" data-index="[[index]]" class$="breadcrumbTopItem u-ph- flex flex--row flex--middle [[_getDisabled(item)]]" on-tap="_onPathTap"><template is="dom-if" if="[[_isLabel(item, clickOnlyMode)]]"><span class="actionable actionable--action">[[_getItemProp(item, keys.label)]]</span></template><template is="dom-if" if="[[_isDropdown(item, clickOnlyMode)]]"><px-dropdown display-value="[[_getItemProp(item, keys.label)]]" items="[[_clickedItemChildren]]" search-mode="[[searchMode]]" button-style="bare" disable-clear=""></px-dropdown></template><template is="dom-if" if="[[_isOverflow(item)]]"><px-dropdown id="dropdown" items="[[_clickedItemChildren]]" button-style="icon" icon="px-nav:more"></px-dropdown></template></li></template></ul></div></template></dom-module><script>(function(){var a=function(){function a(b,c,d){var e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],f=arguments[4];return babelHelpers.classCallCheck(this,a),this.keys=f,this.breadcrumbEl=b,this.graph=c,this.clickOnlyMode=d,this.breadcrumbs=e,this.map=new WeakMap,this.ctx=this._createCanvas(b),this._preShortenItems(this.breadcrumbs),this}return babelHelpers.createClass(a,[{key:'_addToWeakMap',value:function(a){var b=this.map.get(a)||null;b||this.map.set(a,a)}},{key:'_preShortenItems',value:function(a){var b,c=!0,d=!1;try{for(var e,f,g=a[Symbol.iterator]();!(c=(e=g.next()).done);c=!0)f=e.value,this._getShortenedText(f)}catch(a){d=!0,b=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw b}}}},{key:'_getShortenedText',value:function(a){var b=this.map.get(a)||{},c=this._getItemProp(a,this.keys.label);return!b.shortText&&13<c.length?b.shortText=c.substr(0,6)+'...'+c.substr(c.length-6):!b.shortText&&(b.shortText=c),this.map.set(a,b),b.shortText}},{key:'_sizeOfIndividualFullItem',value:function(a){var b=this.map.get(a)||{},c=this._getItemProp(a,this.keys.label);return b.fullSize=b.fullSize||parseInt(this.ctx.measureText(c).width,10),this.map.set(a,b),b.fullSize}},{key:'_sizeOfIndividualShortItem',value:function(a){var b=this.map.get(a)||{};return b.shortSize=b.shortSize||parseInt(this.ctx.measureText(b.shortText).width,10),this.map.set(a,b),b.shortSize}},{key:'_calculateSizeOfBreadcrumbs',value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0;if(a){var c,d=0,e=0,f=a.length;for(e=0;e<f;e++,c=null){c=b?this._sizeOfIndividualFullItem(a[e]):this._sizeOfIndividualShortItem(a[e]);var g=a[e].source?a[e].source:a[e];d+=c,'...'!==this._getItemProp(a[e],this.keys.label)&&this.graph.hasSiblings(g)&&!this.clickOnlyMode&&(d+=21),d+=20,e!==f-1&&(d+=this.clickOnlyMode?30:15)}return d+10}}},{key:'_createCanvas',value:function(a){var b=window.getComputedStyle(a,null),c=b.getPropertyValue('font-size'),d=b.getPropertyValue('font-family'),e=document.createElement('canvas');e.height=20,e.width=9999;var f=e.getContext('2d');return f.font=c+' '+d,f}},{key:'_getItemProp',value:function(a,b){return a&&'object'===('undefined'===typeof a?'undefined':babelHelpers.typeof(a))&&'string'===typeof b&&a.hasOwnProperty(b)?a[b]:null}},{key:'sizeOfFullBreadcrumbs',get:function(){return this.__sizeOfFullBreadcrumbs=this.__sizeOfFullBreadcrumbs||this._calculateSizeOfBreadcrumbs(this.breadcrumbs),this.__sizeOfFullBreadcrumbs}},{key:'sizeOfAllShortenedItemsExcludingLastItem',get:function(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(0,this.breadcrumbs.length-1),!1)}},{key:'sizeOfFullLastItem',get:function(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1))}},{key:'sizeOfShortLastItem',get:function(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1),!1)}},{key:'lastItemFull',get:function(){return this.breadcrumbs.slice(-1)[0]}},{key:'lastItemShort',get:function(){return this.shortenedItems.slice(-1)[0]}},{key:'shortenedItems',get:function(){var a=this;return this.__shortenedItems=this.__shortenedItems||this.breadcrumbs.map(function(b){var c={source:b,isTruncated:!0},d=a.keys.label,e=a.keys.children;return c[d]=a._getShortenedText(b),c[e]=a._getItemProp(b,a.keys.children),c.selectedItem=b.selectedItem,c.hasChildren=b.hasChildren,c}),this.__shortenedItems}},{key:'sizeOfEllipsis',get:function(){return 36}},{key:'sizeOfAllShortenedItems',get:function(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs,!1)}},{key:'allShortenedItemsExcludingLast',get:function(){return this.shortenedItems.slice(0,this.shortenedItems.length-1)}}]),a}();window.pxBreadcrumbs={},window.pxBreadcrumbs.Breadcrumbs=a,Polymer({is:'px-breadcrumbs',behaviors:[PxAppBehavior.AssetGraph,PxAppBehavior.AssetSelectable,Polymer.IronResizableBehavior],properties:{_mainPathItems:{type:Array,value:function(){return[]},readOnly:!0},_clickPathItem:{type:Object,value:function(){return{}}},_clickedItemChildren:{type:Array,value:function(){return[]}},_selectedItem:{type:Object},_ulWidth:{type:Number,value:0},_selectedItemPath:{type:Array,value:function(){return[]},readOnly:!0},clickOnlyMode:{type:Boolean,value:!1,observer:'_getBreadcrumbsObj'},searchMode:{type:Boolean,value:!1},_hideNoResultLi:{type:Boolean,value:!0},_breadcrumbsObj:{type:Object}},listeners:{"iron-resize":'_onResize',"px-app-asset-selected":'_onSelect',"px-dropdown-selection-changed":'_dropdownTap',"px-app-asset-graph-created":'_getBreadcrumbsObj'},observers:['_getDisplayMode(_ulWidth, _selectedItemPath, _breadcrumbsObj)'],detached:function(){this.isDebouncerActive('windowResize')&&this.cancelDebouncer('windowResize')},_getItemProp:function(a,b){return a&&'object'===('undefined'===typeof a?'undefined':babelHelpers.typeof(a))&&'string'===typeof b&&a.hasOwnProperty(b)?a[b]:null},_onResize:function(){var a=this;this.debounce('windowResize',function(){window.requestAnimationFrame(function(){var b=Polymer.dom(a.root).querySelector('.container'),c=Polymer.dom(b).querySelector('ul'),d=c.getBoundingClientRect();a.set('_ulWidth',d.width)})},50)},_getBreadcrumbsObj:function(){var a=this._selectedItemPath||[],b=this._assetGraph,c=this.clickOnlyMode;a.length&&b&&(this.set('_breadcrumbsObj',new window.pxBreadcrumbs.Breadcrumbs(this,b,c,a,this.keys)),this.updateStyles())},_getDisplayMode:function(){var a=this._ulWidth,b=this._selectedItemPath||[],c=this._breadcrumbsObj;if(a&&b&&c){if(a>c.sizeOfFullBreadcrumbs)return void this._set_mainPathItems(b);if(a>c.sizeOfAllShortenedItemsExcludingLastItem+c.sizeOfFullLastItem){var d=c.allShortenedItemsExcludingLast.concat(c.lastItemFull);return void this._set_mainPathItems(d)}if(a>c.sizeOfAllShortenedItems){var e=c.shortenedItems;return void this._set_mainPathItems(e)}this._set_mainPathItems(this._createArrayWithOverflow(b,a,c))}},_createArrayWithOverflow:function(a,b,c){var d=0,e=c.sizeOfAllShortenedItemsExcludingLastItem,f=c.sizeOfFullLastItem,g=!1,h={},i=[],j=this.keys.label,k={};for(k.hasChildren=!0,k[j]='...';b<36+e+f;){if(d===a.length-1){g=!0;break}var l=c._sizeOfIndividualShortItem(a[d]);e-=l,d++}var m=this.keys.children;return k[m]=a.slice(0,d),k[m].forEach(function(a){a.highlighted=!1}),h=g?c.lastItemShort:c.lastItemFull,i=[k].concat(c.shortenedItems.slice(d,a.length-1)).concat(h),i},_isNotFirstItemInData:function(a){return 0!==a},_onSelect:function(a){this._set_selectedItemPath(a.detail.path),this._getBreadcrumbsObj()},_doesItemHaveSiblings:function(a){var b=this._assetGraph,c=a.source?a.source:a,d=!('...'!==this._getItemProp(a,this.keys.label));return!!d||b.hasSiblings(c)},_dropdownTap:function(a){var b=this;a=Polymer.dom(a);var c,d=a.rootTarget;d&&d.items&&(c=d.items.find(function(c){var d=b._getItemProp(c,b.keys.id);if(d===a.event.detail.key)return c})),this._changePathFromClick(c||{})},_changePathFromClick:function(a){this.select(a),this.fire('px-breadcrumbs-item-changed',a)},_onPathTap:function(a){var b=this,c=a.model.item.source?a.model.item.source:a.model.item,d=!('...'!==this._getItemProp(c,this.keys.label));if(!1!==c.isSelectable){if(this.clickOnlyMode&&!d)return void this._changePathFromClick(c);if(this._doesItemHaveSiblings(c)||d){var e=this._assetGraph,f=d?this._getItemProp(c,this.keys.children):e.getSiblings(c),g=f.map(function(a){return Object.assign({},a,{key:b._getItemProp(a,b.keys.id),val:b._getItemProp(a,b.keys.label),disabled:!1===a.isSelectable})});this.set('_clickedItemChildren',g),this.set('_clickPathItem',c)}else this.set('_clickedItemChildren',[]),this._changePathFromClick(c)}},_isLabel:function(a,b){return b&&'...'!==this._getItemProp(a,this.keys.label)||!b&&!this._doesItemHaveSiblings(a)},_isDropdown:function(a,b){return!b&&'...'!==this._getItemProp(a,this.keys.label)&&this._doesItemHaveSiblings(a)},_isOverflow:function(a){return'...'===this._getItemProp(a,this.keys.label)},_getSeparatorSize:function(){return this.clickOnlyMode?'small':'large'},_getDisabled:function(a){return!1===a.isSelectable?'disabled':''}})})();</script></body></html>