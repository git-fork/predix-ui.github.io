<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="css/px-file-upload-styles.html"></head><body><dom-module id="px-file-upload"><template><style include="px-file-upload-styles"></style><div id="file-upload-dropZone" class="file-upload-dropZone fieldset u-p-"><div id="dndInstructions" class$="{{_showHideDragAndDrop(_isAdvancedUpload, disabled)}} u-pb+"><px-icon class="file-upload-icon u-mr--" icon="px-utl:upload"></px-icon>[[localize(message)]]</div><template is="dom-if" if="{{multiple}}"><div class="hidden file-upload-fileTable" id="fileTable"><div class="file-upload-tr label"><div class="file-upload-th">{{localize('Name')}}</div><div class="file-upload-th">{{localize('Size')}}</div><div class="file-upload-th">{{localize('Type')}}</div><div class="file-upload-th"></div></div><template is="dom-repeat" items="{{files}}"><div class="file-upload-tr"><div class="file-upload-td">{{item.name}}</div><div class="file-upload-td">{{_readableFileSize(item.size)}}</div><div class="file-upload-td">{{item.type}}</div><div class="file-upload-td"><px-icon id="icon{{index}}" icon="px-nav:close" class="file-upload-icon actionable actionable--secondary" on-tap="_removeFile"></px-icon></div></div></template></div></template><label id="fileButton" class$="{{_disableUploadButton(disabled)}} btn u-mr--">{{localize('Choose File')}} <input id="fileInput" name="{{name}}" disabled$="{{disabled}}" type="file" on-change="_fileChange" multiple="{{multiple}}" accept="{{accept}}" hidden=""></label><span id="fileList" class="file-upload-fileList">{{localize('No file selected')}}</span><px-icon id="fileClear" icon="px-nav:close" class="hidden file-upload-icon actionable actionable--secondary" on-tap="clear"></px-icon><span id="validation" class="file-upload-validation hidden"></span></div></template></dom-module><script>Polymer({is:"px-file-upload",behaviors:[Polymer.AppLocalizeBehavior],properties:{message:{type:String,value:"Drag and drop files here, or click the button below."},accept:{type:String,value:""},name:{type:String,value:""},multiple:{type:Boolean,value:!1},files:{type:Array,value:function(){return[]}},disabled:{type:Boolean,value:!1,observer:"_disable"},_isAdvancedUpload:{type:Boolean,value:function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&"FormData"in window&&"FileReader"in window}},language:{type:String,value:"en"},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function(){return{en:{"Drag and drop files here, or click the button below.":"Drag and drop files here, or click the button below.","Only one file is allowed.":"Only one file is allowed.","Invalid file type.":"Invalid file type.","No file selected":"No file selected","Choose File":"Choose File",Name:"Name",Size:"Size",Type:"Type"}}}}},ready:function(){if(this._isAdvancedUpload&&!this.disabled){var a=this.$.dropZone;this.ondragover=function(b){b.preventDefault(),b.stopPropagation(),this.toggleClass("hover",!0,a)},this.ondragleave=function(b){b.preventDefault(),b.stopPropagation(),this.toggleClass("hover",!1,a)},this.ondrop=function(b){b.preventDefault(),b.stopPropagation(),this.toggleClass("hover",!1,a),this.$.fileInput.files=b.dataTransfer.files}}},_toArray:function(a){return Object.keys(a).reduce(function(b,c){return isNaN(c)||b.push(a[c]),b},[])},_fileChange:function(a){if(this.files=this._toArray(a.target.files),!this.multiple){if(1<a.target.files.length)return this.$$("#validation").innerHTML=this.localize("Only one file is allowed."),this.toggleClass("hidden",!1,this.$$("#validation")),this.toggleClass("hidden",!0,this.$$("#fileList")),this.$.fileInput.value="",this.files=[],void this._notifyFilesChanged();if(""!==this.accept&&!this._isValid(a.target.files[0]))return this.$$("#validation").innerHTML=this.localize("Invalid file type."),this.toggleClass("hidden",!1,this.$$("#validation")),this.toggleClass("hidden",!0,this.$$("#fileList")),this.$.fileInput.value="",this.files=[],void this._notifyFilesChanged()}else if(""!==this.accept)for(i=0;i<a.target.files.length;i++){var b=a.target.files[i];if(!this._isValid(b))return this.$$("#validation").innerHTML=this.localize("Invalid file type."),this.toggleClass("hidden",!1,this.$$("#validation")),this.toggleClass("hidden",!0,this.$$("#fileList")),this.toggleClass("hidden",!0,this.$$("#fileTable")),this.$.fileInput.value="",this.files=[],void this._notifyFilesChanged()}if(this.$$("#validation").innerHTML="",this.toggleClass("hidden",!0,this.$$("#validation")),0===this.files.length)this.$$("#fileList").innerHTML=this.localize("No file selected"),this.multiple&&this.toggleClass("hidden",!0,this.$$("#fileTable")),this.toggleClass("hidden",!1,this.$$("#fileList"));else if(!this.multiple){var c=this._readableFileSize(this.files[0].size);this.$$("#fileList").innerHTML=this.files[0].name+" ("+c+")",this.toggleClass("hidden",!1,this.$$("#fileList")),this.toggleClass("hidden",!1,this.$$("#fileClear"))}else this.toggleClass("hidden",!1,this.$$("#fileTable")),this.toggleClass("hidden",!0,this.$$("#fileList")),this.toggleClass("hidden",!0,this.$$("#fileClear"));this.toggleClass("hidden",!0,this.$$("#validation")),this._notifyFilesChanged()},_removeFile:function(a){this.disabled||(this.splice("files",a.target.id.substring(4),1),this.multiple&&0===this.files.length&&(this.toggleClass("hidden",!0,this.$$("#fileTable")),this.toggleClass("hidden",!1,this.$$("#fileList"))),this.$.fileInput.value="",this._notifyFilesChanged())},clear:function(){this.set("files",[]),this.$.fileInput.value="",this.$$("#fileList").innerHTML=this.localize("No file selected"),this.toggleClass("hidden",!0,this.$$("#fileClear")),this.multiple&&(this.toggleClass("hidden",!0,this.$$("#fileTable")),this.toggleClass("hidden",!1,this.$$("#fileList"))),this._notifyFilesChanged()},_disable:function(){if(this.disabled!==void 0&&this.multiple)for(i=0;i<this.files.length;i++)this.toggleClass("hidden",this.disabled,this.$$("#icon"+i))},_disableUploadButton:function(a){return a?"btn--disabled":""},_disableFileUpload:function(a){return a?"disabled":""},_showHideDragAndDrop:function(a,b){return a&&!b?"":"hidden"},_isValid:function(a){this.accept;return a.type&&-1<this.accept.indexOf(a.type)||!!(-1<this.accept.indexOf(a.name.match(/\.[^\.]*$/)[0]))},_readableFileSize:function(a){var b=-1;do a/=1024,b++;while(1024<a);return Math.max(a,0.1).toFixed(1)+[" KB"," MB"," GB"][b]},_notifyFilesChanged:function(){this.fire("px-file-upload-files-changed")}});</script></body></html>