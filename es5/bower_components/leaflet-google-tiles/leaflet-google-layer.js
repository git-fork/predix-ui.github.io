(function b(c,d,e){function a(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof require&&require;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var f=d[h]={exports:{}};c[h][0].call(f.exports,function(b){var d=c[h][1][b];return a(d?d:b)},f,f.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof require&&require,f=0;f<e.length;f++)a(e[f]);return a})({1:[function(a,b){(function(a){var c="undefined"===typeof window?"undefined"===typeof a?null:a.L:window.L,d=["roadmap","satellite"];c.TileLayer.Google=c.TileLayer.extend({options:{GoogleTileAPIKey:null,mapType:"roadmap",language:"en-GB",region:"gb",mapStyle:[]},statics:{TILE_REQUEST:"https://www.googleapis.com/tile/v1/tiles/{z}/{x}/{y}?session={sessionToken}&orientation=0&key={GoogleTileAPIKey}",ATTRIBUTION_URL:"https://www.googleapis.com/tile/v1/viewport?session={sessionToken}&zoom={zoom}&north={north}&south={south}&east={east}&west={west}&key={GoogleTileAPIKey}",SESSION_TOKEN_URL:"https://www.googleapis.com/tile/v1/createSession?key={GoogleTileAPIKey}"},_getSessionToken:function(){var a=this;return this._exponentialBackoff||(this._exponentialBackoff=1e3),this._promise||(this._promise=new Promise(function(b,d){var e=c.Util.template(c.TileLayer.Google.SESSION_TOKEN_URL,{GoogleTileAPIKey:a.options.GoogleTileAPIKey}),f=JSON.stringify({mapType:a.options.mapType,language:a.options.language,region:a.options.region,overlay:!0,scale:"scaleFactor1x",styles:a.options.mapStyle}),g=new XMLHttpRequest;g.open("POST",e,!0),g.setRequestHeader("Content-type","application/json"),g.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){a._exponentialBackoff=null;var c=JSON.parse(g.responseText);a._sessionToken=c.session,b(c)}else setTimeout(function(){a._promise=null,a._exponentialBackoff*=2,a._getSessionToken()},a._exponentialBackoff),d("Session request failed, trying again in "+a._exponentialBackoff/1e3+"seconds")},g.send(f)})),this._promise},_refreshToken:function(){var a=this;this._getSessionToken().then(function(b){setTimeout(function(){a._needToRefreshToken&&(a._promise=null,a._refreshToken())},1e3*b.expiry-new Date().getTime()-3.6e6)}).catch(function(a){console.error("refreshToken",a)})},initialize:function(a){if(!a||!a.GoogleTileAPIKey)throw new Error("Must supply options.GoogleTileAPIKey");if(a=c.setOptions(this,a),0>d.indexOf(a.mapType))throw new Error("'"+a.mapType+"' is an invalid mapType");this._sessionToken=null,this._needToRefreshToken=!1,this._promise=null,c.Browser.android||this.on("tileunload",this._onTileRemove)},createTile:function(a,b){var d=document.createElement("img");return c.DomEvent.on(d,"load",c.bind(this._tileOnLoad,this,b,d)),c.DomEvent.on(d,"error",c.bind(this._tileOnError,this,b,d)),this.options.crossOrigin&&(d.crossOrigin=""),d.alt="",this._getSessionToken().then(function(){d.src=this.getTileUrl(a),b(null,d)}.bind(this)).catch(function(a){console.error(a),b(a)}),d},getAttribution:function(){return this.attribution},getTileUrl:function(a){return c.Util.template(c.TileLayer.Google.TILE_REQUEST,{z:a.z,x:a.x,y:a.y,sessionToken:this._sessionToken,GoogleTileAPIKey:this.options.GoogleTileAPIKey})},onAdd:function(a){a.on("moveend",this._updateAttribution,this),c.TileLayer.prototype.onAdd.call(this,a),this._needToRefreshToken=!0,this._refreshToken(),this._updateAttribution()},onRemove:function(a){a.off("moveend",this._updateAttribution,this),this._needToRefreshToken=!1,this._promise=null,a.attributionControl.removeAttribution(this.attribution),this.attribution=null,c.TileLayer.prototype.onRemove.call(this,a)},setKey:function(a){a&&this.options.GoogleTileAPIKey!==a&&(this.options.GoogleTileAPIKey=a,this._getSessionToken().then(function(){this.redraw()}.bind(this)))},setLanguage:function(a){a&&this.options.language!==a&&(this.options.language=a,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},setMapType:function(a){if(!a||-1===d.indexOf(a))throw new Error("'"+a+"' is an invalid mapType");this.options.mapType!==a&&(this.options.mapType=a,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},setMapStyle:function(a){a&&this.options.mapStyle!==a&&(this.options.mapStyle=a,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},setRegion:function(a){a&&this.options.region!==a&&(this.options.region=a,this._promise=null,this._getSessionToken().then(function(){this.redraw(),this._updateAttribution()}.bind(this)))},_getAttributionUrl:function(){var a=this._map,b=a.getZoom(),d=a.getBounds().toBBoxString().split(",");return c.Util.template(c.TileLayer.Google.ATTRIBUTION_URL,{GoogleTileAPIKey:this.options.GoogleTileAPIKey,sessionToken:this._sessionToken,zoom:b,south:d[0],east:d[1],north:d[2],west:d[3]})},_makeGetRequest:function(a,b){a.open("GET",b,!0),a.send()},_updateAttribution:function(a){var b=this._map,c=this;b&&b.attributionControl&&this._getSessionToken().then(function(){var d=c._getAttributionUrl();c._exponentialTimeout=1e3;var e=new XMLHttpRequest;e.onreadystatechange=function(){4===this.readyState&&200===this.status?(b.attributionControl.removeAttribution(c.attribution),c.attribution=JSON.parse(this.responseText).copyright,b.attributionControl.addAttribution(c.attribution),a&&!a.target&&a(null,c.attribution)):4===this.readyState&&(console.error("Attribution request unsuccessful, retrying in "+c._exponentialTimeout/1e3+" seconds"),setTimeout(function(){c._exponentialTimeout*=2,c._makeGetRequest(e,d)},c._exponentialTimeout))},c._makeGetRequest(e,d)}.bind(this)).catch(function(b){a&&!a.target&&a(b),console.error("updateAttribution",b)})}}),c.tileLayer.google=function(a){return new c.TileLayer.Google(a)},b.exports=c.TileLayer.Google}).call(this,"undefined"===typeof global?"undefined"===typeof self?"undefined"===typeof window?{}:window:self:global)},{}]},{},[1]);