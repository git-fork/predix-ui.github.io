<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-datetime-common/px-datetime-entry.html"><link rel="import" href="../px-datetime-common/px-datetime-behavior.html"><link rel="import" href="../px-datetime-common/px-datetime-validate.html"><link rel="import" href="../px-datetime-common/px-datetime-buttons.html"><link rel="import" href="../px-datetime-common/px-datetime-button-behavior.html"><link rel="import" href="css/px-datetime-field-styles.html"></head><body><dom-module id="px-datetime-field"><template><style include="px-datetime-field-styles"></style><div class$="{{_getWrapClass(allowWrap)}} flex"><div class$="{{_getButtonMarginClass(showButtons, allowWrap)}}"><div id="fieldWrapper" class$="{{_getWrapperClass(isValid, _forcedFailedClass, isSelected, _dropdownActive, _dropdownHoverFix)}}"><template is="dom-if" if="[[!hideDate]]"><px-datetime-entry id="date" class$="{{_getEntryDateClass(hideDate, hideTime, hideIcon)}}" date-or-time="Date" moment-format="{{dateFormat}}" moment-obj="{{momentObj}}" is-selected="{{isSelected}}" hide-icon="{{hideIcon}}" time-zone="{{timeZone}}" show-time-zone="{{_showTimeZoneInDate(hideTime, showTimeZone)}}" block-future-dates="{{blockFutureDates}}" block-past-dates="{{blockPastDates}}" min-date="{{minDate}}" max-date="{{maxDate}}" resources="[[resources]]" language="[[language]]" formats="[[formats]]"></px-datetime-entry></template><template is="dom-if" if="[[!hideTime]]"><px-datetime-entry id="time" date-or-time="Time" moment-format="{{timeFormat}}" show-time-zone="{{showTimeZone}}" moment-obj="{{momentObj}}" hide-icon="{{hideIcon}}" time-zone="{{timeZone}}" is-selected="{{isSelected}}" block-future-dates="{{blockFutureDates}}" block-past-dates="{{blockPastDates}}" min-date="{{minDate}}" max-date="{{maxDate}}" resources="[[resources]]" language="[[language]]" formats="[[formats]]"></px-datetime-entry></template></div><template is="dom-if" if="[[_showValidation(isValid, hideValidationMessage)]]"><div class="form-field__help validation-error dt-validation-text">{{_validationErrorMessage}}</div></template></div><template is="dom-if" if="{{showButtons}}"><px-datetime-buttons resources="[[resources]]" language="[[language]]" formats="[[formats]]"></px-datetime-buttons></template></div></template></dom-module><script>Polymer({is:'px-datetime-field',behaviors:[PxDatetimeBehavior.SingleMoment,PxDatetimeBehavior.Buttons,PxDatetimeBehavior.Validate],properties:{dateFormat:{type:String,value:'YYYY-MM-DD'},timeFormat:{type:String,value:'HH:mm:ss'},showTimeZone:{type:String,value:''},hideTime:{type:Boolean,value:!1},hideDate:{type:Boolean,value:!1},hideIcon:{type:Boolean,value:!1},allowWrap:{type:Boolean,value:!1},required:{type:Boolean,value:!1},dateIsValid:{type:Boolean,value:!0},timeIsValid:{type:Boolean,value:!0},fieldIsValid:{type:Boolean,value:!0},isValid:{type:Boolean,computed:'_getIsValid(fieldIsValid, dateIsValid, timeIsValid)'},hideValidationMessage:{type:Boolean,value:!1},_validationErrorMessage:{type:String,value:''},_forcedFailedClass:{type:Boolean,value:!1},isSelected:{type:Boolean,value:!1,notify:!0},preventApply:{type:Boolean,value:!1},_dropdownActive:{type:Boolean,value:!1},_dropdownHoverFix:{type:Boolean,value:!1},preventCellFocus:{type:Boolean,value:!1}},listeners:{"px-datetime-entry-icon-clicked":'_iconClicked',"px-next-field":'_nextFieldRequired',"px-previous-field":'_previousFieldRequired',"px-datetime-button-clicked":'_dateTimeButtons',"px-validation-message":'_handleValidationMessage',"px-dropdown-focused":'_handleDropdownFocus',"px-dropdown-blurred":'_handleDropdownBlur',"px-moment-valid":'_handleValidMoment',"px-moment-invalid":'_handleInvalidMoment',blur:'_applyChanges'},observers:['_validateSetMomentObj(momentObj)'],_showTimeZoneInDate:function(a,b){return a||!0===a?b:''},keyBindings:{esc:'_onEsc',enter:'_onEnter'},_nextFieldRequired:function(a){var b=this.$$('#date');b&&'Date'===a.detail.dateOrTime&&!this.hideTime&&(this.$$('#time')._focusCell(0),a.stopPropagation(),a.stopImmediatePropagation())},_previousFieldRequired:function(a){var b=this.$$('#time');b&&'Time'===a.detail.dateOrTime&&!this.hideDate&&(this.$$('#date')._focusLastCell(),a.stopPropagation(),a.stopImmediatePropagation())},_focusFirstEntry:function(a){this.hideDate||a?this.$$('#time')._focusCell(0):this.$$('#date')._focusCell(0)},_focusLastEntry:function(){this.hideTime?this.$$('#date')._focusLastCell():this.$$('#time')._focusLastCell()},_getWrapClass:function(a){if(a)return'flex--wrap'},_getButtonMarginClass:function(a,b){var c='dt-field-validation-wrapper ';return a&&(c+='u-mr- ',b&&(c+='u-pb+')),c},_handleDropdownFocus:function(a){a.stopPropagation(),this.set('_dropdownActive',!0)},_handleDropdownBlur:function(a){a.stopPropagation(),this.set('_dropdownActive',!1),this._handleHoverFix()},detached:function(){this._dropdownFocused=!1},_handleHoverFix:function(){this.set('_dropdownHoverFix',!0),this.async(function(){this.set('_dropdownHoverFix',!1)},1e3)},_getWrapperClass:function(a,b,c,d,e){var f='flex flex--middle dt-text-field ';return!1===a||!0===b?f+='validation-error validation-failed ':c?f+='dt-is-selected ':d?f+='dt-dropdown-is-active ':e&&(f+='dt-text-field--hover-fix '),f},_getEntryDateClass:function(a,b,c){var d='';return!1===a&&!1===b&&!0===c?d+='u-mr+ ':!1===a&&!1===b&&(d+='u-mr- '),d},_validateSetMomentObj:function(a){void 0===a||this._validateMomentObj(a)},_getIsValid:function(a,b,c){return a&&b&&c},_handleValidationMessage:function(a){this.set('_validationErrorMessage',a.detail.validationErrorMessage)},_showValidation:function(a,b){var c=!a;return b&&(c=!1),c},_handleValidMoment:function(a){if(a.detail&&a.detail.element&&'date'===a.detail.element.id&&(this.dateIsValid=!0),a.detail&&a.detail.element&&'time'===a.detail.element.id&&(this.timeIsValid=!0),a.detail&&a.detail.element&&'PX-DATETIME-FIELD'===a.detail.element.nodeName&&(this.dateIsValid=!0,this.timeIsValid=!0),!this.showButtons&&'PX-DATETIME-FIELD'!==a.detail.element.nodeName){this._applyChanges('_momentChanged')}},_handleInvalidMoment:function(a){this.IsValid=!1,a.detail&&a.detail.element&&'date'===a.detail.element.id&&(this.dateIsValid=!1),a.detail&&a.detail.element&&'time'===a.detail.element.id&&(this.timeIsValid=!1)},_iconClicked:function(a){'Date'!==a.detail.dateOrTime||this.preventCellFocus?'Time'===a.detail.dateOrTime&&this.$$('#time')._focusCell(0):this.$$('#date')._focusCell(0)},_dateTimeButtons:function(a){a.detail.action?this._applyChanges():this._cancelChanges()},_onEsc:function(){this._cancelChanges()},_onEnter:function(){this._applyChanges(),this.blur()},_applyChanges:function(a){var b=Polymer.dom(this.root).querySelector('#date'),c=Polymer.dom(this.root).querySelector('#time');if(void 0!==this.momentObj&&(null!==b||this.hideDate)&&(null!==c||this.hideTime)){var d=this._validateField(a);this.preventApply&&d&&'FieldSame'!==d?this.fire('px-field-valid',{momentObj:d}):'FieldBlank'===d?(this._validField(),this.set('momentObj',null),this.fire('px-moment-changed')):d&&'FieldSame'!==d&&(this.set('momentObj',d),this.fire('px-moment-changed'))}},_cancelChanges:function(){var a=Polymer.dom(this.root).querySelectorAll('px-datetime-entry');null===this.momentObj?a.forEach(function(a){a.clear()}):a.forEach(function(a){a.setValueFromMoment()}),this._validateField(),this.blur()}});</script></body></html>