<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-simple-chart-common-behavior/px-simple-chart-common-behavior.html"><link rel="import" href="css/px-simple-line-chart-styles.html"><script type="text/javascript" src="../d3/d3.js"></script></head><body><dom-module id="px-simple-line-chart"><template><style include="px-simple-line-chart-styles"></style><div class="px-simple-line-chart-div"><svg class="px-simple-line-chart-svg"></svg></div></template></dom-module><script>Polymer({is:'px-simple-line-chart',behaviors:[PxSimpleChartCommonBehavior.common],properties:{lineData:{type:Array,observer:'_drawChart',value:function(){return[[1,2],[2,3],[3,4]]}},threshold:{type:String,value:null},thresholdLabel:{type:String,value:''},max:{type:String,value:null},min:{type:String,value:null},maxLabel:{type:String,value:''},minLabel:{type:String,value:''},columns:{type:Number,observer:'_drawChart',value:7},rows:{type:Number,observer:'_drawChart',value:7},padding:{type:String,value:''},maxDataPoints:{type:Number,value:25}},addPoint:function(a){this.lineData.length>=this.maxDataPoints&&this.splice('lineData',0,1),this.push('lineData',a),this._drawChartDebounced()},_drawChartDebounced:function(){this.lineData&&(this._reconcileValues(),this._clearSVG(this.svg),this._setDimensions(),this._setSizes(),this._setScales(),this._setChartLineFunction(),this._setLinearLineFunction(),this._addGridLines(),this._requireAxisBar&&(this._addAxisBar(),this._drawAxisLabels(),(this.thresholdValue||0===this.thresholdValue)&&this._drawThresholdLine()),this._drawChartLine(),this._addChartBorders(),this._addStyleScope())},_reconcileValues:function(){this.columns=this._reconcileValue(this.columns,7),this.rows=this._reconcileValue(this.rows,7),this.columns=this._ensureMinimum(this.columns,1),this.rows=this._ensureMinimum(this.rows,1),this.paddingValue=this._reconcileValue(this.padding,!0),this.minValue=this._reconcileMinOrMax(this.min,'min'),this.maxValue=this._reconcileMinOrMax(this.max,'max'),this.thresholdValue=this._reconcileThreshold(this.threshold),this.minLabelValue=this._reconcileValue(this.minLabel,!1),this.maxLabelValue=this._reconcileValue(this.maxLabel,!1),(this.minValue||0===this.minValue)&&!1===this.minLabelValue&&'false'!==this.minLabel&&(this.minLabelValue=this.minValue.toString()),(this.maxValue||0===this.maxValue)&&!1===this.maxLabelValue&&'false'!==this.maxLabel&&(this.maxLabelValue=this.maxValue.toString()),this.thresholdLabelValue=this._reconcileValue(this.thresholdLabel,!1),(this.thresholdValue||0===this.thresholdValue)&&!1===this.thresholdLabelValue&&(this.thresholdLabelValue=this.thresholdValue.toString()),this.thresholdLabelValue&&!this.thresholdValue&&0!==this.thresholdValue&&(this.thresholdLabelValue=!1),(!1!==this.thresholdLabelValue||!1!==this.minLabelValue||!1!==this.maxLabelValue)&&(this._requireAxisBar=!0)},_reconcileMinOrMax:function(a,b){if(this.autoMinMax=!1,'string'===this._typeofToString(a)&&(0===a.length?this.autoMinMax=!0:'auto'===a&&(this.autoMinMax=!0)),this.autoMinMax){var c='max'===b?d3.max:d3.min;return c(this.lineData,function(a){return a[1]})}return'false'!==a&&'number'===typeof parseFloat(a)&&parseFloat(a)},_reconcileThreshold:function(a){return(parseFloat(a)||0===parseFloat(a))&&parseFloat(a)},_setSizes:function(){this.barWidth=0,this.fullWidth=this.widthValue,(this.thresholdLabelValue||this.minLabelValue||this.maxLabelValue)&&(this.barWidth=parseInt(this._getAxisLabelWidth()+14)),this.chartWidth=this.widthValue-this.barWidth,this.columnWidth=parseInt(this.chartWidth/this.columns),this.barWidth?this.barWidth+=this.chartWidth%this.columns:this.fullWidth-=this.chartWidth%this.columns,this.chartHeight=this.heightValue,this.rowHeight=parseInt(this.heightValue/this.rows),this.chartHeight-=this.heightValue%this.rows,this.svg.attr('width',this.widthValue).attr('height',this.heightValue)},_extentWithPadding:function(a){var b=d3.extent(a,function(a){return a[1]});if(b[0]=void 0===this.minValue||null===this.minValue||isNaN(this.minValue)?b[0]:this.minValue,b[1]=this.maxValue?this.maxValue:b[1],this.paddingValue){var c=Math.abs(b[0]-b[1]),d=0.05*c;b[0]-=d,b[1]+=d}return b},_drawChartLine:function(){this.svg.append('path').datum(this.lineData).attr('class','chartLine').attr('d',this.chartLineFunction)},_setScales:function(){this.xScale=d3.scale.linear().range([this.barWidth+0.5,this.fullWidth-0.5]).domain(d3.extent(this.lineData,function(a){return a[0]})),this.yScale=d3.scale.linear().range([this.chartHeight,0]).domain(this._extentWithPadding(this.lineData))},_typeofToString:function(b){return('undefined'===typeof b?'undefined':babelHelpers.typeof(b)).toString().toLowerCase()},_getElementPadding:function(a){var b=window.getComputedStyle(a,null);return{top:b.getPropertyValue('padding-top').split('px')[0],right:b.getPropertyValue('padding-right').split('px')[0],bottom:b.getPropertyValue('padding-bottom').split('px')[0],left:b.getPropertyValue('padding-left').split('px')[0]}},_addAxisBar:function(){this.svg.append('rect').attr('class','axisBar').attr('x',1).attr('y',0).attr('width',this.barWidth-2).attr('height',this.chartHeight)},_drawAxisLabels:function(){this.thresholdLabelValue&&(this.thresholdLabelSVG=this.svg.append('text').attr('class','axisLabel').attr('text-anchor','middle').text(this.thresholdLabelValue.toString()).attr('x',this.barWidth/2).attr('y',parseInt(this.yScale(this.thresholdValue))+5)),this.minLabelValue&&(this.minLabelSVG=this.svg.append('text').attr('class','axisLabel').attr('text-anchor','middle').text(this.minLabelValue.toString()).attr('x',this.barWidth/2).attr('y',this.chartHeight-8)),this.maxLabelValue&&(this.maxLabelSVG=this.svg.append('text').attr('class','axisLabel').attr('text-anchor','middle').text(this.maxLabelValue.toString()).attr('x',this.barWidth/2).attr('y',18))},_getAxisLabelWidth:function(){var a=[this.thresholdLabelValue||'',this.minLabelValue||'',this.maxLabelValue||''],b=a.sort(function(c,a){return a.length-c.length})[0];this.barLabel=this.svg.append('text').attr('class','axisLabel').attr('text-anchor','middle').style('display','block').text(b);var c=this.barLabel.node().getComputedTextLength();return this.barLabel.remove(),Math.round(c-0.1*c)},_setLinearLineFunction:function(){this.linearLineFunction=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate('linear')},_setChartLineFunction:function(){var a=this;this.chartLineFunction=d3.svg.line().x(function(b){return a.xScale(b[0])}).y(function(b){return a.yScale(b[1])})},_addChartBorders:function(){this.svg.append('path').attr('class','chartBorder').attr('d',this.linearLineFunction([{x:0,y:0.5},{x:this.fullWidth,y:0.5}])),this.svg.append('path').attr('class','chartBorder').attr('d',this.linearLineFunction([{x:0,y:this.chartHeight-0.5},{x:this.fullWidth,y:this.chartHeight-0.5}])),this.svg.append('rect').attr('class','chartBottom').attr('x',0).attr('y',this.chartHeight-0.5).attr('fill','#FFFFFF').attr('width',this.widthValue).attr('height',Math.abs(this.chartHeight-this.heightValue)+1)},_addGridLines:function(){var a=[[{x:0.5,y:0},{x:0.5,y:this.chartHeight}]];for(i=0;i<=this.columns;i++)a.push([{x:i*this.columnWidth+this.barWidth-0.5,y:0},{x:i*this.columnWidth+this.barWidth-0.5,y:this.chartHeight}]);for(i=0;i<=this.rows-1;i++)a.push([{x:0,y:i*this.rowHeight+0.5},{x:this.fullWidth,y:i*this.rowHeight+0.5}]);for(i=0;i<a.length;i++)this.svg.append('path').attr('class','chartGrid').attr('d',this.linearLineFunction(a[i]))},_drawThresholdLine:function(){var a=parseInt(this.yScale(this.thresholdValue)),b=this.svg.select('.thresholdLine');b.empty()&&(b=this.svg.append('path')),b.attr('class','thresholdLine').attr('d',this.linearLineFunction([{x:this.barWidth,y:a+0.5},{x:this.fullWidth,y:a+0.5}]))}});</script></body></html>