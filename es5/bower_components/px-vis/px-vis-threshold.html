<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-threshold"><template><style include="px-vis-styles"></style></template></dom-module><script>Polymer({is:'px-vis-threshold',behaviors:[PxVisBehavior.observerCheck,PxVisBehavior.sizing,PxVisBehaviorD3.svg,PxVisBehaviorD3.axes,PxVisBehavior.commonMethods,PxVisBehavior.completeSeriesConfig,PxVisBehavior.thresholds,PxVisBehaviorD3.domainUpdate,PxVisBehaviorD3.clipPath,PxVisBehavior.measureText,PxVisBehavior.updateStylesOverride],properties:{_defaultDefaultColor:{type:String,value:'rgb(0,0,0)'},defaultColor:{type:String,value:'rgb(0,0,0)'},thresholdGroup:{type:Object,value:function(){return{}}},thresholdLine:{type:Object},thresholdRect:{type:Object},displayTitle:{type:Boolean,value:!1},_animationFrameDone:{type:Boolean,value:!1},_thresholdBuilder:{type:Object},drawDebounceTime:{type:Number,value:10},language:{type:String,value:'en'}},observers:['drawElement(svg, y, domainChanged, completeSeriesConfig.*, thresholdData.*, width, margin.*, _animationFrameDone, language)','_updateColors()','_calcThemeOrConfig(_stylesUpdated)'],ready:function(){this._createMeasurementCanvas(),window.requestAnimationFrame(function(){this.updateStyles()}.bind(this)),this.thresholdId||this.set('thresholdId',this.generateRandomID('threshold_'))},_calcThemeOrConfig:function(){this.defaultColor===this._defaultDefaultColor&&(this.defaultColor=this._checkThemeVariable('--px-vis-threshold-color',this._defaultDefaultColor)),this.set('_animationFrameDone',!0)},drawElement:function(){this.hasUndefinedArguments(arguments)||this._animationFrameDone&&null!==this.domainChanged&&this.y&&('function'===typeof this.y||this._doesObjHaveValues(this.y))&&(0<this.drawDebounceTime?this.debounce('_drawThreshold',function(){this._drawElementDebounced()},this.drawDebounceTime):this._drawElementDebounced())},_drawElementDebounced:function(){var a=this,b=!0;this._isD3Empty(this.thresholdGroup)&&(this.thresholdGroup=this.svg.append('g').attr('class','thresholds')),this._thresholdBuilder=this.thresholdGroup.selectAll('g.threshold').data(this.thresholdData,function(a){return a.value}),this._thresholdBuilder.exit().remove(),this._thresholdBuilder.enter().append('g').attr('class','threshold').attr('threshold-id',function(a){return a.for}).each(function(b,c){a._enterLine(b,c,this),a._enterRect(b,c,this),a._enterText(b,c,this)}).merge(this._thresholdBuilder).each(function(c,d){b=!1,a._mergeLine(c,d,this),a._mergeRect(c,d,this);var e=a._mergeText(c,d,this);a._rectWidth(this,c,e)}),b&&this._setColors(),this.fire('px-vis-threshold-rendering-ended')},_enterLine:function(a,b,c){Px.d3.select(c).append('line').attr('class','threshold-line')},_mergeLine:function(a,b,c){Px.d3.select(c).select('line.threshold-line').attr('x1',0).attr('x2',this.width-this.margin.right-this.margin.left).attr('y1',function(a){return this._getYVal(a)}.bind(this)).attr('y2',function(a){return this._getYVal(a)}.bind(this)).attr('stroke',this._getColors.bind(this)).attr('stroke-width',function(a){return this.thresholdConfig[a.type]&&this.thresholdConfig[a.type].strokeWidth?this.thresholdConfig[a.type].strokeWidth:this._defaultThresholdConfig.strokeWidth}.bind(this)).attr('stroke-dasharray',function(a){return this.thresholdConfig[a.type]&&this.thresholdConfig[a.type].dashPattern?this.thresholdConfig[a.type].dashPattern:this._defaultThresholdConfig.dashPattern}.bind(this)).attr('clip-path','url(#'+this.clipPath+')')},_enterRect:function(a,b,c){Px.d3.select(c).append('rect').attr('class','threshold-rect').attr('x',5).attr('height','18')},_mergeRect:function(a,b,c){Px.d3.select(c).select('rect.threshold-rect').attr('y',this._calcYPos.bind(this)).attr('fill',function(a,b){var c=a.type;return this.thresholdConfig[c]&&this.thresholdConfig[c].showThresholdBox?this._getColors(a,b):'none'}.bind(this)).attr('clip-path','url(#'+this.clipPath+')')},_enterText:function(a,b,c){Px.d3.select(c).append('text').attr('class','threshold-text').attr('font-size','12px').style('font-family',this._checkThemeVariable('--px-vis-font-family','Comic Sans MS')).attr('font-style',this._checkThemeVariable('--px-vis-font-family','Comic Sans MS')).attr('x',8)},_mergeText:function(a,b,c){var d=this._calcTitle(a);return Px.d3.select(c).select('text.threshold-text').text(d).attr('y',function(a,b){return this._calcYPos(a,b,13)}.bind(this)).attr('fill',function(a,b){var c=a.type;return this.thresholdConfig[c]&&this.thresholdConfig[c].showThresholdBox?'white':this._getColors(a,b)}.bind(this)).attr('clip-path','url(#'+this.clipPath+')'),d},_rectWidth:function(a,b,c){var d=0;this.thresholdConfig[b.type]&&this.thresholdConfig[b.type].showThresholdBox&&(d=1.1*this._measureTextOnCanvas(c).width+6),Px.d3.select(a).select('rect.threshold-rect').attr('width',d)},_setColors:function(){if(this._doesD3HaveValues(this.thresholdGroup)){var a=this;this.thresholdGroup.selectAll('g.thresholds').each(function(b,c){a._mergeLine(b,c,this),a._mergeRect(b,c,this),a._mergeText(b,c,this)})}},_getColors:function(a){var b=this._checkColorType(this.defaultColor);return a.type&&this.thresholdConfig[a.type]&&this.thresholdConfig[a.type].color?b=this.thresholdConfig[a.type].color:a.for&&this.completeSeriesConfig[a.for]&&(b=this.completeSeriesConfig[a.for].color),b},_calcYPos:function(a,b,c){return c|=0,this._getYVal(a)-17+c},_getYVal:function(a){if('object'===babelHelpers.typeof(this.y)){if(this.completeSeriesConfig[a.for]&&this.completeSeriesConfig[a.for].axis&&this.completeSeriesConfig[a.for].axis.id&&this.y[this.completeSeriesConfig[a.for].axis.id]){var b=this.completeSeriesConfig[a.for].axis.id;return this.y[b](a.value)}return this.y[a.for]?this.y[a.for](a.value):this.y.defaultAxis?this.y.defaultAxis(a.value):(console.warn('(\u0E4F\u032F\u0361\u0E4F ) Invalid series or axis for threshold: '+JSON.stringify(a)),-9999)}return this.y(a.value)},_calcTitle:function(a){var b='.2f',c='';return this.thresholdConfig[a.type]&&(this.thresholdConfig[a.type].title&&(c=this.thresholdConfig[a.type]&&this.thresholdConfig[a.type].title?' ('+this.thresholdConfig[a.type].title+')':' ('+a.type+')'),this.thresholdConfig[a.type].format&&(b=this.thresholdConfig[a.type].format)),Px.d3.format(b)(a.value)+c},_updateColors:function(){this.hasUndefinedArguments(arguments)||void 0===this.svg||(this._calcThemeOrConfig(),this._drawElementDebounced())}});</script></body></html>