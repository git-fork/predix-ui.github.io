<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-scatter-canvas"><template><style include="px-vis-styles"></style></template></dom-module><script>Polymer({is:'px-vis-scatter-canvas',behaviors:[PxVisBehaviorD3.canvasContext,PxVisBehaviorD3.axes,PxVisBehavior.dataset,PxVisBehavior.mutedSeries,PxVisBehavior.commonMethods,PxVisBehavior.completeSeriesConfig,PxVisBehaviorD3.radialLineGenerator,PxVisBehavior.tooltipData,PxVisBehaviorD3.domainUpdate,PxVisBehavior.polarData,PxVisBehavior.seriesId,PxVisBehavior.dynamicConfigProperties,PxVisBehavior.serieToRedrawOnTop,PxVisBehavior.preventInitialDrawing,PxVisBehavior.isAttached,PxVisBehaviorD3.scatterMarkers,PxVisBehavior.rendererType,PxVisBehaviorD3.clipPathBoolean,PxVisBehaviorD3.scatterArrow],properties:{seriesNumber:{type:Number,value:0},radial:{type:Boolean,value:!1},timeData:{type:String,value:'Timestamp'},_currentDrawingOptions:{type:Object,value:function(){return{}}}},observers:['_priorityChanged(priority)'],ready:function(){this._watchConfigProperty('markerSymbol','circle'),this._watchConfigProperty('markerScale',1),this._watchConfigProperty('markerSize',64),this._watchConfigProperty('markerFillOpacity',0.6),this._watchConfigProperty('markerStrokeOpacity',1),this._watchConfigProperty('mutedOpacity',0.3),this._watchConfigProperty('priority',0)},attached:function(){this.fire('px-vis-renderer-register',{type:'scatter',renderMode:'canvas',rendererType:this.rendererType,priority:this.priority})},detached:function(){this.fire('px-vis-renderer-unregister',{renderMode:'canvas',rendererType:this.rendererType})},_priorityChanged:function(){this.fire('px-vis-renderer-update-target-props',{propertyName:'priority',propertyValue:this.priority,rendererType:this.rendererType})},initializeDrawingSession:function(){this.radial&&this._defineRadialLine(!1,this.multiPath,this.counterClockwise,this.useDegrees),this._initiateDrawingOptions()},_initiateDrawingOptions:function(){this._currentDrawingOptions.symbol=Px.d3.symbol().type(this.markerMapping[this.markerSymbol]).size(this.markerSize*this.markerScale).context(this.canvasContext),this._currentDrawingOptions.arrow=Px.d3.symbol().type(this.markerMapping[this.arrowConfig.symbol]).size(this.arrowConfig.size*this.arrowConfig.scale).context(this.canvasContext),this._currentDrawingOptions.muted=this.mutedSeries[this.seriesId],this._currentDrawingOptions.fillOpacity=this._currentDrawingOptions.muted?this.mutedOpacity:this.markerFillOpacity,this._currentDrawingOptions.strokeOpacity=this._currentDrawingOptions.muted?0:this.markerStrokeOpacity,this._currentDrawingOptions.sameOpacity=this._currentDrawingOptions.fillOpacity===this._currentDrawingOptions.strokeOpacity,this._currentDrawingOptions.drawingFunction,this._currentDrawingOptions.oldAlpha=this.canvasContext.globalAlpha,this._currentDrawingOptions.previousTranslate=[0,0],this._currentDrawingOptions.xDomain=this.x.domain(),this._currentDrawingOptions.yDomain=this.y.domain(),this._currentDrawingOptions.drawingFunction=this._currentDrawingOptions.sameOpacity?function(){this.canvasContext.fill(),this.canvasContext.stroke()}.bind(this):function(){this._currentDrawingOptions.fillOpacity&&(this.canvasContext.globalAlpha=this._currentDrawingOptions.fillOpacity,this.canvasContext.fill()),this._currentDrawingOptions.strokeOpacity&&(this.canvasContext.globalAlpha=this._currentDrawingOptions.strokeOpacity,this.canvasContext.stroke())}.bind(this)},drawClipPath:function(){var a=Math.max;if(0<this.chartData.length&&0<this.completeSeriesConfig[this.seriesId].x.length){if(this.canvasContext.beginPath(),this.radial)this.canvasContext.arc(0,0,this.height/2,0,2*Math.PI,!1);else{var b=a(this.width-this.margin.left-this.margin.right,0),c=a(this.height-this.margin.top-this.margin.bottom,0);this.canvasContext.rect(0,0,b,c)}this.canvasContext.clip()}},renderOneBatch:function(a,b){var c=Math.PI;this.canvasContext.save(),this.clipPath&&this.drawClipPath(),this.canvasContext.fillStyle=this.completeSeriesConfig[this.seriesId].color,this.canvasContext.strokeStyle=this.completeSeriesConfig[this.seriesId].color,this.canvasContext.globalAlpha=this._currentDrawingOptions.fillOpacity;var d,e,f,g,h,j,k=[0,0];this.canvasContext.beginPath();for(var l=a;l<b;l++)this._isValidData(this.chartData[l][this.completeSeriesConfig[this.seriesId].y])&&this._isValidData(this.chartData[l][this.completeSeriesConfig[this.seriesId].x])&&(d=this._getTransform(this.chartData[l]),this.showArrows&&l!==a&&(e=(d[0]-k[0])/2,f=(d[1]-k[1])/2,g=Math.sqrt(e*e+f*f),g>this.arrowConfig.minLength&&(h=Math.atan2(f,e)+c/2,j=0>h?h+2*c:h,this.canvasContext.translate(e,f),this.canvasContext.rotate(j),this._currentDrawingOptions.arrow(),k=[e+k[0],f+k[1]],this.canvasContext.rotate(-j))),this.canvasContext.translate(d[0]-k[0],d[1]-k[1]),this._currentDrawingOptions.symbol(),k=d);this.canvasContext.closePath(),this._currentDrawingOptions.drawingFunction(),this.canvasContext.translate(-k[0],-k[1]),this.canvasContext.restore()},_getTransform:function(a){if(this.radial){var b=this.line([a]),c=b.slice(1).slice(0,-1),d=c.indexOf(',')+1;return[+c.slice(0,d-1),+c.slice(d)]}var e=this.x(a[this.completeSeriesConfig[this.seriesId].x]),f=this.y(a[this.completeSeriesConfig[this.seriesId].y]);return[e,f]},_isSerieMuted:function(a){return this.multiPath?!!this.mutedSeries[a[this.seriesId]]:!!this.mutedSeries[this.seriesId]}});</script></body></html>