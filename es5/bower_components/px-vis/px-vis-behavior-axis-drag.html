<html><head><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><script>var PxVisBehaviorDrag=PxVisBehaviorDrag||{};PxVisBehaviorDrag.basicProps=[{properties:{_dragging:{type:Object,value:function(){return{}}},dragBehavior:{type:Object,notify:!0}},_position:function(a){var b=this._dragging[a];return null==b?this.x(a):b},transition:function(a){return a.transition().duration(500)}},PxVisBehavior.sizing,PxVisBehavior.dimensions,PxVisBehavior.dataset,PxVisBehavior.completeSeriesConfig,PxVisBehaviorD3.dynamicRedraw,PxVisBehavior.mutedSeries,PxVisBehaviorD3.axes,PxVisBehavior.radial],PxVisBehaviorDrag.parallelAxisDrag=[{createParallelAxisDrag:function(){this.dragBehavior=Px.d3.drag().container(this.dragContainerElem).on("start.drag",this._onDragStart.bind(this)).on("drag.drag",this._onDrag.bind(this)).on("end.drag",this._onDragEnd.bind(this)),this.notifyPath("dragBehavior",this.dragBehavior)},_onDragStart:function(){var a=this.dimension;this._dragging={},this._dragging[a]=this.x(a)},_onDrag:function(){this.debounce("drag",function(a){this.radial?this._radialDrag(a):this._linearDrag(a),this.redrawSeries&this.dynamicRedraw&&_this.fire("px-vis-redraw-lines"),this.svg.attr("transform",this._radialOrLinear.bind(this)),this.fire("px-vis-recalc-title-location")}.bind(this,Px.d3.event),10)},_onDragEnd:function(){this._dragging={},this.transition(this.svg).attr("transform",function(){return this.radial?"rotate("+(180*this.x(this.dimension)/Math.PI+180)+")":"translate("+this.x(this.dimension)+",0)"}.bind(this)),this.redrawSeries&&(this.set("completeSeriesConfig.*.x",this.dimensions),this.fire("px-vis-complete-series-config",{data:this.dimensions,dataVar:"completeSeriesConfig.*.x",method:"set"}),this.fire("px-vis-redraw-lines")),this.fire("px-axis-done")},_linearDrag:function(a){var b=this.dimension;this._dragging[b]=Math.min(this.width,Math.max(0,a.x));var c=this._linearSort(this.dimensions,this.dimension,a);c&&this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,swappedDim:c,dimension:this.dimension})},_radialDrag:function(a){var b=Math.PI,c=Math.atan2(a.y,a.x)+b/2,e=0>c?c+2*b:c,f=this.dimension;this._dragging[f]=e;var d=this._radialSort(this.dimensions,f,e);d&&this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,swappedDim:d,dimension:this.dimension})},_linearSort:function(a,b,c){var d=a.length-1,e=a.indexOf(b),f=0===e?-1:e-1,g=e===d?-1:e+1,h=Math.min(this.width,Math.max(0,c.x)),i=-1===f?"edge":this.x(a[f]),j=-1===g?"edge":this.x(a[g]),k=null;return"edge"!==i&&h<i?(k=a[f],a[e]=k,a[f]=b):"edge"!==j&&h>j&&(k=a[g],a[e]=k,a[g]=b),k},_radialSort:function(a,b,c){var d,e=Math.PI,f=a.length-1,g=a.indexOf(b),h=0===g?f:g-1,i=g===f?0:g+1;if(0===g){var j=2===f?e:this.x(a[i+1]),k=2===f?e:this.x(a[h-1]);c>this.x(a[i])&&c<j?(d=a[i],a[g]=a[i],a[i]=b):c<this.x(a[h])&&c>k&&(d=a[h],a[g]=a[h],a[h]=b)}else if(0===h){var l=2===f?3*e/2:this.x(a[f]);c>l?(d=a[h],a[g]=a[h],a[h]=b):c>this.x(a[i])&&(d=a[i],a[g]=a[i],a[i]=b)}else if(0===i){var l=2===f?e/2:this.x(a[1]);c<=l?(d=a[i],a[g]=a[i],a[i]=b):c<this.x(a[h])&&(d=a[h],a[g]=a[h],a[h]=b)}else c<this.x(a[h])?(d=a[h],a[g]=a[h],a[h]=b):c>this.x(a[i])&&(d=a[i],a[g]=a[i],a[i]=b);return d},_radialOrLinear:function(){var a=this.dimension;return this.radial?"rotate("+(180*this._position(a)/Math.PI+180)+")":"translate("+this._position(a)+",0)"}},PxVisBehaviorDrag.basicProps],PxVisBehaviorDrag.cartesianDrag=[{createCartesianDrag:function(){var a=Px.d3.drag().container(this.dragContainerElem).on("start.drag",this._onCartesianDragStart.bind(this)).on("drag.drag",this._onCartesianDrag.bind(this)).on("end.drag",this._onCartesianDragEnd.bind(this));this.set("dragBehavior",a)},_onCartesianDragStart:function(){this._dragging={},this._dragging[this.dimension]=this.x(this.dimension)},_onCartesianDrag:function(){var a=Math.min,b=Math.max;this.debounce("drag",function(c){var e,f,g,h=this.x.rightDomain(),i=this.x.leftDomain(),j=this.dimension,d=-1===h.indexOf(j)?"left":"right",k=-1===h.indexOf(j)?i.indexOf(j):h.indexOf(j),m=!1,o=null,p=null,q=null,s=0,t=0;if("left"===d?(this._dragging[j]=a(this.width,b(-this.margin.left,c.x)),p=i[k+1]?i[k+1]:null,0===k?(q=h[0]?h[0]:null,t=this.width-this.margin.left*i.length):q=i[k-1]):"right"===d&&(this._dragging[j]=a(this.width+this.margin.right,b(-this.margin.left,c.x))-this.width+this.margin.left+this.margin.right,q=h[k+1]?h[k+1]:null,0===k?(p=i[0]?i[0]:null,s=this.margin.right*h.length-this.width):p=h[k-1]),e=this._position(j),f=p?this.x(p)+s:null,g=q?this.x(q)+t:null,(f||0===f)&&e<f){o=p,0===k&&"right"===d&&(m=!0);var u=this.dimensions.indexOf(j),n=this.dimensions.indexOf(p);this.dimensions[u]=p,this.dimensions[n]=j}else if((g||0===g)&&e>g){o=q,0===k&&"left"===d&&(m=!0);var u=this.dimensions.indexOf(j),v=this.dimensions.indexOf(q);this.dimensions[u]=q,this.dimensions[v]=j}if(o&&!m){var w=i.length,l=h.length,r=this.dimensions.slice(0,w),x=this.dimensions.slice(w);this.x.leftDomain(r),this.x.rightDomain(x),this.fire("px-vis-drag-dimension-swapped",{dimensions:this.dimensions,lDims:r,rDims:x,swappedDim:o})}else if(m){var w=i[0];i[0]=h[0],h[0]=w,this.x.leftDomain(i),this.x.rightDomain(h),this.dimensions=i.concat(h),this.fire("px-axis-orientation-changed")}else{var w=i.length,l=h.length;this.x.leftDomain(this.dimensions.slice(0,w)),this.x.rightDomain(this.dimensions.slice(w))}this.svg.attr("transform",function(){return"translate("+this._position(this.dimension)+",0)"}.bind(this))}.bind(this,Px.d3.event),1)},_onCartesianDragEnd:function(){this._dragging={},this.transition(this.svg).attr("transform",function(){return"translate("+this.x(this.dimension)+",0)"}.bind(this)),this.fire("px-axis-drag-done")}},PxVisBehaviorDrag.basicProps];</script></head><body></body></html>