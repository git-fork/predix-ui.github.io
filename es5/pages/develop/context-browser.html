<html><head><link defer="" rel="import" href="../../bower_components/polymer/polymer.html"><link defer="" rel="import" href="../../bower_components/px-demo/px-demo-footer.html"><link defer="" rel="import" href="../../bower_components/px-demo/px-demo-footer.html"><link defer="" rel="import" href="../../elements/px-catalog-page/px-catalog-page-behavior.html"><link defer="" rel="import" href="../../elements/px-catalog-page/px-catalog-page-elements.html"><link defer="" rel="import" href="../../css/px-catalog-page-styles.html"><link defer="" rel="import" href="../../css/px-catalog-theme-styles.html"><link defer="" rel="import" href="../../css/px-catalog-code-styles.html"></head><body><dom-module id="view-develop-context-browser"><template><style include="px-catalog-page-styles"></style><style include="px-catalog-code-styles"></style><style include="px-catalog-theme-styles"></style><div class="page"><div class="page-anchors" id="toc"><ul class="toc"><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#basic-concepts', activeAnchor)]]" href="#" anchor="#basic-concepts" on-tap="_handleAnchorTapped">Basic concepts</a><ul class="toc"><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#graphic-selected-active-items', activeAnchor)]]" href="#" anchor="#graphic-selected-active-items" on-tap="_handleAnchorTapped">Graphic: selected &amp; active items</a></li></ul></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#setup-in-your-app', activeAnchor)]]" href="#" anchor="#setup-in-your-app" on-tap="_handleAnchorTapped">Setup in your app</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#handle-context-selection', activeAnchor)]]" href="#" anchor="#handle-context-selection" on-tap="_handleAnchorTapped">Handle context selection</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#show-icons-filter', activeAnchor)]]" href="#" anchor="#show-icons-filter" on-tap="_handleAnchorTapped">Show icons, filter</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#format-context-data', activeAnchor)]]" href="#" anchor="#format-context-data" on-tap="_handleAnchorTapped">Format context data</a><ul class="toc"><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#convert-your-data-model', activeAnchor)]]" href="#" anchor="#convert-your-data-model" on-tap="_handleAnchorTapped">Convert your data model</a></li></ul></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#lazy-load-items', activeAnchor)]]" href="#" anchor="#lazy-load-items" on-tap="_handleAnchorTapped">Lazy load items</a><ul class="toc"><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#define-item-parent-states', activeAnchor)]]" href="#" anchor="#define-item-parent-states" on-tap="_handleAnchorTapped">Define item parent states</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#lazy-loading-apis', activeAnchor)]]" href="#" anchor="#lazy-loading-apis" on-tap="_handleAnchorTapped">Lazy loading APIs</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#example-implement-lazy-loading', activeAnchor)]]" href="#" anchor="#example-implement-lazy-loading" on-tap="_handleAnchorTapped">Example: implement lazy loading</a></li></ul></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#other-features', activeAnchor)]]" href="#" anchor="#other-features" on-tap="_handleAnchorTapped">Other features</a><ul class="toc"><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#timeout-after-closing', activeAnchor)]]" href="#" anchor="#timeout-after-closing" on-tap="_handleAnchorTapped">Timeout after closing</a></li><li class="toc__item"><a class$="toc__item__link [[_getTocLinkClassName('#pre-select-a-context', activeAnchor)]]" href="#" anchor="#pre-select-a-context" on-tap="_handleAnchorTapped">Pre-select a context</a></li></ul></li></ul></div><div class="page-content"><h2 class="page-title">Developing with the context browser</h2><style>.gif{width:100%;margin-top:.25rem;}</style><p>The context browser allows the user to browse hierarchical data and select a specific item to set the context for their current view. Examples of possible hierarchical data include:</p><ul><li>locations organized by geography (e.g. Countries -&gt; Cities -&gt; Plants)</li><li>physical assets organized by model or classification (e.g. Manufacturers -&gt; Device classes -&gt; Individual devices)</li><li>employees organized by department or function (e.g. Divisions -&gt; Teams -&gt; Employees)</li></ul><p>The user taps on an icon to open the context browser, which shows a panel with a list of context items. The user can navigate into an item to view its children, or they can select an item to choose a new context, which will update the current application view. When the user selects a new context, the context browser closes automatically.</p><p>An application can use the newly selected context to filter the data source for data visualizations, show items on a map, display relevant classification and device information, or to perform any other view updates. The application can store any relevant data associated with a context item and access that data when the user selects a new context.</p><h3 id="basic-concepts">Basic concepts</h3><p>Use the context browser to visually represent a tree of items with hierarchical relationships, allowing users to browse and interact with those items. The data concepts underlying the context browser include:</p><ul><li><strong>Items:</strong> A tree of context items. Each item is tagged with a user-friendly name displayed to the user (<code class="code code--inline">label</code>) and a unique identifier (<code class="code code--inline">id</code>). Each item can have zero or more associated child items (<code class="code code--inline">children</code>). Developers can also attach additional data to items and access it when the user selects a context.</li><li><strong>Route:</strong> A list of unique ids representing a drill-down to a specific item in the hierarchy (e.g. "us", "calif", "san-francisco" to represent United States -&gt; California -&gt; San Francisco). The route can be bound to the URL to sync the selected item with the URL state (e.g. app.com/us/calif/san-francisco).</li><li><strong>Path:</strong> Similar to the route, but instead of a list of ids, the path contains a list of references to the actual item objects representing a drill-down in the hierarchy.</li><li><strong>Active:</strong> Refers to the item whose children the user is currently browsing. When the user taps on an item to navigate into it, the item becomes active. The user can then see the active item's children, and the context browser header shows the active item's label.</li><li><strong>Selected:</strong> Refers to the item the user has selected as their context. When the user taps on an item to select it, the context browser is closed and the application should update the view with the data for the newly selected item. The user can navigate through the context browser hierarchy (changing the active item) without necessarily changing the selected context.</li></ul><h4 id="graphic-selected-active-items">Graphic: selected &amp; active items</h4><p>The context browser in the screenshot below navigates between assets in different cities. The user has browsed into “California” and selected “San Francisco” as their current context.</p><p>The graphic below shows the tree of items for this context browser, and the different data concepts that underlie its implementation.</p><p><catalog-picture img-src="../../img/developer-guides/context-browser/context-browser-graphic-selected-active" img-alt="Shows the context browser data hierarchy for selected and active items"></catalog-picture></p><h3 id="setup-in-your-app">Setup in your app</h3><p>The user can open or close the context browser (px-context-browser) by tapping on the icon (px-context-browser-trigger sub-component). Opening the context browser shows a panel with a list of context items. Each item has a label and, on hover, reveals icons that the user can tap to select or activate the item (the second icon behavior can be configured).</p><h4>Example</h4><p>To start using the context browser in your app, you'll need to load the px-context-browser and px-context-browser-trigger components, bind the components together, and assign the context browser some items. The following CodePen shows a very basic context browser setup. Click the icon in the Result tab to open the context browser.</p><iframe height="320" scrolling="no" title="Context Browser: Simple Example" src="//codepen.io/davidleonard/embed/zEJJOM/?height=265&amp;theme-id=light&amp;default-tab=html,result&amp;embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;"></iframe><p>Let's break down the code in the CodePen above:</p><p><strong>1. Import components:</strong> Start by importing both of the necessary components, <code class="code code--inline">px-context-browser/px-context-browser.html</code> and <code class="code code--inline">px-context-browser/px-context-browser-trigger.html</code>. Both components must be imported for the context browser to show up. You should change the import paths to point to your app's bower_components directory.</p><p><strong>2. Set up dom-bind for binding (demo only):</strong> The dom-bind here is just to help with data-binding the px-context-browser-trigger's <code class="code code--inline">trigger</code> property to the px-context-browser's <code class="code code--inline">openTrigger</code> property. If you're building a Polymer-based app, these components will be inside a view dom-module which will handle the binding, and this dom-bind will no longer be needed. If you're building a non-Polymer app, you can use vanilla JavaScript or your framework's data-binding syntax to accomplish the same thing.</p><p><strong>3. Create trigger:</strong> Create a px-context-browser-trigger tag wherever the context browser's open icon should show up. The trigger element creates a simple icon that shows and hides the context browser when tapped by the user.</p><p><strong>4. Create context browser:</strong> Create a px-context-browser tag. Bind the trigger's <code class="code code--inline">trigger</code> property to the context browser's <code class="code code--inline">openTrigger</code> property. This will link the two together. Add some items for the user to browse through by setting the <code class="code code--inline">items</code> attribute to some JSON. The items are added inline here via the <code class="code code--inline">items</code> attribute, but could be added via data-binding or by settings the <code class="code code--inline">items</code> property on the context browser using vanilla JavaScript.</p><h3 id="handle-context-selection">Handle context selection</h3><p>The context browser does what the name suggests: helps user browse and select contexts. When the user selects a new context, your application should respond by changing what's in the view to show information relevant to the currently selected context.</p><h4>Binding to selected context</h4><p>The context browser offers a few different ways for applications to listen for and react to the user selecting a new context. The simplest way is to data-bind to the px-context-browser <code class="code code--inline">selected</code> property, which sends update notification events when a new item is selected. This can be accomplished with data-binding in a Polymer app view like this:</p><pre class="code-block"><code class="language-html"><span class="token comment">&lt;!-- In a Polymer app dom-module --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span>
  <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<span></span>{contextItems}<span></span>}<span class="token punctuation">"</span></span>
  <span class="token attr-name">selected</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{<span></span>{selectedContextItem}<span></span>}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>When the user selects a new context, the <code class="code code--inline">selected</code> property will be updated and set to the object from the <code class="code code--inline">items</code> array that corresponds to that context item. This will trigger data-binding in the Polymer app view that holds the context browser.</p><h4>Binding with Angular, Vue, React</h4><p>Apps developed using a JavaScript framework like Angular, Vue, or React can listen for the <code class="code code--inline">selected-changed</code> DOM event on the context browser to handle context selection:</p><p><strong>Angular (v2/v4)</strong></p><pre class="code-block"><code class="language-html"><span class="token comment">&lt;!-- In an Angular template --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span>
  <span class="token attr-name">[items]</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>contextItems<span class="token punctuation">"</span></span>
  <span class="token attr-name">(selected-changed)</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedContextItem=$event.detail.value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>Vue (v2)</strong></p><pre class="code-block"><code class="language-html"><span class="token comment">&lt;!-- In a Vue template (.vue) --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span>
  <span class="token attr-name">items.prop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>contextItems<span class="token punctuation">"</span></span>
  <span class="token attr-name"><span class="token namespace">v-on:</span>selected-changed</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>selectedContextItem=$event.detail.value<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>React</strong></p><pre class="code-block"><code class="language-javascript"><span class="token comment">/* In a JSX file */</span>
<span class="token keyword">class</span> <span class="token class-name">ContextBrowserContainer</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> selectedContextItem<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">[</span><span class="token string">'context-browser'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>contextItems<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">[</span><span class="token string">'context-browser'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'selected-changed'</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> selectedContextItem<span class="token punctuation">:</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>px<span class="token operator">-</span>context<span class="token operator">-</span>browser ref<span class="token operator">=</span><span class="token string">"context-browser"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>px<span class="token operator">-</span>context<span class="token operator">-</span>browser<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4>Example</h4><p>When the user selects a new context, your app should listen for a new <code class="code code--inline">selected</code> context item and update itself. The following CodePen shows an example of a Polymer app view setting the context items, binding to the selected context item, and changing out data in the view when the selected context item changes:</p><iframe height="320" scrolling="no" title="Context Browser: Handle context selection" src="//codepen.io/davidleonard/embed/EwGgQe/?height=265&amp;theme-id=light&amp;default-tab=html,result&amp;embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;"></iframe><p>Let's break down the code in the CodePen above:</p><p><strong>0. Same setup as previous CodePen above:</strong> All the setup in the basic CodePen above is included here, including the importing of the px-context-browser components, binding an open trigger to the context browser, etc. See the CodePen example above for an introduction to these concepts.</p><p><strong>1. Create sample Polymer app view:</strong> To simulate a real app binding to the context browser data, we add a <code class="code code--inline">sample-app-view</code> component to the page and define it further down. This component wraps the <code class="code code--inline">px-context-browser</code> component and some other behaviors in the same way a Polymer app view would.</p><p><strong>2: Bind data to and from context browser:</strong> The <code class="code code--inline">openTrigger</code> and <code class="code code--inline">items</code> properties are bound down from the sample view into the context browser. The selected context is bound up from the context browser into the sample view as <code class="code code--inline">selectedContextItem</code>. When the user selects a new item in the context browser, <code class="code code--inline">selectedContextItem</code> is updated and set to the new item.</p><p><strong>3. Show data from the selected context:</strong> The <code class="code code--inline">selectedContextItem</code> is set to one of the objects defined in the context browser's <code class="code code--inline">items</code> property. Each item has fields that the context browser uses for display: label, id, and children. The context browser will ignore any additional data stored in the item object, making it a convenient way to store static data about context items.</p><p>In the sample view's Properties section, some additional metadata is added to each item as <code class="code code--inline">data</code>. Each context item represents a location in the United States - the metadata includes the population and area (size) of the context item. Data-bind those values here to display them to the user.</p><p><strong>4. Set context items to pass to the browser:</strong> Define some items to pass to the context browser and add the population and area metadata to each item. See the <code class="code code--inline">keys</code> property for a list of reserved keys that should not be used for metadata. These keys can be changed. Any unreserved key can be used to store data about a context item.</p><h4>Other ways to fetch data when context changes</h4><p>Not all types of data should be stored directly on context items. Very large datasets (e.g. timeseries data with thousands of points) should be stored in a different place in memory, or loaded on demand from a backend server. To fetch data from a server when a new context is selected, watch for changes to the px-context-browser <code class="code code--inline">selected</code> property and trigger some code to fetch new data based on the item that was selected.</p><h3 id="show-icons-filter">Show icons, filter</h3><p>The context browser's visual and interaction styles can also be customized to fit the needs of different apps. Two commonly used configurations are:</p><ul><li>showing additional icons to users when they hover over context items</li><li>showing a search input that allows users to filter the visible items</li></ul><h4>Select item icon</h4><img class="gif" src="../../img/developer-guides/context-browser/context-browser-gif-select-icon.gif"><p><strong>What it is:</strong> The 'select item' icon appears when the user hovers over a context item that can be selected. Tapping on the icon selects the item, and updates the current context through the <code class="code code--inline">selected</code> property (see "Handle user context selection" section above).</p><p><strong>How to enable it:</strong> This icon is enabled by default. It doesn't require any special configurations.</p><p><strong>Marking items that can't be selected:</strong> Some items can't be selected. These items are generally "containers" or parents that hold some child items, but that do not have any relevant data the user can explore. Items that can't be selected will not show the 'select item' icon on hover. Set the <code class="code code--inline">isSelectable</code> key to false on items that can't be selected when you define them in <code class="code code--inline">items</code>. See the "Items data structure" section below for more information.</p><h4>View children icon</h4><img class="gif" src="../../img/developer-guides/context-browser/context-browser-gif-view-children-icon.gif"><p><strong>What it is:</strong> The 'view children' icon appears when the user hovers over a context item that has children or can have children. Tapping the icon activates the item, opening it so the user can view its children. Tapping the icon does not select the item or change the current context. With or without the children icon, tapping anywhere in the context item <em>except</em> the select icon will perform the same action, activating an item and displaying its children if applicable.</p><p><strong>How to enable it:</strong> This icon is hidden by default. To show it, set the px-context-browser <code class="code code--inline">show-arrow</code> attribute. Example:</p><pre class="code-block"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span> <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">show-arrow</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>Marking items that can't have children:</strong> Some items can't have children and can't be activated. These are usually the lowest-level items in your data model and can only be selected. Set the <code class="code code--inline">isTerminal</code> key to true on items that can't have children when you define them in <code class="code code--inline">items</code>. See the "Items data structure" section below for more information.</p><h4>Filter input</h4><img class="gif" src="../../img/developer-guides/context-browser/context-browser-gif-filter.gif"><p><strong>What it is:</strong> The filter appears as a search input at the top of each column in the context browser. The user can filter through the visible items by typing in the search input. Any items with labels that don't match the user's search are hidden. This is useful when some context items have a large number of children (e.g. 25+).</p><p><strong>How to enable it:</strong> The filter is disabled by default. To show it, set the px-context-browser <code class="code code--inline">show-filter</code> attribute. Example:</p><pre class="code-block"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span> <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token attr-name">show-filter</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>Set the filter/read the filter:</strong> The <code class="code code--inline">filter</code> property will be set to the user's search string when the user enters text in the filter search box, and fires notification events upon changing. To set the filter dynamically from your app, set the context browser <code class="code code--inline">filter</code> property to a new string. To clear it, set the <code class="code code--inline">filter</code> property to an empty string or <code class="code code--inline">null</code>.</p><h4>Example</h4><p>The following CodePen shows the context browser configured to use the view children icon and the filter:</p><iframe height="320" scrolling="no" title="Context Browser: Icons and Filter" src="//codepen.io/davidleonard/embed/BwMLNg/?height=265&amp;theme-id=light&amp;default-tab=html,result&amp;embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;"></iframe><h3 id="format-context-data">Format context data</h3><p>The px-context-browser data model is centered around a tree of context items set as the <code class="code code--inline">items</code> property. <code class="code code--inline">items</code> is structured as an array of objects with some required keys and values that are used by the context browser to display each item to the user. Items may have nested sub-items called <code class="code code--inline">children</code>.</p><p>Use the following attribute to set the context browser items:</p><ul><li><code class="code code--inline">items: Array</code> - An array of objects that are used to populate the context browser UI.</li></ul><p>Each item should have at least the following properties:</p><ul><li><code class="code code--inline">id: string</code> - A unique string that identifies the item. This string should only contain valid ASCII characters. It's recommended to only use URI-safe characters to allow for easy binding to the URL. Examples: 'home' or 'alerts'.</li><li><code class="code code--inline">label: string</code> - A short, user-friendly text label for the item.</li></ul><p>The following optional properties can also be set:</p><ul><li><code class="code code--inline">children: Array</code> - An array of sub-item objects that are children of the item. Each child item should also have an id and label, and may have its own child items.</li><li><code class="code code--inline">isTerminal: boolean = false</code> - If true, the item <em>can never have</em> children. If false, the item can, but does not necessarily, have children.</li><li><code class="code code--inline">isSelectable: boolean = true</code> - If true, the item can be selected. If false, the item can't be selected, but it <em>can</em> be a parent.</li><li><code class="code code--inline">isExhausted: boolean = false</code> - If true, there are no more children to load for the item. If false, there are still children to load (see "Lazy loading children" below for more info).</li></ul><p>The following is an example of a list of valid context items:</p><pre class="code-block"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token property">"label"</span> <span class="token operator">:</span> <span class="token string">"Home"</span><span class="token punctuation">,</span>   <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token string">"home"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">"label"</span> <span class="token operator">:</span> <span class="token string">"Alerts"</span><span class="token punctuation">,</span> <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token string">"alerts"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token property">"label"</span> <span class="token operator">:</span> <span class="token string">"Assets"</span><span class="token punctuation">,</span> <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token property">"children"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token property">"label"</span> <span class="token operator">:</span> <span class="token string">"Asset #1"</span><span class="token punctuation">,</span> <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token string">"a1"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token property">"label"</span> <span class="token operator">:</span> <span class="token string">"Asset #2"</span><span class="token punctuation">,</span> <span class="token property">"id"</span> <span class="token operator">:</span> <span class="token string">"a2"</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><h4 id="convert-your-data-model">Convert your data model</h4><p>Many applications that will use the context browser have their own unique data model. The context browser API is designed to be flexible and suit different data models. To accomplish this, the context browser can be configured to read different keys in each of the <code class="code code--inline">items</code> objects to find the information it needs.</p><p>However, the context browser does have some requirements (e.g. a tree of nested items) that can't be changed. If your app uses a data model that doesn't meet these requirements, you will have to convert your data to use it in the context browser. This conversion can be done on the server before the data is sent to the client, or on the client in your app code before the items are set in the context browser.</p><p>Before starting a data model conversion, take the time to understand the basic concepts of the context browser and its data model (reading this guide is a good start!). Compare it with your app data model and come up with a list of ways the two differ. Then, if necessary, decide how and where to convert your data to work with the context browser.</p><p><strong>Changing the items keys:</strong></p><p>Some data models may use different keys to define information about each context item. For example, this context item defines its user-friendly name as <code class="code code--inline">asset_name</code>, and its unique identifier as <code class="code code--inline">asset_id</code>:</p><pre class="code-block"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"asset_name"</span><span class="token operator">:</span> <span class="token string">"California"</span><span class="token punctuation">,</span>
  <span class="token property">"asset_id"</span><span class="token operator">:</span> <span class="token string">"calif"</span>
<span class="token punctuation">}</span>
</code></pre><p>This data doesn't need to be manipulated to work in the context browser. The developer can set the <code class="code code--inline">keys</code> attribute on the context browser to change the keys the context browser reads for each item. The <code class="code code--inline">id</code>, <code class="code code--inline">label</code>, and <code class="code code--inline">children</code> keys can all be changed using this attribute:</p><ul><li><code class="code code--inline">keys: Object</code> Changes the item properties (keys) that will be used internally to find each item's unique ID, label, and child list. Use this property if you already have a predefined data schema for your application and want to customize this component to match your schema. Otherwise, it's recommended to leave the defaults.</li></ul><p>The following properties can be set:</p><ul><li><code class="code code--inline">id: string = "id"</code> - key to use for the unique ID of the item</li><li><code class="code code--inline">label: string = "label"</code> - key to use for the user-friendly label of the item</li><li><code class="code code--inline">children: string = "children"</code> - key to use for the array of child items</li></ul><p>To use the uniquely formatted data shown above, set the context browser <code class="code code--inline">keys</code> property:</p><pre class="code-block"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>px-context-browser</span>
  <span class="token attr-name">keys</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>{
    <span class="token punctuation">"</span>id<span class="token punctuation">"</span>: <span class="token punctuation">"</span>asset_id<span class="token punctuation">"</span>,
    <span class="token punctuation">"</span>name<span class="token punctuation">"</span>: <span class="token punctuation">"</span>asset_name<span class="token punctuation">"</span>,
    <span class="token punctuation">"</span>children<span class="token punctuation">"</span>: <span class="token punctuation">"</span>children<span class="token punctuation">"</span>
  }<span class="token punctuation">'</span></span>
  <span class="token attr-name">items</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>[
    {
      <span class="token punctuation">"</span>asset_id<span class="token punctuation">"</span>: <span class="token punctuation">"</span>calif<span class="token punctuation">"</span>,
      <span class="token punctuation">"</span>asset_name<span class="token punctuation">"</span>: <span class="token punctuation">"</span>California<span class="token punctuation">"</span>
    }
  ]<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>px-context-browser</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>If you want to configure any keys, <em>you must set all the keys</em> -- even keys that you do not want to change from their default value. If any of the keys are not defined, the context browser will fail.</p><h3 id="lazy-load-items">Lazy load items</h3><p>The context browser is designed to handle small and large trees of context items. While the context browser can handle very large trees (e.g. 20,000+ items with 12 levels of hierarchy), the limitation in displaying such a large amount of data is usually the long wait time required to request the data from a backend server. Preparing complex asset models on the server to send to the client may require many expensive computations to join different pieces of an asset tree together.</p><p>Apps loading a relatively small amount of asset data (i.e. &lt;100 items) should probably just send the entire tree to the client in one request if the server can easily handle the request in less than ~200ms. Apps with a large set of data that can't be returned in a single response from the server, or that will take more than 250ms to send the data back, should load only part of the tree and load any additional data ad hoc as the user navigates the context browser.</p><h4>Example: 4 regions, 10,000 trucks</h4><img class="gif" src="../../img/developer-guides/context-browser/context-browser-gif-lazy-load-trucks.gif"><p>For example, a trucking company with 10,000 trucks on the road that are grouped into a few regions should load just the top-level regions when the context browser is initialized. When the user navigates into a region to see its trucks, the app should load a subset of trucks that are in that region. If the user navigates away into another region, that region's trucks should be loaded, and so on. Once the trucks for a region are loaded they'll be available to the user instantly if they navigate away and return to view those trucks again.</p><h4 id="define-item-parent-states">Define item parent states</h4><p>When context items are defined for the context browser, they may or may not have children. The following are all the different "parent states" for a context item:</p><ul><li><strong>A context item can already have one or more children.</strong> When this context item is activated, its existing children will be displayed to the user. The app can load and add additional children to this context item at any time.</li><li><strong>A context item can not have children right now but can have children added at some point in the future. This item is "not exhausted."</strong> When this context item is activated, a blank panel will appear with a loading indicator and an event will be fired requesting the app add children. The app can load and add some or all of this item's children, clearing the loading indicator and showing those children in the context browser. The item's children can be loaded in batches of any size, and more can be added at any time.</li><li><strong>A context item can never have children. This item is "terminal".</strong> These items are generally at the bottom of the context tree and can't be drilled down into any further. The user can only select this item. There is no way to activate it and request its children.</li><li><strong>A context item can have children but never be selected. This item is "not selectable."</strong> These items are generally at the top of the context tree, and are only used to organize child items. These items usually do not have any data attached to them, and they can't be selected by the user as the current context. Tapping on this item will activate it and show its children, or will show a loading indicator if no children have been added.</li></ul><p>These states aren't mutually exclusive. An item can be in one or more of these states, and can move between these states over time. A few states can't be combined: an item can't be marked as terminal (never have children) and also be marked as not selectable. The user would have no way to interact with this item.</p><p>Applications can mark context items with these states to tell the context browser how to display them to the user, and to change the way the context browser interprets user interaction with these items. When the px-context-browser <code class="code code--inline">items</code> are first defined, the following keys can be set on an item:</p><ul><li><code class="code code--inline">children: Array</code> - An array of sub-item objects that are children of the item. Each child item should also have an id and label, and may have its own child items.</li><li><code class="code code--inline">isTerminal: boolean = false</code> - If true, the item <em>can never have children</em>. Tapping a terminal item selects it. If false, the item can have children, but may not have any right now. Items are not terminal by default.</li><li><code class="code code--inline">isExhausted: boolean = false</code> - If true, there are <em>no more children to load</em> for the item. If false, the item may still have some children available to be loaded from the server.</li><li><code class="code code--inline">isSelectable: boolean = true</code> - If true, the item <em>can be selected</em>. If false, the item can't be selected, but it can be a parent that displays children when the user navigates to it. Items are selectable by default.</li></ul><h4 id="lazy-loading-apis">Lazy loading APIs</h4><p>The following px-context-browser attributes can be used to implement lazy loading:</p><ul><li><code class="code code--inline">loading: boolean = false (read only)</code> - When the user activates an item with no children, an empty panel with a loading indicator is shown while the app requests and returns more children. This attribute will be set to true while the context browser waits for children to be added and notify the app with a <code class="code code--inline">loading-changed</code> event.</li><li><code class="code code--inline">loadingTimeout: number = 5000</code> - Set this attribute to change the amount of time the context browser will wait for children before clearing the loading view and returning the user back to the last visible parent. The time is set in milliseconds and defaults to 5 seconds.</li></ul><p>The following events are fired to help with lazy loading:</p><ul><li><code class="code code--inline">px-app-asset-children-requested</code> - Fired when the user activates an item in the context browser that is not exhausted. The <code class="code code--inline">event.detail.item</code> will contain a reference to the item the app should load and add children for. After the children are loaded, the app can call the <code class="code code--inline">addChildren</code> method with the <code class="code code--inline">event.detail.item</code> reference and the new children to update the context browser.</li></ul><p>The following methods can be used to implement lazy loading:</p><ul><li><code class="code code--inline">addChildren(node: Object, children: Object|Array&lt;Object&gt;, options: Object)</code> - Adds a child or children to the context item (<code class="code code--inline">node</code>). Pass a single object to add one child, or an array of objects to add multiple children. The node should be a direct reference to one of the objects already in the asset graph (e.g. one of the <code class="code code--inline">items</code> objects or another node added through the <code class="code code--inline">addChildren</code> API). To add children to the root of the graph, call with <code class="code code--inline">node</code> as null.</li><li><code class="code code--inline">removeChildren(node: Object, children: Object|Array&lt;Object&gt;, options: Object)</code>: Removes a child or children from the requested node. Pass a single object to add one child, or an array of objects to add multiple children. The node should be a direct reference to one of the objects already in the asset graph (e.g. one of the <code class="code code--inline">items</code> objects or another node added through the <code class="code code--inline">addChildren</code> API). To remove children from the root of the graph, call with <code class="code code--inline">node</code> as null.</li><li><code class="code code--inline">cancelLoading()</code>: Cancels the current child loading event, if one is in progress. Changes the active browser view to the parent of the item that was previously loading.</li></ul><h4 id="example-implement-lazy-loading">Example: implement lazy loading</h4><p>When the user activates an item that can have children but doesn't have any defined yet, the context browser will show an empty panel with a loading indicator. The context browser element fires a <code class="code code--inline">px-app-asset-children-requested</code> event when the user navigates into an item that isn't marked as exhausted. The app can listen for the children requested event to determine which item to get the children for, and make a request to the backend server to get those children. When the request is finished, the app should add any new children to context browser using the <code class="code code--inline">addChildren</code> method:</p><pre class="code-block"><code class="language-javascript"><span class="token keyword">var</span> contextBrowserEl <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'px-context-browser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
contextBrowserEl<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'px-app-asset-activated'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>item<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'us'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Fetch United States child assets from server and add them */</span>
    <span class="token function">fetchAssetsFromServer</span><span class="token punctuation">(</span><span class="token string">'us'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        contextBrowserEl<span class="token punctuation">.</span><span class="token function">addChildren</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>item<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>item<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token string">'ca'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* Fetch Canada child assets from server and add them */</span>
    <span class="token function">fetchAssetsFromServer</span><span class="token punctuation">(</span><span class="token string">'ca'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        contextBrowserEl<span class="token punctuation">.</span><span class="token function">addChildren</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>item<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>The following CodePen shows this all working together:</p><iframe height="320" scrolling="no" title="Context Browser: Lazy load children" src="//codepen.io/davidleonard/embed/LzmqBq/?height=265&amp;theme-id=light&amp;default-tab=js,result&amp;embed-version=2" frameborder="no" allowtransparency="true" allowfullscreen="true" style="width: 100%;"></iframe><h3 id="other-features">Other features</h3><h4 id="timeout-after-closing">Timeout after closing</h4><p>If the user opens the context browser, navigates to a different place in the context hierarchy, and closes the browser panel without selecting anything, the context browser will reset their active view after 5 seconds. The next time the user opens the context browser, the selected context item will be visible, or the root will be visible if no context item is selected. If the user re-opens the context browser before the 5 seconds is up, their active view will not be reset.</p><h4 id="pre-select-a-context">Pre-select a context</h4><p>A context item can be pre-selected when the context browser is first loaded using the <code class="code code--inline">selected-route</code> attribute. The selected route provides an additional way for apps to listen for context changes and to update the selected context from outside the browser. (See the "Handle user context selection" section above for the other approach to this using the <code class="code code--inline">selected</code> attribute.)</p><p>The selected route attribute represents a path through the tree:</p><ul><li><code class="code code--inline">selectedRoute: Array</code> - The route to the selected item as an array of strings. Use this property to set the selected item by route, or to bind to updates when the selected item is changed. Changing this property will automatically update the selected item.</li></ul><p>The route array starts at the top of the graph and ends with the selected item. Each piece of the route is a string that corresponds to the unique ID of a context item.</p><p>For example, given the following graph:</p><pre class="code-block"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"Dashboards"</span><span class="token punctuation">,</span>
    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"dash"</span><span class="token punctuation">,</span>
    <span class="token property">"children"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"Truck Statuses"</span><span class="token punctuation">,</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"trucks"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"Generator Alerts"</span><span class="token punctuation">,</span> <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"generators"</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><p>To select the "Truck Statuses" page, set the selected route attribute to:</p><pre class="code-block"><code class="language-json"><span class="token punctuation">[</span><span class="token string">"dash"</span><span class="token punctuation">,</span> <span class="token string">"trucks"</span><span class="token punctuation">]</span>
</code></pre><p>If the user then selects the "Generator Alerts" item, the route array would be updated to the following:</p><pre class="code-block"><code class="language-json"><span class="token punctuation">[</span><span class="token string">"dash"</span><span class="token punctuation">,</span> <span class="token string">"generators"</span><span class="token punctuation">]</span>
</code></pre></div></div><px-demo-footer></px-demo-footer></template><script>Polymer({is:'view-develop-context-browser',behaviors:[PxCatalogBehavior.Page],_dynamicTheme:!1,ready:function(){this._dynamicTheme&&this.setAttribute('dynamic-theme','')}});</script></dom-module></body></html>