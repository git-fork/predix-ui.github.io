(function(){'use strict';Polymer({is:'px-app-nav',behaviors:[Polymer.IronResizableBehavior,PxAppNavBehavior.MeasureText,PxAppBehavior.AssetGraph,PxAppBehavior.AssetSelectable],properties:{collapseAll:{type:Boolean,value:!1,observer:'_handleCollapseAllChanged',notify:!0},collapseAt:{type:Number,observer:'rebuild'},collapseWithIcon:{type:Boolean,value:!1},collapseOpened:{type:Boolean,value:!1,notify:!0},vertical:{type:Boolean,value:!1,reflectToAttribute:!0},verticalOpened:{type:Boolean,value:!1,notify:!0,readOnly:!0,reflectToAttribute:!0},visibleItems:{type:Array,notify:!0,readOnly:!0},overflowedItems:{type:Array,notify:!0,readOnly:!0},allCollapsed:{type:Boolean,value:!1,notify:!0,readOnly:!0,computed:'_computeAllCollapsed(overflowedItems,visibleItems)'},anyOverflowed:{type:Boolean,value:!1,notify:!0,readOnly:!0,computed:'_computeAnyOverflowed(overflowedItems,visibleItems)'},someOverflowed:{type:Boolean,value:!1,notify:!0,readOnly:!0,computed:'_computeSomeOverflowed(overflowedItems,visibleItems)'},fitInto:{type:HTMLElement},_availableWidth:{type:Number,observer:'rebuild'}},_statics:{ITEM_PADDING:'1rem',ITEM_ICON_WIDTH:'2rem',ITEM_ICON_PADDING:'0.33rem',OPEN_ICON_WIDTH:'1.33rem',OPEN_ICON_PADDING:'0.2rem'},observers:['_handleItemVisibilityChanged(visibleItems, overflowedItems, visibleItems.*, overflowedItems.*)'],listeners:{"iron-resize":'_handleResize',"px-app-nav-item-tapped":'_itemSelectedByEvent',mouseenter:'_handleMouseEnter',mouseleave:'_handleMouseLeave',"px-app-asset-graph-created":'rebuild',"px-app-nav-rebuilt":'_handleRebuild'},_handleRebuild(){if(!this.collapseAll&&!this.vertical&&this.anyOverflowed&&this.collapseOpened){if(!this._collapsedGroup){var a=Polymer.dom(this.root).querySelector('#overflowedGroup');if(!a)return;this._collapsedGroup=a}this._collapsedGroup.refitGroup()}},_handleMouseEnter(){this.vertical&&(this._mouseIsOverNav=!0,this.isDebouncerActive('close-nav-on-mouseleave')&&this.cancelDebouncer('close-nav-on-mouseleave'),this._mouseIsOverNav&&!this.verticalOpened&&this._setVerticalOpened(!0))},_handleMouseLeave(){this.vertical&&(this._mouseIsOverNav=!1,this.debounce('close-nav-on-mouseleave',function(){!this._mouseIsOverNav&&this.verticalOpened&&this._setVerticalOpened(!1)},250))},_handleItemVisibilityChanged(){this.debounce('item-visibility-changed',function(){const a=Polymer.dom(this.root).querySelector('#visible'),b=Polymer.dom(this.root).querySelector('#overflowed');a&&a.render(),b&&b.render()})},_handleCollapseAllChanged(a){a&&this.rebuild(),a||(this._availableWidth=null,this._handleResize())},_itemSelectedByEvent(a){a.detail.item&&this.select(a.detail.item,'DOM_EVENT')},_handleResize(){if(!(this.collapseAll||this.vertical)){const a='measure-available-width';return'number'===typeof this._availableWidth?void(this.isDebouncerActive(a)&&this.cancelDebouncer(a),this.debounce(a,this._measureAvailableWidth.bind(this),100)):void this._measureAvailableWidth()}},_measureAvailableWidth(){window.requestAnimationFrame(()=>{const a=this.$.container,b=this.$.actions;if(a&&b){const c=a.getBoundingClientRect().width,d=b.getBoundingClientRect().width,e=c-d;this._availableWidth!==e&&this.set('_availableWidth',e)}})},rebuild(){if(this.items&&Array.isArray(this.items)&&(this.collapseAll||this.vertical||'number'===typeof this._availableWidth)){if(this.vertical)return this._setVisibleItems(this.items.slice(0)),this._setOverflowedItems([]),[this.visibleItems,this.overflowedItems];if(this.collapseAll||0===this._availableWidth||'number'===typeof this.collapseAt&&this._availableWidth<=this.collapseAt)return this._setVisibleItems([]),this._setOverflowedItems(this.items.slice(0)),this.fire('px-app-nav-rebuilt'),[this.visibleItems,this.overflowedItems];const a=this._measureItems(this.items),{visible:b,overflowed:c}=this._fitItems(this.items,a,this._availableWidth);return 1===b.length&&1<this.items.length?(this._setVisibleItems([]),this._setOverflowedItems(this.items.slice(0)),this.fire('px-app-nav-rebuilt'),[this.visibleItems,this.overflowedItems]):(this._setVisibleItems(b),this._setOverflowedItems(c),this.notifyPath('visibleItems.*'),this.notifyPath('overflowedItems.*'),this.fire('px-app-nav-rebuilt'),[this.visibleItems,this.overflowedItems])}},_fitItems(a,b,c){let d=c;if(d<b[0])return{visible:[],overflowed:a.slice(0)};let e=0,f=a.length;for(;e<f&&0<d&&!(b[e]>d);)d-=b[e],e++;const{itemPadding:g,iconSize:h}=this._getItemStyles();let i=2*g+h;if(e!==f&&d<i)for(d-=i;0<e&&0>d;)d+=b[e],e--;return{visible:a.slice(0,e),overflowed:a.slice(e)}},_measureItems(a){const b=this._measureItem.bind(this);return a.map(b)},_measureItem(a){const{fontFamily:b,fontSize:c,itemPadding:d,iconSize:e,iconPadding:f,openIconSize:g,openIconPadding:h}=this._getItemStyles(),i=this._measureText(a[this.keys.label],b,c);if(!i)return;let j=i;return j+=2*d,a[this.keys.icon]&&a[this.keys.icon].length&&(j+=e+f),a[this.keys.children]&&a[this.keys.children].length&&(j+=g+h),j},_getItemStyles(){if(!this._fontStyleCache){const{fontSize:a,fontFamily:b}=window.getComputedStyle(this),c=(a)=>this._remToPx(parseFloat(a)),d=(b,d)=>this._parseSizeStyleVar(b,c(d),parseInt(a)),e=d('--px-app-nav-item-padding',this._statics.ITEM_PADDING),f=d('--px-app-nav-item-icon-size',this._statics.ITEM_ICON_WIDTH),g=c(this._statics.ITEM_ICON_PADDING),h=c(this._statics.OPEN_ICON_WIDTH),i=c(this._statics.OPEN_ICON_PADDING);this._fontStyleCache={fontSize:a,fontFamily:b,itemPadding:e,iconSize:f,iconPadding:g,openIconSize:h,openIconPadding:i}}return this._fontStyleCache},_parseSizeStyleVar(a,b,c){const d=this.getComputedStyleValue(a);return'string'===typeof d&&'px'===d.slice(-2)?parseInt(d):'string'===typeof d&&'em'===d.slice(-2)?c*parseFloat(d):'string'===typeof d&&'rem'===d.slice(-2)?this._remToPx(parseFloat(d)):b},_remToPx(a){const b=this._documentRemBaseCache=this._documentRemBaseCache||parseInt(window.getComputedStyle(document.documentElement).fontSize);return Math.round(a*b)},_getDropdownLabel(a,b,c,d,e){return e&&b&&'object'===typeof b&&!d?b[c]:e&&a&&'object'===typeof a&&!d?a[c]:null},_getDropdownIcon(a,b,c,d,e,f,g){return f&&!e?'px-utl:overflow':e&&d&&!g?'px-nav:hamburger':e&&d&&g?'px-nav:close':e&&b&&'object'===typeof b?b[c]:e&&a&&'object'===typeof a?a[c]:null},_getDropdownWidth(a){if(a){const a=parseInt(this.getComputedStyleValue('--px-app-nav-collapsed-width'));return isNaN(a)?320:a}},_getItemProp(a,b){return a[b]},_isCollapsedCaratHidden(a,b){return!a||b},_isCollapsedDropdownEmpty(a,b,c){return b&&!c&&(!a||'object'!==typeof a)},_isItemSelected(a,b){return a&&b&&a===b},_isItemVisible(a){return a&&this.visibleItems&&Array.isArray(this.visibleItems)&&-1!==this.visibleItems.indexOf(a)},_isItemOverflowed(a){return a&&this.overflowedItems&&Array.isArray(this.overflowedItems)&&-1!==this.overflowedItems.indexOf(a)},_isItemParent(a,b){return a.hasOwnProperty(b)&&Array.isArray(a[b])&&0<a[b].length},_isItemNotParent(a,b){return!a.hasOwnProperty(b)||!Array.isArray(a[b])||0===a[b].length},_isSelectedOverflowed(a,b,c){return a&&c&&Array.isArray(c)&&c.length&&(b?-1!==c.indexOf(b):-1!==c.indexOf(a))},_isIconEmpty(a,b){return!a.hasOwnProperty(b)||'string'!==typeof a[b]&&0<=a[b].length},_computeAnyOverflowed(a){return Array.isArray(a)&&0<a.length},_computeAllCollapsed(a,b){return Array.isArray(a)&&0<a.length&&Array.isArray(b)&&0===b.length},_computeSomeOverflowed(a,b){return Array.isArray(a)&&0<a.length&&Array.isArray(b)&&0<b.length}})})();