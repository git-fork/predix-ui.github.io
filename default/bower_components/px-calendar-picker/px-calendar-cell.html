<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-datetime-common/px-datetime-range-behavior.html"><link rel="import" href="css/px-calendar-picker-styles.html"></head><body><dom-module id="px-calendar-cell"><template><style include="px-calendar-picker-styles"></style><div class$="{{cellStyles}}"><button class$="{{btnStyles}} btn--calendar-cell" type="button" value="{{displayedValue}}" on-tap="_selectDate" disabled="{{isDisabled}}" hidden$="{{!isValidDate}}">{{displayedValue}}</button></div></template></dom-module><script>Polymer({is:'px-calendar-cell',behaviors:[PxDatetimeBehavior.BlockDates,PxDatetimeBehavior.RangeMoments],properties:{displayDate:{type:Object,value:function(){return{}},observer:'_updateDate'},displayMode:{type:String,value:'day'},blockDatesAfter:{type:Object,value:function(){return{}}},blockDatesBefore:{type:Object,value:function(){return{}}}},observers:['_updateNeeded(displayDate, fromMoment, toMoment, displayMode, blockDatesAfter, blockDatesBefore, blockFutureDates, blockPastDates)'],ready:function(){this._updateDate()},_updateNeeded:function(){this._updateDate()},_updateDate:function(){if(void 0!==this.displayDate&&void 0!==this.fromMoment&&void 0!==this.toMoment&&void 0!==this.displayMode&&void 0!==this.blockDatesAfter&&void 0!==this.blockDatesBefore&&void 0!==this.blockFutureDates&&void 0!==this.blockPastDates&&void 0!==this.displayDate){var a=this;this.debounce('updateDate',function(){var b='calendar-cell',c='btn btn--bare',d=!1;if(a.set('isValidDate',a.displayDate.isValid()),!a.isValidDate)a.set('displayedValue','');else{switch(a.displayMode){case'day':a.set('displayedValue',a.displayDate.format('D'));break;case'month':a.set('displayedValue',a.displayDate.format('MMM'));break;case'year':a.set('displayedValue',a.displayDate.format('YYYY'));}a.blockFutureDates&&a._isPastTodaysDate()||a.blockPastDates&&a._isBeforeTodaysDate()||0<Object.keys(a.blockDatesAfter).length&&a.displayDate.isAfter(a.blockDatesAfter,'day')||0<Object.keys(a.blockDatesBefore).length&&a.displayDate.isBefore(a.blockDatesBefore,'day')?(c+=' btn--disabled',d=!0):((a._isStartOfRange()||a._isEndOfRange())&&(b+=' is-selected'),a._isSingleSelected()&&(b+=' is-selected-only'),(a._isStartOfWeekOrMonth()||a._isStartOfRange())&&(b+=' is-start'),(a._isEndOfWeekOrMonth()||a._isEndOfRange())&&(b+=' is-end'),a._isWithinRange()&&(b+=' is-between'),a._isTodaysDate()&&(b+=' is-today'))}a.set('btnStyles',c),a.set('isDisabled',d),a.set('cellStyles',b)})}},_selectDate:function(){this.fire('px-cell-date-selected',this.displayDate)},_isStartOfRange:function(){return this.fromMoment&&this.displayDate.isSame(this._getStartDate(),this.displayMode)},_isEndOfRange:function(){return this.toMoment&&this.displayDate.isSame(this._getEndDate(),this.displayMode)},_isWithinRange:function(){return this.fromMoment&&this.toMoment&&this.displayDate.isBetween(this._getStartDate(),this._getEndDate(),this.displayMode)},_getStartDate:function(){var a=this.fromMoment;return this.toMoment&&this.fromMoment.isAfter(this.toMoment,this.displayMode)&&(a=this.toMoment),a},_getEndDate:function(){var a=this.toMoment;return this.fromMoment&&this.fromMoment.isAfter(this.toMoment,this.displayMode)&&(a=this.fromMoment),a},_isSingleSelected:function(){var a=this.fromMoment&&(!this.toMoment||!this.toMoment.isValid())&&this.displayDate.isSame(this.fromMoment,this.displayMode),b=this.toMoment&&(!this.fromMoment||!this.fromMoment.isValid())&&this.displayDate.isSame(this.toMoment,this.displayMode);return a||b},_isStartOfWeekOrMonth:function(){switch(this.displayMode){case'day':return 1===this.displayDate.date()||0===this.displayDate.weekday();case'month':return 0===this.displayDate.month()||4===this.displayDate.month()||8===this.displayDate.month();case'year':return 1===this.displayDate.year()%10||6===this.displayDate.year()%10;}},_isEndOfWeekOrMonth:function(){switch(this.displayMode){case'day':return this.displayDate.date()===this.displayDate.daysInMonth()||6===this.displayDate.weekday();case'month':return 3===this.displayDate.month()||7===this.displayDate.month()||11===this.displayDate.month();case'year':return 5===this.displayDate.year()%10||0===this.displayDate.year()%10;}},_isPastTodaysDate:function(){var a=Px.moment().tz(this.timeZone);return this.displayDate.isAfter(a,'day')},_isBeforeTodaysDate:function(){var a=Px.moment().tz(this.timeZone);return this.displayDate.isBefore(a,'day')},_isTodaysDate:function(){var a=Px.moment().tz(this.timeZone);return this.displayDate.isSame(a,'day')}});</script></body></html>