<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-calendar-cell.html"><link rel="import" href="../px-datetime-common/px-datetime-range-behavior.html"><link rel="import" href="../px-datetime-common/px-datetime-behavior.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="css/px-calendar-picker-styles.html"></head><body><dom-module id="px-calendar-picker"><template><style include="px-calendar-picker-styles"></style><div class$="{{_getTableClass(shrink)}}" id="calendar"><div class="caption"><button type="button" on-tap="_onPrevious" class="actionable actionable--action title-color nextLastBtn"><template is="dom-if" if="{{!hidePreviousButton}}"><px-icon icon="px-nav:back" class="arrow"></px-icon></template></button> <button on-tap="_onNextDisplayMode" class="actionable actionable--action title-color">[[_title]]</button> <button id="btnNextMonth" type="button" on-tap="_onNext" class="actionable actionable--action title-color nextLastBtn"><template is="dom-if" if="{{!hideNextButton}}"><px-icon icon="px-nav:next" class="arrow"></px-icon></template></button></div><template is="dom-if" if="{{_isDayMode(_currentDisplayMode)}}"><div class="tr"><template is="dom-repeat" items="{{daysOfTheWeek}}" as="dayOfTheWeek"><div class="th caps">[[dayOfTheWeek]]</div></template></div></template><template is="dom-repeat" items="{{_valuesDisplayed}}" as="week" strip-whitespace=""><div class="tr"><template is="dom-repeat" items="{{week}}" as="date" strip-whitespace=""><div class="td"><px-calendar-cell display-date="{{date}}" from-moment="[[fromMoment]]" to-moment="[[toMoment]]" block-future-dates="{{blockFutureDates}}" block-past-dates="{{blockPastDates}}" display-mode="{{_currentDisplayMode}}" block-dates-after="[[maxDate]]" block-dates-before="[[minDate]]"></px-calendar-cell></div></template></div></template></div></template></dom-module><script>Polymer({is:'px-calendar-picker',behaviors:[PxDatetimeBehavior.Range],properties:{baseDate:{type:Object,notify:!0,value:function(){return Px.moment.tz(Px.moment(),this.timeZone)},observer:'_baseDateChanged'},_oldBaseDate:{type:Object},displayMode:{type:String,value:'day',observer:'_displayModeChanged'},_currentDisplayMode:{type:String,observer:'_currentDisplayModeChanged',value:'day'},preventRangeSelection:{type:Boolean,value:!1},hidePreviousButton:{type:Boolean,value:!1},hideNextButton:{type:Boolean,value:!1},shrink:{type:Boolean,value:!1},isAtSelectionLevel:{type:Boolean,computed:'_isAtSelectionLevel(_currentDisplayMode, displayMode)'},_valuesDisplayed:{type:Array,value:function(){return[]}},waitToFire:{type:Boolean,value:!1},_title:{type:String}},observers:['_renderCurrent(_currentDisplayMode)','_localeChanged(language)','_getCurrentTitle(_currentDisplayMode, baseDate)','_timeZoneChanged(timeZone)'],ready:function(){this.daysOfTheWeek=this._getDaysOfTheWeek();var a=this._cellClicked.bind(this);this.addEventListener('px-cell-date-selected',a),this.toMoment=null,this.fromMoment=null},_localeChanged:function(){Px.moment&&this.baseDate&&this._currentDisplayMode&&(this.daysOfTheWeek=this._getDaysOfTheWeek(),this.set('baseDate',this.baseDate.locale(Px.moment.locale())),this._getCurrentTitle(this._currentDisplayMode,this.baseDate),this._renderCurrent())},_timeZoneChanged:function(){this.baseDate&&this.set('baseDate',Px.moment.tz(this.baseDate,this.timeZone))},_getTableClass:function(a){var b='table table--no-cells text--center ';return a||(b+='constantSize '),b},_cellClicked:function(a){var b=a.detail,c=a.detail.clone();'year'===this._currentDisplayMode?'year'===this.displayMode?(this._selectDate(b),this.fire('px-date-selected',c)):(this.set('baseDate',b),this.set('_currentDisplayMode','month'),a.stopPropagation()):'month'===this._currentDisplayMode?'month'===this.displayMode?(this._selectDate(b),this.fire('px-date-selected',c)):(this.set('baseDate',b),this.set('_currentDisplayMode','day'),a.stopPropagation()):(this._selectDate(b),this.fire('px-date-selected',c))},_displayModeChanged:function(){this.displayMode!==void 0&&this.set('_currentDisplayMode',this.displayMode)},_currentDisplayModeChanged:function(){if('year'===this._currentDisplayMode){for(var a=this.baseDate.year(),b=0;10>b&&!(1===(a-b)%10);b++);this.set('baseDate',this.baseDate.clone().subtract(b,'years'))}else this._renderCurrent()},_isDayMode:function(a){return'day'===a},_onNextDisplayMode:function(){'day'===this._currentDisplayMode?this.set('_currentDisplayMode','month'):'month'===this._currentDisplayMode&&this.set('_currentDisplayMode','year')},_getCurrentTitle:function(a,b){void 0===a||void 0===b||null===b||('day'===a?this.set('_title',b.format('MMMM')+' '+b.format('YYYY')):'month'===a?this.set('_title',b.format('YYYY')):this.set('_title',b.format('YYYY')+' - '+b.clone().add(9,'years').format('YYYY')))},_getDaysOfTheWeek:function(){for(var a=Px.moment().startOf('week'),b=[],c=0;7>c;c++)b.push(a.format('dd')),a.add(1,'days');return b},_renderCurrent:function(){var a;a='day'===this._currentDisplayMode?this._constructMonth():'month'===this._currentDisplayMode?this._constructYear():this._constructYearRange(),this.set('_valuesDisplayed',a)},_selectDate:function(a){this.preventRangeSelection||!this.fromMoment||this.toMoment?(this.set('toMoment',null),this.set('fromMoment',this._preserveTime(this.fromMoment,a)),this.preventRangeSelection&&this.fire('px-calendar-selected',{momentObj:this.fromMoment})):(a.isBefore(this.fromMoment)?(this.set('toMoment',this.fromMoment),this.set('fromMoment',this._preserveTime(this.fromMoment,a))):this.set('toMoment',this._preserveTime(this.toMoment,a)),this.fire('px-calendar-range-selected',{momentObjs:{from:this.fromMoment,to:this.toMoment}}))},_constructYear:function(){for(var a=this.baseDate.clone().month(0),b=[],c=0;3>c;c++){b[c]=[];for(var d=0;4>d;d++)b[c].push(a),a=a.clone().add(1,'months')}return b},_constructYearRange:function(){for(var a=this.baseDate.clone(),b=[],c=0;2>c;c++){b[c]=[];for(var d=0;5>d;d++)b[c].push(a),a=a.clone().add(1,'years')}return b},_constructMonth:function(){if(this.baseDate){var a=this.baseDate.daysInMonth(),b=this.baseDate.clone().startOf('month').day(),c=Px.moment.localeData().firstDayOfWeek(),d=b-c,e=1,f=[];0>d&&(d+=7);for(var g=[],h=0;h<d;h++)g.push(Px.moment(null));for(var i=0;i<6;i++){for(;7>g.length;)e<=a?(g.push(this.baseDate.clone().date(e)),e++):g.push(Px.moment(null));f.push(g),g=[]}return f}},_onNext:function(){var a;a='day'===this._currentDisplayMode?Px.moment.tz(this.baseDate.add(1,'months'),this.timeZone):'month'===this._currentDisplayMode?Px.moment.tz(this.baseDate.add(1,'years'),this.timeZone):Px.moment.tz(this.baseDate.add(10,'years'),this.timeZone),this.set('baseDate',a),this._renderCurrent()},_onPrevious:function(){var a;a='day'===this._currentDisplayMode?Px.moment.tz(this.baseDate.subtract(1,'months'),this.timeZone):'month'===this._currentDisplayMode?Px.moment.tz(this.baseDate.subtract(1,'years'),this.timeZone):Px.moment.tz(this.baseDate.subtract(10,'years'),this.timeZone),this.set('baseDate',a),this._renderCurrent()},_isAtSelectionLevel:function(a,b){return a===b},_baseDateChanged:function(a){if(void 0===a||null===a)return void(this._oldBaseDate&&(this.baseDate=this._oldBaseDate));this._oldBaseDate?'day'===this._currentDisplayMode&&(a.isAfter(this._oldBaseDate,'month')||a.isBefore(this._oldBaseDate,'month'))?this._renderCurrent():a.isAfter(this._oldBaseDate,'year')||a.isBefore(this._oldBaseDate,'year')?this._renderCurrent():this._oldBaseDate&&a&&a.tz()!==this._oldBaseDate.tz()&&this._renderCurrent():this._renderCurrent();this._oldBaseDate=this.baseDate}});</script></body></html>