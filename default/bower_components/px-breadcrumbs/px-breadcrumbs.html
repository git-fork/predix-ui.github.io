<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../px-dropdown/px-dropdown.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-graph.html"><link rel="import" href="../px-app-helpers/px-app-asset/px-app-asset-behavior-selectable.html"><link rel="import" href="css/px-breadcrumbs-styles.html"></head><body><dom-module id="px-breadcrumbs"><template><style include="px-breadcrumbs-styles"></style><div class="container flex"><ul class="topPath"><template is="dom-repeat" items="[[_mainPathItems]]"><template is="dom-if" if="[[_isNotFirstItemInData(index, _mainPathItems)]]"><li class="breadcrumbTopItem flex flex--middle"><span class$="rightAngle [[_getSeparatorSize(clickOnlyMode)]]"><px-icon icon="px-utl:chevron-right"></px-icon></span></li></template><li data-text="[[_getItemProp(item, keys.label)]]" data-item="[[item]]" data-index="[[index]]" class$="breadcrumbTopItem u-ph- flex flex--row flex--middle [[_getDisabled(item)]]" on-tap="_onPathTap"><template is="dom-if" if="[[_isLabel(item, clickOnlyMode)]]"><span class="actionable actionable--action">[[_getItemProp(item, keys.label)]]</span></template><template is="dom-if" if="[[_isDropdown(item, clickOnlyMode)]]"><px-dropdown display-value="[[_getItemProp(item, keys.label)]]" items="[[_clickedItemChildren]]" search-mode="[[searchMode]]" button-style="bare" disable-clear=""></px-dropdown></template><template is="dom-if" if="[[_isOverflow(item)]]"><px-dropdown id="dropdown" items="[[_clickedItemChildren]]" button-style="icon" icon="px-nav:more"></px-dropdown></template></li></template></ul></div></template></dom-module><script>(function(){class a{constructor(a,b,c,d=[],e){return this.keys=e,this.breadcrumbEl=a,this.graph=b,this.clickOnlyMode=c,this.breadcrumbs=d,this.map=new WeakMap,this.ctx=this._createCanvas(a),this._preShortenItems(this.breadcrumbs),this}get sizeOfFullBreadcrumbs(){return this.__sizeOfFullBreadcrumbs=this.__sizeOfFullBreadcrumbs||this._calculateSizeOfBreadcrumbs(this.breadcrumbs),this.__sizeOfFullBreadcrumbs}get sizeOfAllShortenedItemsExcludingLastItem(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(0,this.breadcrumbs.length-1),!1)}get sizeOfFullLastItem(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1))}get sizeOfShortLastItem(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs.slice(-1),!1)}get lastItemFull(){return this.breadcrumbs.slice(-1)[0]}get lastItemShort(){return this.shortenedItems.slice(-1)[0]}get shortenedItems(){return this.__shortenedItems=this.__shortenedItems||this.breadcrumbs.map((a)=>{var b={source:a,isTruncated:!0},c=this.keys.label,d=this.keys.children;return b[c]=this._getShortenedText(a),b[d]=this._getItemProp(a,this.keys.children),b.selectedItem=a.selectedItem,b.hasChildren=a.hasChildren,b}),this.__shortenedItems}get sizeOfEllipsis(){return 36}get sizeOfAllShortenedItems(){return this._calculateSizeOfBreadcrumbs(this.breadcrumbs,!1)}get allShortenedItemsExcludingLast(){return this.shortenedItems.slice(0,this.shortenedItems.length-1)}_addToWeakMap(a){const b=this.map.get(a)||null;b||this.map.set(a,a)}_preShortenItems(a){for(let b of a)this._getShortenedText(b)}_getShortenedText(a){const b=this.map.get(a)||{},c=this._getItemProp(a,this.keys.label);return!b.shortText&&13<c.length?b.shortText=`${c.substr(0,6)}...${c.substr(c.length-6)}`:!b.shortText&&(b.shortText=c),this.map.set(a,b),b.shortText}_sizeOfIndividualFullItem(a){const b=this.map.get(a)||{},c=this._getItemProp(a,this.keys.label);return b.fullSize=b.fullSize||parseInt(this.ctx.measureText(c).width,10),this.map.set(a,b),b.fullSize}_sizeOfIndividualShortItem(a){const b=this.map.get(a)||{};return b.shortSize=b.shortSize||parseInt(this.ctx.measureText(b.shortText).width,10),this.map.set(a,b),b.shortSize}_calculateSizeOfBreadcrumbs(a,b=!0){if(a){let d,e=0,f=0,g=a.length;for(f=0;f<g;f++,d=null){d=b?this._sizeOfIndividualFullItem(a[f]):this._sizeOfIndividualShortItem(a[f]);var c=a[f].source?a[f].source:a[f];e+=d,'...'!==this._getItemProp(a[f],this.keys.label)&&this.graph.hasSiblings(c)&&!this.clickOnlyMode&&(e+=21),e+=20,f!==g-1&&(e+=this.clickOnlyMode?30:15)}return e+10}}_createCanvas(a){var b=window.getComputedStyle(a,null),c=b.getPropertyValue('font-size'),d=b.getPropertyValue('font-family');const e=document.createElement('canvas');e.height=20,e.width=9999;const f=e.getContext('2d');return f.font=c+' '+d,f}_getItemProp(a,b){return a&&'object'===typeof a&&'string'===typeof b&&a.hasOwnProperty(b)?a[b]:null}}window.pxBreadcrumbs={},window.pxBreadcrumbs.Breadcrumbs=a,Polymer({is:'px-breadcrumbs',behaviors:[PxAppBehavior.AssetGraph,PxAppBehavior.AssetSelectable,Polymer.IronResizableBehavior],properties:{_mainPathItems:{type:Array,value:function(){return[]},readOnly:!0},_clickPathItem:{type:Object,value:function(){return{}}},_clickedItemChildren:{type:Array,value:function(){return[]}},_selectedItem:{type:Object},_ulWidth:{type:Number,value:0},_selectedItemPath:{type:Array,value:function(){return[]},readOnly:!0},clickOnlyMode:{type:Boolean,value:!1,observer:'_getBreadcrumbsObj'},searchMode:{type:Boolean,value:!1},_hideNoResultLi:{type:Boolean,value:!0},_breadcrumbsObj:{type:Object}},listeners:{"iron-resize":'_onResize',"px-app-asset-selected":'_onSelect',"px-dropdown-selection-changed":'_dropdownTap',"px-app-asset-graph-created":'_getBreadcrumbsObj'},observers:['_getDisplayMode(_ulWidth, _selectedItemPath, _breadcrumbsObj)'],detached(){this.isDebouncerActive('windowResize')&&this.cancelDebouncer('windowResize')},_getItemProp(a,b){return a&&'object'===typeof a&&'string'===typeof b&&a.hasOwnProperty(b)?a[b]:null},_onResize(){this.debounce('windowResize',()=>{window.requestAnimationFrame(()=>{var a=Polymer.dom(this.root).querySelector('.container'),b=Polymer.dom(a).querySelector('ul'),c=b.getBoundingClientRect();this.set('_ulWidth',c.width)})},50)},_getBreadcrumbsObj(){var a=this._selectedItemPath||[],b=this._assetGraph,c=this.clickOnlyMode;a.length&&b&&(this.set('_breadcrumbsObj',new window.pxBreadcrumbs.Breadcrumbs(this,b,c,a,this.keys)),this.updateStyles())},_getDisplayMode(){var a=this._ulWidth,b=this._selectedItemPath||[],c=this._breadcrumbsObj;if(a&&b&&c){if(a>c.sizeOfFullBreadcrumbs)return void this._set_mainPathItems(b);if(a>c.sizeOfAllShortenedItemsExcludingLastItem+c.sizeOfFullLastItem){let a=c.allShortenedItemsExcludingLast.concat(c.lastItemFull);return void this._set_mainPathItems(a)}if(a>c.sizeOfAllShortenedItems){let a=c.shortenedItems;return void this._set_mainPathItems(a)}this._set_mainPathItems(this._createArrayWithOverflow(b,a,c))}},_createArrayWithOverflow(a,b,c){var d=0,e=c.sizeOfAllShortenedItemsExcludingLastItem,f=c.sizeOfFullLastItem,g=!1,h={},i=[],j=this.keys.label,k={};for(k.hasChildren=!0,k[j]='...';b<36+e+f;){if(d===a.length-1){g=!0;break}var l=c._sizeOfIndividualShortItem(a[d]);e-=l,d++}var m=this.keys.children;return k[m]=a.slice(0,d),k[m].forEach((a)=>{a.highlighted=!1}),h=g?c.lastItemShort:c.lastItemFull,i=[k].concat(c.shortenedItems.slice(d,a.length-1)).concat(h),i},_isNotFirstItemInData(a){return 0!==a},_onSelect(a){this._set_selectedItemPath(a.detail.path),this._getBreadcrumbsObj()},_doesItemHaveSiblings(a){var b=this._assetGraph,c=a.source?a.source:a,d=!('...'!==this._getItemProp(a,this.keys.label));return!!d||b.hasSiblings(c)},_dropdownTap(a){a=Polymer.dom(a);var b,c=a.rootTarget;c&&c.items&&(b=c.items.find((b)=>{let c=this._getItemProp(b,this.keys.id);if(c===a.event.detail.key)return b})),this._changePathFromClick(b||{})},_changePathFromClick(a){this.select(a),this.fire('px-breadcrumbs-item-changed',a)},_onPathTap(a){var b=a.model.item.source?a.model.item.source:a.model.item,c=!('...'!==this._getItemProp(b,this.keys.label));if(!1!==b.isSelectable){if(this.clickOnlyMode&&!c)return void this._changePathFromClick(b);if(this._doesItemHaveSiblings(b)||c){var d=this._assetGraph,e=c?this._getItemProp(b,this.keys.children):d.getSiblings(b),f=e.map((a)=>Object.assign({},a,{key:this._getItemProp(a,this.keys.id),val:this._getItemProp(a,this.keys.label),disabled:!1===a.isSelectable}));this.set('_clickedItemChildren',f),this.set('_clickPathItem',b)}else this.set('_clickedItemChildren',[]),this._changePathFromClick(b)}},_isLabel(a,b){return b&&'...'!==this._getItemProp(a,this.keys.label)||!b&&!this._doesItemHaveSiblings(a)},_isDropdown(a,b){return!b&&'...'!==this._getItemProp(a,this.keys.label)&&this._doesItemHaveSiblings(a)},_isOverflow(a){return'...'===this._getItemProp(a,this.keys.label)},_getSeparatorSize(){return this.clickOnlyMode?'small':'large'},_getDisabled(a){return!1===a.isSelectable?'disabled':''}})})();</script></body></html>