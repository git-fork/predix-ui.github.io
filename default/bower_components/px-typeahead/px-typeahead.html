<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../promise-polyfill/promise-polyfill-lite.html"><link rel="import" href="../iron-ajax/iron-ajax.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="css/px-typeahead-styles.html"></head><body><dom-module id="px-typeahead"><template><style include="px-typeahead-styles"></style><template is="dom-if" if="{{prefetchUrl}}"><iron-ajax auto="" url="{{prefetchUrl}}" handle-as="json" last-response="{{_prefetchedCandidates}}"></iron-ajax></template><div class="search__form"><input id="search" class="text-input search__box" disabled$="[[disabled]]" placeholder="{{placeholder}}" value="{{inputValue::input}}" on-keydown="_keydown" on-focus="_onfocus" on-blur="_onblur" on-input="_onSearchInputChange" autocomplete="off" required="[[required]]"><px-icon class$="search__icon [[_disabledClass(disabled)]]" icon="px-utl:search"></px-icon></div><template is="dom-if" if="{{_isSuggestionsEmpty(_suggestions)}}"><div class="dropdown__container"><ul id="searchResults" class="list-bare"><template is="dom-repeat" items="[[_boldResults(_suggestions.*, inputValue)]]"><li on-tap="_select" on-mouseover="_onhover" on-keydown="_keydown" class="result">[[item.prefix]]<span class="bold">[[item.highlight]]</span>[[item.suffix]]</li></template></ul></div></template></template></dom-module><script>Polymer({is:'px-typeahead',properties:{disabled:{type:Boolean,value:!1},placeholder:{type:String,value:'Enter Your Search Query'},localCandidates:{type:Array,value:function(){return[]}},prefetchUrl:{type:String,value:''},_prefetchedCandidates:{type:Array,value:function(){return[]}},_suggestions:{type:Array,value:function(){return[]},notify:!0},maxSuggestions:{type:Number,value:5,notify:!0},remoteUrl:{type:String,value:''},remoteUrlSearching:{type:Boolean,value:!1,notify:!0},value:{type:String,notify:!0},inputValue:{type:String,notify:!0,observer:'_search'},_isFocused:{type:Boolean,value:!1},required:{type:Boolean,value:!1,observer:'_requiredChanged'}},behaviors:[Polymer.IronResizableBehavior],listeners:{"iron-resize":'_setSearchResultSize'},ready:function(){document.addEventListener('click',function(){for(var a=document.querySelectorAll('px-typeahead'),b=0,c=a.length;b<c;b++)a[b]._suggestions=[]})},_setSearchResultSize:function(){if(this.$$('#searchResults')){var a=this.$.search.getBoundingClientRect();this.$$('#searchResults').style.width=a.width+'px'}},_isSuggestionsEmpty:function(){return this._suggestions.length},_keydown:function(a){40===a.which?(a.preventDefault(),this._downArrowPress(a)):38===a.which?(a.preventDefault(),this._upArrowPress(a)):13===a.which?this._enterPress(a):8===a.which?this._backspacePress(a):this._checkIfSingleResult(a)},_onhover:function(a){var b=Polymer.dom(this.root).querySelector('.item-selected');b&&b.classList.remove('item-selected'),a.currentTarget.classList.add('item-selected')},_onfocus:function(){this.set('_isFocused',!0)},_onblur:function(){this.set('_isFocused',!1),this.toggleClass('validation-error',this.required&&!this.value,this.$.search)},_onSearchInputChange:function(a){this.fire('px-typeahead-search-input-change',a)},_select:function(a){var b=a.currentTarget,c=b.textContent.trim();this.$.search.focus(),this.set('inputValue',c),this.set('value',c),this.async(function(){this.set('_suggestions',[])},100),this.toggleClass('validation-error',this.required&&!this.value,this.$.search),this.fire('px-typeahead-item-selected',this.value),a.stopPropagation()},_downArrowPress:function(){var a,b,c=Polymer.dom(this.root).querySelector('.item-selected'),d=Polymer.dom(this.root).querySelector('ul');if(!c)d&&(b=d.getElementsByTagName('li'),a=b[0],a&&a.classList.add('item-selected'));else if(a=c.nextElementSibling,a&&'LI'===a.tagName)c.classList.remove('item-selected'),a.classList.add('item-selected'),d.scrollTop=a.offsetTop;else return},_upArrowPress:function(){var a,b,c=Polymer.dom(this.root).querySelector('.item-selected'),d=Polymer.dom(this.root).querySelector('ul');if(!c)d&&(b=d.getElementsByTagName('li'),a=b[0],a&&a.classList.add('item-selected'));else if(a=c.previousElementSibling,a&&'LI'===a.tagName)c.classList.remove('item-selected'),a.classList.add('item-selected'),d.scrollTop=a.offsetTop;else return},_enterPress:function(){var a,b,c;if(a=Polymer.dom(this.root).querySelector('.item-selected'),c=Polymer.dom(this.root).querySelectorAll('.result'),1===c.length)b=c[0];else{if(!(1<c.length))return!1;if(a)b=a,b.classList.remove('item-selected');else return!1}this.set('value',b.textContent.trim()),this.set('inputValue',b.textContent.trim()),this.async(function(){this.set('_suggestions',[])},100),this.toggleClass('validation-error',!1,this.$.search),this.fire('px-typeahead-item-selected',this.value),Polymer.dom(this.root).querySelector('input').focus()},_backspacePress:function(a){this.value='',this.fire('px-typeahead-item-deselected');var b=a.target.value;this._search(b)},_checkIfSingleResult:function(){var a=Polymer.dom(this.root).querySelectorAll('.result');1===this._suggestions.length&&this.toggleClass('item-selected',!0,a[0])},_localCandidatesSearch:function(a){var b=[];return b=this.localCandidates.filter(function(b){return-1<b.trim().toLowerCase().indexOf(a.trim().toLowerCase())}),b},_prefetchedCandidatesSearch:function(a){var b=[];return b=this._prefetchedCandidates.filter(function(b){return-1<b.trim().toLowerCase().indexOf(a.trim().toLowerCase())}),b},_remoteUrlSearch:function(a){var b=this,c=document.createElement('iron-ajax'),d=b,e=b.remoteUrl.replace('%QUERY',a);return c.handleAs='json',c.url=e,c.addEventListener('response',function(a){if(a.detail.response){var c=a.detail.response,e=JSON.parse(c),f=e.slice(0,parseInt(d.maxSuggestions)),g=g.concat(f);d._suggestions=g,b.set('remoteUrlSearching',!1),b.fire('px-typeahead-remote-searching-end',b)}else return}),this.debounce('remoteUrlSearch',function(){c.generateRequest(),b.fire('px-typeahead-remote-searching-start',b),b.set('remoteUrlSearching',!0)},this.remoteUrlWaitMs),[]},_boldResults:function(a,b){var c=a.base.map(function(a){var c=a.trim().toLowerCase().indexOf(b.trim().toLowerCase());if(-1<c)return{prefix:a.trim().substr(0,c),highlight:a.trim().substr(c,b.length),suffix:a.trim().substr(c+b.length)}});return c=c.filter(function(a){return'undefined'!==a}),c},_search:function(a){this._isFocused&&this.debounce('search',function(){var b=[];return a?void(this.localCandidates&&this.localCandidates.length&&(b=this._localCandidatesSearch(a)),this._prefetchedCandidates&&this._prefetchedCandidates.length&&(b=this._prefetchedCandidatesSearch(a)),this.remoteUrl&&(b=this._remoteUrlSearch(a)),this.set('_suggestions',b),this.async(function(){this._setSearchResultSize()},5)):void this.set('_suggestions',[])},100)},_disabledClass:function(a){return a?'disableIcon':''},_requiredChanged:function(a){!1===a&&this.toggleClass('validation-error',!1,this.$.search)}});</script></body></html>