<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../px-overlay/px-overlay.html"><link rel="import" href="css/px-popover-styles.html"></head><body><dom-module id="px-popover"><template><style include="px-popover-styles"></style><template is="dom-if" if="{{showOverlay}}"><px-overlay type="light" class="fadeFromVisible"></px-overlay></template><div id="popover__wrapper" class="fadeFromVisible"><div id="popover__carat" class$="{{orientation}}"></div><div id="popover"><template is="dom-if" if="{{popoverTitle}}"><h5 class="epsilon">{{popoverTitle}}</h5></template><template is="dom-if" if="{{popoverBody}}"><p>{{popoverBody}}</p></template><template is="dom-if" if="{{enhanced}}"><slot></slot></template></div></div></template></dom-module><script>Polymer({is:'px-popover',behaviors:[Polymer.IronResizableBehavior],properties:{for:{type:String,reflect:!0,observer:'_forChanged'},orientation:{type:String,reflect:!0,value:'right'},popoverTitle:{type:String,reflect:!0,value:''},popoverBody:{type:String,reflect:!0,value:''},position:{type:String,value:'absolute'},showOverlay:{type:Boolean,value:!1,observer:'showOverlayChanged'},enhanced:{type:Boolean,value:!1},_isShowing:{type:Boolean,value:!1}},_getTarget:function(){var a,b=Polymer.dom(this).getOwnerRoot(),c=Polymer.dom(this).parentNode;return a=this.for&&'string'===typeof this.for?Polymer.dom(c).querySelector('#'+this.for):this.for&&'object'===typeof this.for?this.for:11===c.nodeType?b?b.host:null:c,a},listeners:{"iron-resize":'_onIronResize'},_forChanged:function(){this._target&&(this.unlisten(this._target,'click','_toggle'),this.unlisten(this,'click','_toggle')),this._target=this._getTarget(),this._target&&(this.listen(this._target,'click','_toggle'),this.listen(this,'click','_toggle'))},attached:function(){Polymer.Gestures.add(document,'tap',null),this._forChanged(),this.showOverlayChanged(this.showOverlay)},detached:function(){this.unlisten(window,'scroll','_toggle'),this.unlisten(document,'click','_toggle'),this.showOverlayChanged(!1)},_onIronResize:function(){this._isShowing&&this._setPosition()},_isDescendant:function(a,b){for(var c=b.parentNode;null!=c;){if(c===a)return!0;c=c.parentNode}return!1},_toggle:function(a){if('click'===a.type){if(this._isDescendant(this.$.popover__wrapper,a.target))return!1;if(a.target.id===this.for||this._isDescendant(document.querySelector('#'+this.for),a.target))return this._isShowing?this.hide():this.show(),!1;if(this._isShowing)return this.hide(),!1}},show:function(){this.toggleClass('fadeFromHidden',!0,this.$.popover__wrapper),this.toggleClass('fadeFromHidden',!0,this.$$('px-overlay')),this._setPosition(),this._isShowing=!0,this.fire('px-popover-show',{target:this})},hide:function(){this.toggleClass('fadeFromHidden',!1,this.$.popover__wrapper),this.toggleClass('fadeFromHidden',!1,this.$$('px-overlay')),this._isShowing=!1,this.fire('px-popover-hide',{target:this})},_setPosition:function(){this._target&&(this.parentRect=this.offsetParent.getBoundingClientRect(),this.targetRect=this._target.getBoundingClientRect(),this.thisRect=this.$.popover__wrapper.getBoundingClientRect(),this.margin=parseInt(getComputedStyle(this.$.popover__wrapper).marginTop),'left'===this.orientation?this._positionLeft():'right'===this.orientation?this._positionRight():'top'===this.orientation?this._positionTop():'bottom'===this.orientation?this._positionBottom():this._positionRight())},_positionTop:function(){if(this.inRelativeElement()){var a=this.targetRect.width/2-this.thisRect.width/2-this.margin,b=0-this.thisRect.height-2*this.margin;this.$.popover__wrapper.style.top=b+'px',this.$.popover__wrapper.style.left=a+'px'}else this.$.popover__wrapper.style.left=this.targetRect.left-this.thisRect.width/2+this.targetRect.width/2-this.margin-this.parentRect.left+'px',this.$.popover__wrapper.style.top=this.targetRect.top-this.thisRect.height-2*this.margin-this.parentRect.top+'px';this.caratRect=this.$.popover__carat.getBoundingClientRect(),this.$.popover__carat.style.left=this.thisRect.width/2-this.margin+'px',this.$.popover__carat.style.top=this.thisRect.height-this.caratRect.height+1+'px'},_positionBottom:function(){if(this.caratRect=this.$.popover__carat.getBoundingClientRect(),this.inRelativeElement()){var a=this.targetRect.width/2-this.thisRect.width/2-this.margin;this.$.popover__wrapper.style.left=a+'px'}else this.$.popover__wrapper.style.left=this.targetRect.left-this.thisRect.width/2+this.targetRect.width/2-this.margin-this.parentRect.left+'px',this.$.popover__wrapper.style.top=this.targetRect.top+this.targetRect.height-1-this.parentRect.top+'px';this.$.popover__carat.style.left=this.thisRect.width/2-this.margin+'px',this.$.popover__carat.style.top='3px'},_positionLeft:function(){if(this.caratRect=this.$.popover__carat.getBoundingClientRect(),this.inRelativeElement()){var a=0-this.thisRect.width-2*this.margin,b=this.targetRect.height/2-this.thisRect.height/2-this.margin;this.$.popover__wrapper.style.top=b+'px',this.$.popover__wrapper.style.left=a+'px'}else this.$.popover__wrapper.style.left=this.targetRect.left-this.thisRect.width-2*this.margin-this.parentRect.left+'px',this.$.popover__wrapper.style.top=this.targetRect.top+this.targetRect.height/2-this.thisRect.height/2-this.margin-this.parentRect.top+'px';this.$.popover__carat.style.top=this.thisRect.height/2-this.margin+'px',this.$.popover__carat.style.left=this.thisRect.width-this.caratRect.width/2-this.margin+'px'},_positionRight:function(){if(this.caratRect=this.$.popover__carat.getBoundingClientRect(),this.inRelativeElement()){var a=this.targetRect.width,b=this.targetRect.height/2-this.thisRect.height/2-this.margin;this.$.popover__wrapper.style.top=b+'px',this.$.popover__wrapper.style.left=a+'px'}else this.$.popover__wrapper.style.left=this.targetRect.left+this.targetRect.width-this.parentRect.left+'px',this.$.popover__wrapper.style.top=this.targetRect.top+this.targetRect.height/2-this.thisRect.height/2-this.margin-this.parentRect.top+'px';this.$.popover__carat.style.top=this.thisRect.height/2-this.margin+'px',this.$.popover__carat.style.left='3px'},inRelativeElement:function(){return!('relative'!==this.position)},showOverlayChanged:function(a){!1===a?(document.addEventListener('touchend',this._onCaptureClick.bind(this),!0),document.addEventListener('click',this._onCaptureClick.bind(this),!0)):(document.removeEventListener('touchend',this._onCaptureClick.bind(this)),document.removeEventListener('click',this._onCaptureClick.bind(this)))},_onCaptureClick:function(a){if(this._isShowing){var b,c=Polymer.dom(a).path,d=c.length,e=!1;for(b=0;b<d;b++)if('popover'===c[b].id){e=!0;break}e||this.hide()}}});</script></body></html>