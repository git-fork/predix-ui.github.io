<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-modal-trigger.html"><link rel="import" href="css/px-modal-styles.html"><link rel="import" href="../iron-fit-behavior/iron-fit-behavior.html"></head><body><dom-module id="px-modal"><template><style include="px-modal-styles"></style><div class="modal" id="modal" on-transitionend="_handleTransitionEnd"><div class="modal__box shadow-modal"><div><div class="modal__header"><slot name="header"><span class="modal__header__text epsilon weight--normal">[[headerText]]</span></slot></div><div class="modal__body"><slot name="body"><span class="modal__body__text">[[bodyText]]</span></slot></div></div><div class="modal__triggers"><slot name="actions"></slot><div class="modal__reject-trigger" on-tap="_handleRejectTriggerTapped"><slot name="reject-trigger"><button type="button" class="btn" id="reject-trigger-button">[[rejectText]]</button></slot></div><div class="modal__accept-trigger" on-tap="_handleAcceptTriggerTapped"><slot name="accept-trigger"><button type="button" class="btn btn--call-to-action" id="accept-trigger-button">[[acceptText]]</button></slot></div></div></div></div></template></dom-module><script>(()=>{Polymer({is:'px-modal',behaviors:[Polymer.IronFitBehavior],properties:{headerText:String,bodyText:String,acceptText:String,rejectText:String,opened:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0,observer:'_handleOpenedChanged'},openTrigger:{type:HTMLElement,observer:'_handleOpenTriggerUpdated'},disableCloseOnEscape:{type:Boolean,value:!1},fillContainer:{type:Boolean,value:!1,reflectToAttribute:!0,observer:'_handleFillContainerChanged'},autoFitOnAttach:{type:Boolean,value:!0}},observers:['_refit(fillContainer, fitInto)'],created(){this._modalKeypressFn=this._handleModalKeypress.bind(this),this._openTriggerTappedFn=()=>{this.opened=!0},this._openTriggerKeydownFn=(a)=>{'Enter'===a.key&&(this.opened=!0)}},_handleOpenedChanged(a){if(a){this._elementFocusedBeforeOpened=document.activeElement;const a=this._getFocusableElements();this._firstFocusableElement=a[0],this._lastFocusableElement=a[a.length-1],this.addEventListener('keydown',this._modalKeypressFn,!1),this.refit()}else this.removeEventListener('keydown',this._modalKeypressFn),this._firstFocusableElement=null,this._lastFocusableElement=null,this._elementFocusedBeforeOpened&&(this._elementFocusedBeforeOpened.focus(),this._elementFocusedBeforeOpened=null)},_getFocusableElements(){let a=Polymer.dom(this).querySelectorAll('button')||[];a instanceof NodeList&&(a=Array.prototype.slice.call(a));const b=Polymer.dom(this.root).querySelector('#accept-trigger-button'),c=Polymer.dom(this.root).querySelector('#reject-trigger-button'),d=a.find((a)=>'accept-trigger'===a.getAttribute('slot')),e=a.find((a)=>'reject-trigger'===a.getAttribute('slot'));return a.filter((a)=>a!==d&&a!==e).concat([e||c,d||b]).filter((a)=>0<a.offsetHeight)},_handleModalKeypress(a){if('Tab'===a.key&&!a.shiftKey){let b=Polymer.dom(a).rootTarget;b&&this._firstFocusableElement&&b===this._lastFocusableElement&&(a.preventDefault(),this._firstFocusableElement.focus())}if('Tab'===a.key&&a.shiftKey){let b=Polymer.dom(a).rootTarget;b&&this._lastFocusableElement&&b===this._firstFocusableElement&&(a.preventDefault(),this._lastFocusableElement.focus())}'Escape'!==a.key||this.disableCloseOnEscape||(this.opened=!1,this.fire('px-modal-dismissed'))},_handleTransitionEnd(a){let b=Polymer.dom(this.root).querySelector('#modal');Polymer.dom(a).rootTarget===b&&this.debounce('handle-transition-end',()=>{this.opened&&this._firstFocusableElement&&this._firstFocusableElement.focus()},1)},_handleOpenTriggerUpdated(a,b){b&&(b.removeEventListener('click',this._openTriggerTappedFn),b.removeEventListener('keydown',this._openTriggerKeydownFn)),a&&(a.addEventListener('click',this._openTriggerTappedFn,!1),a.addEventListener('keydown',this._openTriggerKeydownFn,!1))},_handleRejectTriggerTapped(){this.opened=!1,this.fire('px-modal-rejected')},_handleAcceptTriggerTapped(){this.opened=!1,this.fire('px-modal-accepted')},_handleFillContainerChanged(a){!0===a?(this.listen(this.fitInto,'scroll','_refit'),this.listen(this.fitInto,'resize','_refit')):(this.unlisten(this.fitInto,'scroll','_refit'),this.unlisten(this.fitInto,'resize','_refit'))},_refit(){this.fillContainer&&this.fitInto&&this.debounce('refit',function(){this.refit()},10)}}),Array.prototype.find||Object.defineProperty(Array.prototype,'find',{value:function(a){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if('function'!==typeof a)throw new TypeError('predicate must be a function');for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}}})})();</script></body></html>