<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-demo-theme-util.html"><script>(function(){function a(){try{return window.self!==window.top}catch(a){return!0}}Polymer({is:'px-demo-theme-switcher',properties:{isDarkTheme:{type:Boolean,value:!1,observer:'_themeChanged'}},_themeChanged:function(a,b){if(!1!==a||'undefined'!==typeof b)if(a&&!b){var c=PxDemo.ThemeUtil.getDarkThemeProperties();if(null===c)return void console.log('Dark theme not loaded. Try again later.');Polymer.updateStyles(c)}else if(!a&&b){var d=PxDemo.ThemeUtil.getDefaultThemeProperties();if(null===d)return void console.log('Theme not loaded. Try again later.');Polymer.updateStyles(d)}}}),Polymer({is:'px-demo-theme-switcher-frame',properties:{origin:{type:String},isDarkTheme:{type:Boolean,notify:!0}},created:function(){this._boundMessageHandler=this._handleParentMessage.bind(this),this._inFrame=a()},attached:function(){this._inFrame&&(window.addEventListener('message',this._boundMessageHandler,!1),this._requestParentTheme())},detached:function(){this._inFrame&&window.removeEventListener('message',this._boundMessageHandler,!1)},_handleParentMessage:function(a){a.origin!==this.origin||'THEME_STATUS'!==a.data.type||'boolean'!==typeof a.data.IS_DARK_THEME||(this.isDarkTheme=a.data.IS_DARK_THEME)},_requestParentTheme:function(){this.origin&&parent.postMessage({type:'REQUEST_THEME_STATUS'},this.origin)}}),Polymer({is:'px-demo-theme-switcher-parent',properties:{origin:{type:String},isDarkTheme:{type:Boolean,value:null,observer:'_themeChanged'},childFrame:{type:HTMLElement,value:null,observer:'_frameChanged'}},created:function(){this._boundMessageHandler=this._handleChildMessage.bind(this)},detached:function(){this.childFrame&&(this.childFrame=null)},_themeChanged:function(){this.childFrame&&this.childFrame.contentWindow&&'boolean'===typeof this.isDarkTheme&&this._sendThemeToChild(this.childFrame.contentWindow,this.isDarkTheme)},_handleChildMessage:function(a){a.origin!==this.origin||'REQUEST_THEME_STATUS'!==a.data.type||this._themeChanged()},_sendThemeToChild:function(a,b){this.origin&&a.postMessage({type:'THEME_STATUS',IS_DARK_THEME:b},this.origin)},_frameChanged:function(a,b){b&&b.contentWindow&&b.contentWindow.removeEventListener('message',this._boundMessageHandler,!1),a&&a.contentWindow&&(a.contentWindow.addEventListener('message',this._boundMessageHandler,!1),this._themeChanged())}})})();</script></head><body></body></html>