<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-dropdown/px-dropdown.html"><link rel="import" href="../px-typeahead/px-typeahead.html"><link rel="import" href="../px-toggle/px-toggle.html"><link rel="import" href="../px-app-helpers/object-assign-polyfill/object-assign-polyfill.html"><link rel="import" href="css/px-demo-styles.html"><link rel="import" href="px-demo-behaviors.html"></head><body><dom-module id="px-demo-props"><template><style include="px-demo-styles">:host{width:100%;}</style><template is="dom-if" if="{{_fields.length}}"><p class="epsilon u-mb+">Properties</p><template is="dom-repeat" items="{{_fields}}" filter="_propIsVisible" observe="_visibleForConfig"><template is="dom-if" if="{{_itIs(item.inputType, 'toggle')}}"><div class="flex flex--justify u-mb-"><div class="label" aria-hidden="true">{{_getFieldLabel(item)}}</div><div class="u-ml-"><px-toggle id="toggle-{{item.prop}}" size="small" checked$="{{item.value::change}}" prop="{{item.prop}}" disabled$="{{_itIsTrue(item.inputDisabled)}}" data-debounce="{{item.inputDebounce}}" on-checked-changed="_handleToggleInput"></px-toggle></div></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text">{{item.inputHelpText}}</p></template></template><template is="dom-if" if="{{_itIs(item.inputType, 'text')}}"><div class="u-mb-"><label for$="text-{{item.prop}}">{{_getFieldLabel(item)}}</label><input id="text-{{item.prop}}" class="text-input u-mb--" type="text" placeholder="{{_getFieldPlaceholder(item)}}" disabled$="{{_itIsTrue(item.inputDisabled)}}" value="{{item.value}}" prop="{{item.prop}}" data-debounce="{{item.inputDebounce}}" on-input="_handleTextInput"></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text">{{item.inputHelpText}}</p></template></template><template is="dom-if" if="{{_itIs(item.inputType, 'number')}}"><div class="u-mb-"><label for$="text-{{item.prop}}">{{_getFieldLabel(item)}}</label><input id="text-{{item.prop}}" class="text-input u-mb--" type="number" placeholder="{{_getFieldPlaceholder(item)}}" disabled$="{{_itIsTrue(item.inputDisabled)}}" value="{{item.value}}" prop="{{item.prop}}" data-debounce="{{item.inputDebounce}}" on-input="_handleNumberInput"></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text">{{item.inputHelpText}}</p></template></template><template is="dom-if" if="{{_itIs(item.inputType, 'dropdown')}}"><div class="u-mb-"><label for$="dropdown-{{item.prop}}">{{_getFieldLabel(item)}}</label><div class="u-mb--"><px-dropdown style="width: 100%;" id="dropdown-{{item.prop}}" prop="{{item.prop}}" data-debounce="{{item.inputDebounce}}" items="{{item.inputChoices}}" select-by="val" selected="{{item.value}}" on-px-dropdown-selection-changed="_handleDropdownInput" disable-clear=""></px-dropdown></div></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text--dropdown">{{item.inputHelpText}}</p></template></template><template is="dom-if" if="{{_itIs(item.inputType, 'typeahead')}}"><div class="u-mb-"><label for$="typeahead-{{item.prop}}">{{_getFieldLabel(item)}}</label><div style="width: 100%;" class="u-mb--"><px-typeahead id="typeahead-{{item.prop}}" local-candidates="{{item.inputLocalCandidates}}" prefetch-url="{{item.inputPrefetchUrl}}" placeholder="[[item.inputPlaceholder]]" input-value="{{item.value}}" prop="{{item.prop}}" data-debounce="{{item.inputDebounce}}" on-px-typeahead-item-selected="_handleTypeaheadItemSelected"></px-typeahead></div></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text--dropdown">{{item.inputHelpText}}</p></template></template><template is="dom-if" if="{{_itIsOneOf(item.inputType, 'code:EvaluatedJavaScript', 'code:JSON')}}"><div class="u-mb-"><label for$="text-{{item.prop}}">{{_getFieldLabel(item)}}</label><div class="flex flex--row"><input id="text-{{item.prop}}" class="text-input flex__item u-mb--" type="text" placeholder="{{item.inputPlaceholder}}" value="{...}" prop="{{item.prop}}" on-input="_editComplexJSON" disabled=""> <button class="btn u-ml-" type="button" prop="{{item.prop}}" input-type="{{item.inputType}}" data-debounce="{{item.inputDebounce}}" on-tap="_handleCodeEditButton">Edit</button></div></div><template is="dom-if" if="{{item.inputHelpText}}"><p class="zeta demo-props__helper-text">{{item.inputHelpText}}</p></template></template></template></template></template></dom-module><script>Polymer({is:'px-demo-props',behaviors:[PxDemoBehaviors.manageProps],properties:{props:{type:Object,notify:!0,value:function(){return{}}},config:{type:Object,value:function(){return{}},observer:'_handleConfigUpdate'},propsVisible:{type:Boolean,value:!0,notify:!0,readOnly:!0,observer:'_handlePropsVisibleChange'},_fields:{type:Array,value:function(){return[]}},_fieldsIndex:{type:Object,value:function(){return{}}}},observers:['_computeFields(props)','_syncToField(props.*)'],ready:function(){this.applyPropDefaults()},_computeFields:function(){this.debounce('prepare-fields',function(){if(this.props!==void 0){var a=this.props,b=Object.keys(a);if(b.length)for(var c=0;c<b.length;c++)this.push('_fields',Object.assign({},{prop:b[c],_visibleForConfig:!0},a[b[c]])),this.set('_fieldsIndex.'+b[c],c)}},200)},_itIs:function(a,b){return a===b},_itIsOneOf:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=!1,d=b&&Array.isArray(b)?b.length:0,e=0;e<d;e++)b[e]===a&&(c=!0);return c},_itIsTrue:function(a){return'boolean'===typeof a?!0===a:!('true'!==a)||'false'!==a&&void 0},_itIsDisabled:function(a){return'boolean'===typeof a?!0===a?'toggle--disabled':'':'true'===a?'toggle--disabled':'false'===a?'':void 0},_getFieldLabel:function(a){return a.inputLabel?a.inputLabel:this._formatInputLabel(a.prop)},_getFieldPlaceholder:function(a){return a.inputPlaceholder||''},_formatInputLabel:function(a){var b=a.replace(/([A-Z]+)/g,' $1').replace(/([A-Z][a-z])/g,' $1');return b.charAt(0).toUpperCase()+b.slice(1)},_getDropdownDisplayValue:function(a){return a&&a.length?a:'Select'},_handleTextInput:function(a){this._syncToProp(a.target.prop,a.target.value,a.target.dataDebounce)},_handleNumberInput:function(a){this._syncToProp(a.target.prop,+a.target.value,a.target.dataDebounce)},_handleToggleInput:function(a){this._syncToProp(a.target.prop,a.detail.value,a.target.dataDebounce)},_handleDropdownInput:function(a){this._syncToProp(a.target.prop,a.detail.val,a.target.dataDebounce)},_handleTypeaheadItemSelected:function(a){this._syncToProp(a.target.prop,a.detail,a.target.dataDebounce)},_handleCodeEditButton:function(a){const{prop:b,type:c,value:d,inputType:e,inputLabel:f}=a.model.item,g=this._formatInputLabel(f||b);this.fire('px-demo-props-code-edit-request',{value:d,mode:e,title:`Property Editor: ${g}`,save:(a)=>{this._syncToProp(b,a)}})},_syncToProp:function(a,b,c){c?this.debounce('sync-props',function(){this.set('props.'+a+'.value',b)},c):this.set('props.'+a+'.value',b)},_syncToField:function(a){if(a&&'object'===typeof a&&a.path)for(var b=['value','inputDisabled'],c=0;c<b.length;c++)if(-1!==a.path.indexOf('.'+b[c])){this.debounce('sync-to-field'+a.path,function(){var d=a.path.replace('props.','').replace('.'+b[c],''),e=this.get('_fieldsIndex.'+d),f='_fields.'+e+'.'+b[c],g=this.get(f);'undefined'!==typeof g&&g!==a.value&&this.set(f,a.value)},50);break}},_propIsVisible:function(a){return!0===a._visibleForConfig},_handleConfigUpdate:function(a){a&&Object.keys(a).length&&(a.configShowProps&&Array.isArray(a.configShowProps)?this._setEachPropVisibility('showOnly',a.configShowProps):a.configHideProps&&Array.isArray(a.configHideProps)&&a.configHideProps.length?this._setEachPropVisibility('hideOnly',a.configHideProps):this._setEachPropVisibility('showAll'))},_setEachPropVisibility:function(a,b){var c=this.get('_fields'),d=0;if(c&&c.length){for(var e=0,f=c.length;e<f;e++){var g,h=c[e].prop;'showOnly'===a&&(g=-1!==b.indexOf(h)),'hideOnly'===a&&(g=-1===b.indexOf(h)),'showAll'===a&&(g=!0),!0===g?(this.set('_fields.'+e+'._visibleForConfig',!0),d++):this.set('_fields.'+e+'._visibleForConfig',!1)}var i=0<d;this._setPropsVisible(i)}},_handlePropsVisibleChange:function(a,b){'boolean'===typeof a&&(!0===a&&a!==b&&this.fire('px-demo-props-some-visible'),!1===a&&a!==b&&this.fire('px-demo-props-none-visible'))}});</script></body></html>