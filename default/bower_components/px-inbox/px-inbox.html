<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="css/px-inbox-styles.html"><link rel="import" href="../px-dropdown/px-dropdown.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../px-alert-label/px-alert-label.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"></head><body><dom-module id="px-inbox"><template><style include="px-inbox-styles"></style><section class$="inbox-container [[_getCollapsedClassNames(_isCollapsed, _detailViewActive)]]"><div id="list" class="list flex flex--col"><div class="search u-mt u-mh u-mb-"><input class="text-input" value="{{_query::input}}" placeholder="[[localize('Search')]]"><px-icon class="search__icon" icon="px-nav:search"></px-icon></div><div class="flex flex--justify flex--middle u-ph u-pb shadow-navigation"><div class="flex flex--row flex--middle"><span class="label u-mr--">[[localize('Sort by')]]:</span><px-dropdown id="dropdown" class="sort-dropdown" select-by="key" button-style="bare" selected="{{sortBy}}" display-value="{{localize(sortBy)}}" items="[[_getLocalizedSortOptions(localize)]]" disable-clear=""></px-dropdown></div><px-icon id="sortIcon" class="actionable actionable--action" on-tap="_handleReverseSort" icon="[[_getSortIcon(sortOrder)]]"></px-icon></div><ul id="list__body" class="list-ui list-ui--small" on-scroll="_updateShadowScrollClassName"><template is="dom-repeat" items="{{listItems}}" as="listItem" filter="{{_computeFilter(_query)}}" sort="{{_computeSort(sortBy, sortOrder)}}"><li id="{{listItem.id}}" class$="list-ui__item pointer {{_getSelectedItemClassName(selectedItem,listItem.id)}}" on-tap="_handleItemTapped"><div class="flex flex--justify"><div class="flex flex--left"><template is="dom-if" if="{{listItem.severity}}"><px-alert-label class="flex__item--msfix" type="{{listItem.severity}}" label="{{_getLabel(listItem.severity)}}" badge=""></px-alert-label></template><div class="text"><div class="title flex__item">{{listItem.title}}</div><div class="subtitle flex__item">{{listItem.subtitle}}</div></div></div><span class="info">{{_getFormattedDate(listItem.date, localize)}}</span></div></li></template></ul></div><div id="detail" class="detail"><span class="back-link actionable u-m-" on-tap="_handleShowListView"><px-icon class="u-mr--" icon="px-nav:back"></px-icon>[[localize('Back')]]</span><slot></slot></div></section></template></dom-module><script>Polymer({is:'px-inbox',behaviors:[Polymer.IronResizableBehavior,Polymer.AppLocalizeBehavior],properties:{listItems:{type:Array,observer:'_setInitialSelectedItem'},selectedItem:{type:String,notify:!0},selectedItemRef:{type:Object,notify:!0,readOnly:!0,computed:'_computeSelectedItemRef(selectedItem, listItems, listItems.*)'},_query:{type:String},sortBy:{type:String,value:'Date',notify:!0},sortOrder:{type:String,value:'ascending',notify:!0},disableAutoSelect:{type:Boolean,value:!1},language:{type:String,value:'en'},useKeyIfMissing:{type:Boolean,value:!0},resources:{type:Object,value:function(){return{en:{Back:'Back',"Sort by":'Sort by',Search:'Search',Title:'Title',Subtitle:'Subtitle',Severity:'Severity',Date:'Date',"years ago":'years ago',"a year ago":'a year ago',"months ago":'months ago',"a month ago":'a month ago',"days ago":'days ago',"a day ago":'a day ago',"hours ago":'hours ago',"an hour ago":'an hour ago',"minutes ago":'minutes ago',"a minute ago":'a minute ago',"a few seconds ago":'a few seconds ago'}}}},_isCollapsed:{type:Boolean,value:!1},_detailViewActive:{type:Boolean,value:!1,observer:'_setInitialSelectedItem'}},listeners:{"iron-resize":'_calculateBounds'},_setInitialSelectedItem:function(){Array.isArray(this.listItems)&&0<this.listItems.length&&!this.selectedItem&&!1===this.disableAutoSelect&&(this.selectedItem=this.listItems[0].id)},_handleItemTapped:function(a){this.selectedItem=a.model.listItem.id,this._detailViewActive=!0},_handleShowListView:function(){this._detailViewActive=!1},_calculateBounds:function(){this.debounce('resize',function(){700>this.getBoundingClientRect().width?this._isCollapsed=!0:(this._isCollapsed=!1,this._detailViewActive=!0)},500)},_getFormattedDate:function(a,b){return'string'===typeof a&&this._isValidDate(a)?this._formatDateFromNow(new Date(a),new Date,b):a instanceof Date&&this._isValidDate(a)?this._formatDateFromNow(a,new Date,b):a},_isValidDate:function(a){return!isNaN(new Date(a).getTime())},_formatDateFromNow:function(a,b,c){var d=Math.floor;const e=d((b-a)/1e3),f=d(e/31536000),g=d(e/2592000),h=d(e/86400),i=d(e/3600),j=d(e/60);return 548<h?`${f} ${c('years ago')}`:320<=h&&547>=h?c('a year ago'):45<=h&&319>=h?`${g} ${c('months ago')}`:26<=h&&45>=h?c('a month ago'):36<=i&&25>=h?`${h} ${c('days ago')}`:22<=i&&35>=i?c('a day ago'):90<=j&&21>=i?`${i} ${c('hours ago')}`:45<=j&&89>=j?c('an hour ago'):90<=e&&44>=j?`${j} ${c('minutes ago')}`:45<=e&&89>=e?c('a minute ago'):0<=e&&45>=e?c('a few seconds ago'):void 0},_computeFilter:function(a){return a?(a=a.toLowerCase(),function(b){var c=b.title.toLowerCase(),d=b.subtitle.toLowerCase();return-1!=c.indexOf(a)||-1!=d.indexOf(a)}):null},_handleReverseSort:function(){'ascending'===this.sortOrder?this.sortOrder='descending':'descending'===this.sortOrder&&(this.sortOrder='ascending')},_computeSort:function(c,a){c=c?c.toLowerCase():'';var b='ascending'===a;return'severity'===c&&b?function(c,a){var b={important:4,warning:3,error:2,information:1,"":0,undefined:0};return b[a.severity]-b[c.severity]}:'severity'!==c||b?'date'===c&&b?function(c,a){return c.date>a.date?-1:c.date<a.date?1:0}:'date'!==c||b?b?function(d,a){return d[c]<a[c]?-1:d[c]>a[c]?1:0}:function(d,b){return b[c]<d[c]?-1:b[c]>d[c]?1:0}:function(c,b){return b.date>c.date?-1:b.date<c.date?1:0}:function(c,b){var a={important:4,warning:3,error:2,information:1,"":0,undefined:0};return a[c.severity]-a[b.severity]}},_getSortIcon:function(a){return'ascending'===a?'px-nav:up':'descending'===a?'px-nav:down':void 0},_getLocalizedSortOptions:function(a){return[{key:'Title',val:a('Title')},{key:'Subtitle',val:a('Subtitle')},{key:'Severity',val:a('Severity')},{key:'Date',val:a('Date')}]},_getSelectedItemClassName:function(a,b){if(a&&b&&b===a)return'selected'},_getCollapsedClassNames:function(a,b){if(a)return'collapsed '+(b?'collapsed--detail-active':'collapsed--list-active')},_getLabel:function(a){return'important'===a?'1':'warning'===a?'2':'error'===a?'3':'information'===a?'4':void 0},_computeSelectedItemRef:function(a,b){if(a&&b&&Array.isArray(b))for(let c=0;c<b.length;c++)if(b[c].id===a)return b[c]},_updateShadowScrollClassName:function(){this.debounce('update-class',function(){0<this.$.list__body.scrollTop?this.toggleClass('shadow-component',!0,Polymer.dom(this.root).querySelector('.list__header')):this.toggleClass('shadow-component',!1,Polymer.dom(this.root).querySelector('.list__header'))},50)}});</script></body></html>