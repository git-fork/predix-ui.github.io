<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="../px-d3-imports/px-d3-imports.html"><link rel="import" href="../px-number-formatter/px-number-formatter-behavior.html"><link rel="import" href="../px-number-formatter/px-number-formatter-no-display.html"><link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html"><link rel="import" href="css/px-slider-styles.html"><link rel="import" href="css/px-handle-styles.html"></head><body><dom-module id="px-slider"><template><style include="px-slider-styles"></style><style include="px-handle-styles"></style><div id="wrapper" class="flex"><template is="dom-if" if="[[_showStartInput]]"><label for="inputStart" class="visuallyhidden">Value or Start Value</label><input id="inputStart" type="text" class="text-input" value="[[formattedStartValue]]" on-change="_inputChangedStart" tabindex="0" disabled="{{disabled}}"></template><px-number-formatter-no-display id="formatterStart" value="[[value]]" formatted-value="{{formattedStartValue}}" format="[[_format]]" currency="[[currency]]" culture="[[culture]]" zero-format="[[zeroFormat]]"></px-number-formatter-no-display><iron-a11y-keys id="a11yStart" target="[[_inputStart]]" keys="esc" on-keys-pressed="_restoreStartInputValue"></iron-a11y-keys><svg xmlns="http://www.w3.org/2000/svg" id="sliderSVG" class="flex__item u-mb" overflow="visible" width$="[[_getSvgWidth(_width, _margin.*)]]" height$="[[_getSvgHeight(_height, _margin.*)]]"><g id="sliderContainer" transform$="[[_calcTransform(_margin.*)]]"><g id="backgroundTrack"><rect class="backgroundTrack sliderTrack" x="0" y="0" width$="[[_width]]" height="5"></rect></g><g id="zoneBars"></g><g id="progressBar"><rect class="progressBar sliderTrack" x$="[[_calcProgressStart(value, _scaleChanged, isRange)]]" y="0" width$="[[_calcProgressEnd(value, endValue, _scaleChanged, isRange)]]" height="5"></rect></g><g id="labelContainer"><text id="minLabel" class="minMaxLabel" text-anchor="start" dominant-baseline$="[[_returnLabelBaseline(minLabelPosition)]]" x="0" y$="[[_returnLabelPosition(minLabelPosition, isRange)]]">{{_returnLabel(min, showLabels)}}</text><text id="maxLabel" class="minMaxLabel" text-anchor="end" dominant-baseline$="[[_returnLabelBaseline(maxLabelPosition)]]" x$="[[_width]]" y$="[[_returnLabelPosition(maxLabelPosition, isRange)]]">{{_returnLabel(max, showLabels)}}</text></g><g id="handleStart" class="handleGroup"><path class="handleBody"></path></g><g id="handleEnd" class="handleGroup"><path class="handleBody"></path></g></g></svg><template is="dom-if" if="[[_showEndInput]]"><label for="inputEnd" class="visuallyhidden">End Value</label><input id="inputEnd" type="text" class="text-input input--tiny" value="[[formattedEndValue]]" on-change="_inputChangedEnd" tabindex="0" disabled="{{disabled}}"></template><px-number-formatter-no-display id="formatterEnd" value="[[endValue]]" formatted-value="{{formattedEndValue}}" format="[[_format]]" currency="[[currency]]" culture="[[culture]]" zero-format="[[zeroFormat]]"></px-number-formatter-no-display><iron-a11y-keys id="a11yEnd" target="[[_inputEnd]]" keys="esc" on-keys-pressed="_restoreEndInputValue"></iron-a11y-keys></div></template><script>Polymer({is:'px-slider',properties:{_height:{type:Number,value:10},_width:{type:Number,value:52},_margin:{type:Object,notify:!0,value:function(){return{left:15,right:15,top:15,bottom:10}}},value:{type:Number,notify:!0,value:0},endValue:{type:Number,notify:!0,value:null},formattedStartValue:{type:String},formattedEndValue:{type:String},min:{type:Number,value:1},max:{type:Number,value:100},_minMaxValid:{type:Number,value:0},step:{type:Number,value:1,observer:'_stepChanged'},disabled:{type:Boolean,value:!1,observer:'_setupListeners'},hideInputs:{type:Boolean,value:!1},_showStartInput:{type:Boolean,value:!0},_showEndInput:{type:Boolean,value:!1},isRange:{type:Boolean,value:!1},scale:{type:String,value:'linear',observer:'_createScale'},base:{type:Number,value:10},exponent:{type:Number,value:1},_scale:{type:Function},_scaleChanged:{type:Boolean},_startHandle:{type:Object},_endHandle:{type:Object},_progressBar:{type:Object},_backgroundTrack:{type:Object},_inputStart:{type:HTMLElement},_inputEnd:{type:HTMLElement},_minLabel:{type:Object},_maxLabel:{type:Object},_format:{type:String,value:'0'},showLabels:{type:Boolean,value:!1},minLabelPosition:{type:String,value:'bottom'},maxLabelPosition:{type:String,value:'bottom'},_handleDefinitions:{type:Object,value:function(){return{circle:{bodyD:'m0,-7.5c5,0 10,5 10,10c0,5 -5,10 -10,10c-5,0 -10,-5 -10,-10c0,-5 5,-10 10,-10z'},down:{bodyD:'m7.5,-13l-15,0l7.5,12l7.5,-12z'},up:{bodyD:'m7.5,18l-15,0l7.5,-12l7.5,12z'}}}}},behaviors:[Polymer.IronResizableBehavior,PxNumberFormatter.commonProperties],listeners:{"iron-resize":'_onIronResize'},observers:['_minOrMaxChanged(min, max)','_setRange(_scale, _width, _height)','_setDomain(_scale, _minMaxValid)','_valueChanged(value, _scale, _scaleChanged)','_endValueChanged(endValue, _scale, _scaleChanged)','_updateFormat(step, _format)','_isRangeChanged(isRange)','_hideInputsChanged(hideInputs)'],ready(){window.requestAnimationFrame(this._animationFrame.bind(this))},attached(){this.setAttribute('role','slider')},_animationFrame(){var a=Px.d3.select(this.$$('#handleStart')),b=Px.d3.select(this.$$('#handleEnd')),c=Px.d3.select(this.$$('#progressBar')),d=Px.d3.select(this.$$('#backgroundTrack')),e=Px.d3.select(this.$$('#minLabel')),f=Px.d3.select(this.$$('#maxLabel'));this.set('_startHandle',a),this.set('_endHandle',b),this.set('_progressBar',c),this.set('_backgroundTrack',d),this.set('_minLabel',e),this.set('_maxLabel',f),this._buildHandles(),this._setupListeners()},_setupListeners(){this._startHandle&&this._endHandle&&(this.disabled?(this._removeHandleListeners(),this._removeTrackListeners()):(this._createHandleListeners(this._startHandle,'value'),this._createHandleListeners(this._endHandle,'endValue'),this._createTrackListeners()),this._toggleDisabledClass())},_createHandleListeners(a,b){var c=a.select('.handleBody'),d=Px.d3.select(this.$$('.progressBar'));a.call(Px.d3.drag().on('start.interrupt',function(){a.interrupt()}).on('start drag',function(){c.classed('handleBodyPressed',!0),d.classed('progressBarPressed',!0),this._calcSliderValue(Px.d3.event.x,b)}.bind(this)).on('end',function(){c.classed('handleBodyPressed',!1),d.classed('progressBarPressed',!1)})).on('mouseenter',function(){c.classed('handleBodyHover',!0),d.classed('progressBarHover',!0)}).on('mouseleave',function(){c.classed('handleBodyHover',!1),d.classed('progressBarHover',!1)})},_createTrackListeners(){var a=this,b=Px.d3.selectAll(Polymer.dom(this.$$('#sliderSVG')).querySelectorAll('.sliderTrack'));b.on('click',function(){a._trackOnClick(this)})},_trackOnClick(a){var b=Px.d3.mouse(a)[0],c='value';if(this.isRange){var d=this._scale.invert(b),e=(this.endValue-this.value)/2+this.value;c=d>this.endValue||d>e?'endValue':'value'}this._calcSliderValue(b,c)},_removeHandleListeners(){this._startHandle.on('.drag',null),this._endHandle.on('.drag',null)},_removeTrackListeners(){var a=Px.d3.selectAll(Polymer.dom(this.$$('#sliderSVG')).querySelectorAll('.sliderTrack'));a.on('click',null)},_buildHandles(){this._handleDefinitions&&this._startHandle&&this._endHandle&&(this.isRange?(this._startHandle.select('.handleBody').attr('d',this._handleDefinitions.down.bodyD),this._endHandle.select('.handleBody').attr('d',this._handleDefinitions.up.bodyD)):(this._startHandle.select('.handleBody').attr('d',this._handleDefinitions.circle.bodyD),this._endHandle.select('.handleBody').attr('d',null)))},_assignInputElems(){Polymer.dom.flush(),this.set('_inputStart',this.$$('#inputStart')),this.set('_inputEnd',this.$$('#inputEnd'))},_onIronResize(){this.debounce('ironresize',function(){var a=this.$.wrapper.getBoundingClientRect(),b=this._inputStart?this._inputStart.getBoundingClientRect().width:0,c=this._inputStart?+window.getComputedStyle(this._inputStart).marginRight.split('px')[0]:0,d=this._inputEnd?this._inputEnd.getBoundingClientRect().width:0,e=this._inputEnd?+window.getComputedStyle(this._inputEnd).marginLeft.split('px')[0]:0,f=a.width-b-d-c-e-this._margin.left-this._margin.right;this.set('_width',Math.max(f,0))},10)},_hideInputsChanged(){this.hideInputs?(this.set('_showStartInput',!1),this.set('_showEndInput',!1)):(this.set('_showStartInput',!0),this.set('_showEndInput',this.isRange)),this._assignInputElems(),this.notifyResize()},_getSvgWidth(a,b){if(a!==void 0&&b!==void 0)return this._width+this._margin.left+this._margin.right},_getSvgHeight(a,b){if(a!==void 0&&b!==void 0)return this._height+this._margin.top+this._margin.bottom},_calcTransform(){return'translate('+this._margin.left+','+this._margin.top+')'},_stepChanged(){if(this.step!==void 0){if(0>this.step)return console.warn('Improper configuration: step cannot be negative. Falling back to absolute value'),void this.set('step',Math.abs(this.step));if(0===this.step)return console.warn('Improper configuration: step cannot be negative. Falling back to 1'),void this.set('step',1)}},_minOrMaxChanged(a,b){if(a!==void 0&&b!==void 0){if(this.min===this.max)return this.set('_minMaxValid',0),console.warn('Improper configuration: min and max are the same. Increasing max by step size.'),void this.set('max',this.min+this.step);if(this.min>this.max){this.set('_minMaxValid',0),console.warn('Improper configuration: min and max are reversed. Swapping them.');var c=this.min;return this.set('min',this.max),void this.set('max',c)}this.setAttribute('aria-valuemin',this.min),this.setAttribute('aria-valuemax',this.max),this.set('_minMaxValid',(this._minMaxValid||0)+1)}},_createScale(){this.debounce('_createScale',function(){this._createScaleDebounced()},10)},_createScaleDebounced(){var a;'linear'===this.scale?a=Px.d3.scaleLinear().clamp(!0):'logarithmic'===this.scale?a=Px.d3.scaleLog().base(this.base).clamp(!0):'exponential'===this.scale&&(a=Px.d3.scalePow().exponent(this.exponent).clamp(!0)),this.set('_scale',a)},_setRange(a,b,c){a===void 0||b===void 0||c===void 0||this.debounce('_setRange',function(){this._scale&&this._width&&this._height&&this._setRangeDebouced()},10)},_setRangeDebouced(){var a,b=Math.max;if('vertical'===this.orientation){var c=b(this._height,0);a=[c,0]}else{var d=b(this._width,0);a=[0,d]}this._scale.range(a),this._scaleChanged=!this._scaleChanged},_setDomain(a,b){a===void 0||b===void 0||this.debounce('_setDomain',function(){this._scale&&this._minMaxValid&&this._setDomainDebounced()},10)},_setDomainDebounced(){this._scale.domain([this.min,this.max]),this._scaleChanged=!this._scaleChanged},_calcSliderValue(a,b){this.debounce('_calcSliderValue',function(){this._calcSliderValueDebounced(a,b)},10)},_calcSliderValueDebounced(a,b){var c=this._scale.invert(a),d=this._calcStepRounded(c),e='value'===b?this._inputStart:this._inputEnd;this.isRange&&(d='value'===b&&d>this.endValue?this.endValue:d,d='endValue'===b&&d<this.value?this.value:d),this.toggleClass('validation-error',!1,e),this.set(b,d)},_calcStepRounded(a){var b=Math.round(a/this.step)*this.step;return b=b<this.min?b+this.step:b,b=b>this.max?b-this.step:b,b},_validateValue(a,b){var c=!0;return this.isRange&&'value'===b&&a>this.endValue?(a=this.endValue,c=!1,this.set(b,a)):this.isRange&&'endValue'===b&&a<this.value&&(a=this.value,c=!1,this.set(b,a)),a<this.min?(a=this._calcStepRounded(this.min),c=!1,this.set(b,a)):a>this.max&&(a=this._calcStepRounded(this.max),c=!1,this.set(b,a)),c},_valueChanged(a,b,c){if(a!==void 0&&b!==void 0&&c!==void 0&&this._startHandle){var d=this._validateValue(a,'value');d&&(this._moveHandle(this._startHandle,a),this.setAttribute('aria-valuenow',a))}},_endValueChanged(a,b,c){if(a!==void 0&&b!==void 0&&c!==void 0&&null!==a&&this._endHandle){var d=this._validateValue(a,'endValue');d&&this._moveHandle(this._endHandle,a)}},_moveHandle(a,b){a.attr('transform','translate('+this._scale(b)+',0)')},_calcProgressStart(){if(this._scale!==void 0)return this.isRange?this._scale(this.value):0},_calcProgressEnd(a,b,c,d){if(a!==void 0&&b!==void 0&&c!==void 0&&d!==void 0)return this.isRange?Math.max(this._scale(this.endValue)-this._scale(this.value),1):this._scale(this.value)},_updateFormat(a){if(a!==void 0){if(this.format)return void this.set('_format',this.format);for(var b=this.step.toString().split('.'),c=2===b.length?b[1].length:0,d='0.',e=0;e<c;e++)d+='0';this.set('_format',d)}},_inputChangedStart(){var a=this._inputStart.value;this._inputChanged(a,this._inputStart,'#formatterStart','value')},_inputChangedEnd(){var a=this._inputEnd.value;this._inputChanged(a,this._inputEnd,'#formatterEnd','endValue')},_inputChanged(a,b,c,d){var e,f=this.$$(c);return(f.set('unformat',a),e=f.unformattedValue,!e&&0!==e)?void this.toggleClass('validation-error',!0,b):(e=Math.max(e,this.min),e=Math.min(e,this.max),e=this._calcStepRounded(e),this.isRange&&('value'===d&&e>this.endValue||'endValue'===d&&e<this.value)?void this.toggleClass('validation-error',!0,b):void(this.toggleClass('validation-error',!1,b),this[d]=null,this.set(d,e)))},_restoreStartInputValue(){this._restoreInputValue(this._inputStart,this.formattedStartValue)},_restoreEndInputValue(){this._restoreInputValue(this._inputEnd,this.formattedEndValue)},_restoreInputValue(a,b){a.blur(),a.value=b,this.toggleClass('validation-error',!1,a)},_checkEndValue(){var a=this._calcStepRounded(this.endValue);if(a>=this.value&&a<=this.max)this.set('endValue',a);else{var b=this._calcStepRounded(this.max);this.set('endValue',b)}},_isRangeChanged(a){a!==void 0&&(this._checkEndValue(),this._hideInputsChanged(),this._buildHandles())},_toggleDisabledClass(){this._startHandle.classed('disabled',this.disabled),this._endHandle.classed('disabled',this.disabled),this._progressBar.classed('disabled',this.disabled),this._backgroundTrack.classed('disabled',this.disabled),this._minLabel.classed('disabled',this.disabled),this._maxLabel.classed('disabled',this.disabled)},_returnLabel(a,b){return b?a:''},_returnLabelPosition(a,b){return b?'top'===a?-20:24:'top'===a?-15:19},_returnLabelBaseline(a){return'top'===a?'baseline':'hanging'}});</script></dom-module></body></html>