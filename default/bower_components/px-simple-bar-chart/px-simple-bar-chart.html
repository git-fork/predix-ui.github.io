<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../px-simple-chart-common-behavior/px-simple-chart-common-behavior.html"><link rel="import" href="../px-simple-chart-common-behavior/px-simple-chart-common-behavior-colors.html"><link rel="import" href="css/px-simple-bar-chart-styles.html"></head><body><dom-module id="px-simple-bar-chart"><script type="text/javascript" src="../es6-promise/es6-promise.min.js"></script><script type="text/javascript" src="../d3/d3.js"></script><template><style include="px-simple-bar-chart-styles"></style><svg class="px-simple-bar-chart-svg"></svg></template></dom-module><script>var defaultChartData=[[1,2,3,4,5,6,7],[2,6,5,4,3,2,7],[2,4,6,7,5,3,6],[3,3,3,3,3,3,4],[5,5,5,5,5,5,5]];Polymer({is:'px-simple-bar-chart',behaviors:[PxSimpleChartCommonBehavior.common,PxSimpleChartCommonBehavior.colors],properties:{chartData:{type:Array,observer:'_drawChart',value:function(){return defaultChartData}},legendLabels:{type:Array,observer:'_drawChart',value:function(){return[]}},colors:{type:Array,observer:'_drawChart',value:function(){return[]}},legendOrder:{type:String,observer:'_drawChart',value:'reverse'}},observers:['_drawChart(seriesColorList.*, seriesConfig.*)'],_getColor:function(a){return this.colors.length?this._getLocalColor(a):this._getDataVisColor(a)},_getLocalColor:function(a){return 0<=a&&a<this.colors.length?this.colors[a]:this._getColor(Math.abs(this.colors.length-a))},_drawChartDebounced:function(){var a=this;if(this.chartData&&0<this.chartData.length){this._clearSVG(this.svg),this._setDimensions();var b=this._getSetSizesPromise();b.then(function(){a._setScales(),a._drawBars(),a._addStyleScope(a.svg)})}else setTimeout(function(){a._drawChartDebounced()},100)},_getSetSizesPromise:function(){var a=this;return new Promise(function(b){if(a.gridColumns=2*a._getLongestSeries(a.chartData).length-1,a.gridWidth=Math.round(a.widthValue/a.gridColumns),a.chartWidth=a.gridWidth*a.gridColumns,a.widthRemainder=a.widthValue%a.gridWidth,a._requireLegend()){var c=a._getLegendHeightPromise();c.then(function(c){a.legendHeight=c.y+25,a.chartHeight=a.heightValue-a.legendHeight,a.svg.attr('width',a.chartWidth).attr('height',a.heightValue),b(!0)})}else a.legendHeight=0,a.chartHeight=a.heightValue,a.svg.attr('width',a.chartWidth).attr('height',a.heightValue),b(!0)})},_requireLegend:function(){return 0<this.legendLabels.length},_getMax:function(){var a=[];return this.chartData.forEach(function(b){b.forEach(function(b,c){var d=typeof a[c];'undefined'===d.toString()?a[c]=b:a[c]+=b})}),d3.max(a)},_setScales:function(){this.yScale=d3.scale.linear().domain([0,this._getMax()]).range([0,this.chartHeight])},_getLegendHeightPromise:function(){return this._drawLegend(!0)},_drawLegendItem:function(a,b){var c=this;return new Promise(function(d){var e,f=c.chartData[a],g=3,h=5,i=c._getSeriesTotal(f);e=c.legendLabels.length>a?c.legendLabels[a]:i;var j=c._calculateTextWidth(e,'legend-text');j.then(function(f){var i=g+h+f+b.x,j=c._getColor(a);i>=c.chartWidth&&(b.y+=20,b.x=0);c.svg.append('rect').attr('class','legend-box').attr('x',b.x).attr('y',b.y).attr('width',g).attr('height',10).attr('fill',j);b.x+=g+h;c.svg.append('text').attr('class','legend-text').attr('x',b.x).attr('y',b.y+9).text(e);b.x+=Math.round(f+3*h),d({x:b.x,y:b.y})})})},_drawLegend:function(a){var b,c,a=a||!1,d=this.chartData.length,e={x:0,y:5};if('reverse'===this.legendOrder)for(b=d-1;0<=b;b--)c=this._drawLegendItem(b,e);else if('sequential'===this.legendOrder)for(b=0;b<d;b++)c=this._drawLegendItem(b,e);return a?c:''},_drawBars:function(){var a=[],b=this;this.chartData.forEach(function(c,d){var e=b._getColor(d);c.forEach(function(c,f){var g=Math.floor(b.yScale(c)),h=typeof a[f],i='undefined'===h.toString();a[f]=i?g:a[f]+g;var j=b.heightValue-a[f]-1,k=2*b.gridWidth*f;b._drawBar(k,j,b.gridWidth,g,d,e)})}),this.svg.append('line').attr('class','px-simple-bar-chart bar-chart-bottom-line').attr('x1',0).attr('y1',this.heightValue).attr('x2',this.chartWidth).attr('y2',this.heightValue)},_drawBar:function(a,b,c,d,e,f){this.svg.append('rect').attr('class','bar').attr('x',a).attr('y',b).attr('width',c).attr('height',d).attr('fill',f)}});</script></body></html>