<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="css/px-tooltip-styles.html"></head><body><dom-module id="px-tooltip"><template><style include="px-tooltip-styles"></style><div id="tooltip" class$="[[_getClass(visible, _tooltipPos)]]"><div id="message"><span>{{ tooltipMessage }}</span><slot></slot></div></div></template></dom-module><script>Polymer({is:'px-tooltip',behaviors:[Polymer.IronResizableBehavior],_values:{TYPE:{top:'top',bottom:'bottom',left:'left',right:'right'}},properties:{for:{type:HTMLElement,observer:'_onFor',notify:!0,value:''},delay:{type:Number,reflect:!0,value:500},orientation:{type:String,value:'auto'},tooltipMessage:{type:String,value:''},opened:{type:Boolean,value:!1,notify:!0},visible:{type:Boolean,value:!1,readOnly:!0,notify:!0},ignoreTargetEvents:{type:Boolean,value:!1},openRequested:{type:Boolean,value:!1,readOnly:!0,notify:!0},smartOrientation:{type:Boolean,value:!1},_cancel:{type:Boolean,value:!1},_tooltipParent:{type:Object,value:function(){return{}}},followMouse:{type:Boolean,value:!1},mouseCoords:{type:Array,value:[-9999,-9999]},_watchDogEnabled:{type:Boolean,value:!1},_firstAttached:{type:Boolean,value:!0},watchDogTimeout:{type:Number,value:250},_currTarget:{type:Object},_internalDetaching:{type:Boolean,value:!1},_margin:{type:Object,value:function(){return{top:10,bottom:10,left:10,right:10}}},_tooltipPos:{type:String,value:'right'}},observers:['_onMouseMove(mouseCoords.*)','_openedChanged(opened)','_ignoreTargetEventsChanged(ignoreTargetEvents)'],listeners:{"iron-resize":'_onIronResize'},attached:function(){this._firstAttached&&(this.setAttribute('role','tooltip'),this.set('_tooltipParent',this.parentNode),this._target?this.listenEvents():this._onFor(),this.set('_firstAttached',!1))},detached:function(){this._internalDetaching?(this._internalDetaching=!1,!this.openRequested&&this.fire('px-tooltip-hide',{target:this})):(this.set('opened',!1),this.unlistenEvents(),this._target=null,this._firstAttached=!0)},listenEvents:function(){if(this._target&&!this.ignoreTargetEvents)if(Array.isArray(this._target))for(var a=0;a<this._target.length;a++)this.listen(this._target[a],'mouseenter','_setOpenedTrue'),this.listen(this._target[a],'mouseup','_setOpenedTrue'),this.listen(this._target[a],'mouseleave','_setOpenedFalse'),this.listen(this._target[a],'mousedown','_setOpenedFalse');else this.listen(this._target,'mouseenter','_setOpenedTrue'),this.listen(this._target,'mouseup','_setOpenedTrue'),this.listen(this._target,'mouseleave','_setOpenedFalse'),this.listen(this._target,'mousedown','_setOpenedFalse')},unlistenEvents:function(){if(this._target)if(Array.isArray(this._target))for(var a=0;a<this._target.length;a++)this.unlisten(this._target[a],'mouseenter','_setOpenedTrue'),this.unlisten(this._target[a],'mouseup','_setOpenedTrue'),this.unlisten(this._target[a],'mouseleave','_setOpenedFalse'),this.unlisten(this._target[a],'mousedown','_setOpenedFalse');else this.unlisten(this._target,'mouseenter','_setOpenedTrue'),this.unlisten(this._target,'mouseup','_setOpenedTrue'),this.unlisten(this._target,'mouseleave','_setOpenedFalse'),this.unlisten(this._target,'mousedown','_setOpenedFalse')},_setOpenedTrue:function(){this.set('opened',!0)},_setOpenedFalse:function(){this.set('opened',!1)},_openedChanged:function(){!this.opened||this.visible&&this.openRequested||this._show(),!this.opened&&(this.visible||this.openRequested)&&this._hide()},_onMouseMove:function(){this.followMouse&&this.thisRect&&this.visible&&('auto'===this.orientation?this._autoPosition():this.smartOrientation?this._doPosition(this._findValidSmartOrientation(this.orientation)):this._doPosition(this.orientation))},_onFor:function(){this.unlistenEvents(),this.target=this._getTarget(),this._target=this.target,this.listenEvents()},_onIronResize:function(){this._watchDogEnabled&&this.debounce('tooltip-resize',function(){this.openRequested?this._processShow():this.visible&&this.setPosition()},50)},_getTarget:function(){var a,b=Polymer.dom(this).getOwnerRoot(),c=Polymer.dom(this).parentNode;if(this.for&&'string'===typeof this.for)a=Polymer.dom(c).querySelector('#'+this.for);else if(this.for&&Array.isArray(this.for)&&'string'===typeof this.for[0]){a=[];for(var d=0;d<this.for.length;d++)a.push(Polymer.dom(c).querySelector('#'+this.for[d]))}else a=this.for&&'object'===typeof this.for?this.for:11===c.nodeType?b?b.host:null:c;return a},_show:function(a){var b=this,c=Polymer.dom(a).rootTarget;this.set('_cancel',!1),this._setOpenRequested(!0),setTimeout(function(){return!0!==this._cancel&&void(c=c?c:this.target.length?this.target[0]:this.target,this.set('_currTarget',c),this._watchDogEnabled=!0,this._watchDog()&&(this._internalDetaching=!0,this.fire('px-tooltip-request-show',{target:this}),document.body.appendChild(this)))}.bind(this),this.delay)},_processShow:function(){this._cancel||(this._setVisible(!0),this.setPosition(),this.fire('px-tooltip-show',{target:this}),this._setOpenRequested(!1))},_hide:function(){this.set('_cancel',!0),(this.visible||this.openRequested)&&(this._watchDogEnabled=!1,this._setOpenRequested(!1),this._setVisible(!1),this.fire('px-tooltip-request-hide',{target:this}),this._tooltipParent&&this._tooltipParent.appendChild?(this._internalDetaching=!0,this._tooltipParent.appendChild(this)):this.remove?this.remove():this._setVisible('visible'))},setPosition:function(){this._target&&(this.targetRect=this.followMouse?this.getBoundingClientRect():this._target.getBoundingClientRect(),this.thisRect=this.followMouse?this.targetRect:this.getBoundingClientRect(),'auto'===this.orientation?this._autoPosition():this.smartOrientation?this._doPosition(this._findValidSmartOrientation(this.orientation)):this._doPosition(this.orientation))},_autoPosition:function(){this._doPosition(this._findValidSmartOrientation(this._values.TYPE.right))},_fitOnLeft:function(){var a,b,c,d=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left,e=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top+this.targetRect.height/2;return a=d-this.thisRect.width-5,b=e-this.thisRect.height/2,c=e+this.thisRect.height/2,0<a&&0<b&&c<window.innerHeight},_fitOnRight:function(){var a,b,c=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.right,d=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top+this.targetRect.height/2,e=c+this.thisRect.width+5,a=d-this.thisRect.height/2,b=d+this.thisRect.height/2;return e<window.innerWidth&&0<a&&b<window.innerHeight},_fitOnTop:function(){var a,b,c,d=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left+this.targetRect.width/2,e=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.top,a=e-this.thisRect.height-5,b=d+this.thisRect.width/2,c=d-this.thisRect.width/2;return 0<a&&b<window.innerWidth&&0<c},_fitBelow:function(){var a,b,c=this.followMouse?this.mouseCoords[0]-window.pageXOffset:this.targetRect.left+this.targetRect.width/2,d=this.followMouse?this.mouseCoords[1]-window.pageYOffset:this.targetRect.bottom,e=d+this.thisRect.height+5,a=c+this.thisRect.width/2,b=c-this.thisRect.width/2;return e<window.innerHeight&&a<window.innerWidth&&0<b},_findValidSmartOrientation:function(a){var b,c=[this._values.TYPE.left,this._values.TYPE.top,this._values.TYPE.right,this._values.TYPE.bottom],d=0;for(a===this._values.TYPE.left?b=0:a===this._values.TYPE.top?b=1:a===this._values.TYPE.right?b=2:a===this._values.TYPE.bottom?b=3:void 0,d=0;4>d;d++){if(this._orientationFit(c[b]))return c[b];b=(b+1)%4}return a},_orientationFit:function(a){switch(a){case this._values.TYPE.right:return this._fitOnRight();break;case this._values.TYPE.left:return this._fitOnLeft();break;case this._values.TYPE.top:return this._fitOnTop();break;case this._values.TYPE.bottom:return this._fitBelow();}},_doPosition:function(a){a===this._values.TYPE.right?this._positionRight():a===this._values.TYPE.left?this._positionLeft():a===this._values.TYPE.top?this._positionTop():a===this._values.TYPE.bottom?this._positionBottom():void 0},_positionTop:function(){this.set('_tooltipPos','top'),this.followMouse?(this.style.left=this.mouseCoords[0]-this.thisRect.width/2+'px',this.style.top=this.mouseCoords[1]-this.thisRect.height-this._margin.top+'px'):(this.style.left=this._getTargetPositionCenterOfLeftRight()-this.thisRect.width/2+'px',this.style.top=this._getTargetPositionTop()-this.thisRect.height-this._margin.top+'px')},_positionBottom:function(){this.set('_tooltipPos','bottom'),this.followMouse?(this.style.left=this.mouseCoords[0]-this.thisRect.width/2+'px',this.style.top=this.mouseCoords[1]+this._margin.bottom+'px'):(this.style.left=this._getTargetPositionCenterOfLeftRight()-this.thisRect.width/2+'px',this.style.top=this._getTargetPositionBottom()+this._margin.bottom+'px')},_positionLeft:function(){var a;this.set('_tooltipPos','left'),this.followMouse?(this.style.left=this.mouseCoords[0]-this.thisRect.width-this._margin.top+'px',this.style.top=this.mouseCoords[1]-this.thisRect.height/2+'px'):(a=Math.round(this._getTargetPositionCenterOfTopBottom()-this.thisRect.height/2)+'px',this.style.left=this._getTargetPositionLeft()-this.thisRect.width-this._margin.left+'px',this.style.top=a)},_positionRight:function(){var a;this.set('_tooltipPos','right'),this.followMouse?(this.style.left=this.mouseCoords[0]+10+'px',this.style.top=this.mouseCoords[1]-this.thisRect.height/2+'px'):(a=Math.round(this._getTargetPositionCenterOfTopBottom()-this.thisRect.height/2)+'px',this.style.left=this._getTargetPositionRight()+this._margin.left+'px',this.style.top=a)},_getTargetPositionTop:function(){return this._getTargetPosition('top','pageYOffset')},_getTargetPositionBottom:function(){return this._getTargetPositionTop()+this.targetRect.height},_getTargetPositionLeft:function(){return this._getTargetPosition('left','pageXOffset')},_getTargetPositionRight:function(){return this._getTargetPositionLeft()+this.targetRect.width},_getTargetPositionCenterOfTopBottom:function(){return this._getTargetPositionTop()+this.targetRect.height/2},_getTargetPositionCenterOfLeftRight:function(){return this._getTargetPositionLeft()+this.targetRect.width/2},_getTargetPosition:function(a,b){var c=this.targetRect[a];return c+=window[b],c},_isWithinDom:function(a){for(var b=a;b&&'BODY'!==b.nodeName;)b=11===b.nodeType?b.host:b.parentNode;return!!b},_watchDog:function(){return this._isWithinDom(this._currTarget)?(this._watchDogEnabled&&setTimeout(function(){this._watchDog()}.bind(this),this.watchDogTimeout),!0):(this._watchDogEnabled=!1,this.remove?this.remove():this.set('opened',!1),this.target.length&&this.target.remove(this._currTarget),!1)},_getClass:function(){var a='tooltip-container ';return this.visible||(a+=' hidden '),a+=this._tooltipPos,a},_ignoreTargetEventsChanged:function(){this.ignoreTargetEvents?this.unlistenEvents():this.listenEvents()}});</script></body></html>