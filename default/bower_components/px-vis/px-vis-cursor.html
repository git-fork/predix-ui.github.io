<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-cursor"><template><style include="px-vis-styles"></style></template></dom-module><script>Polymer({is:'px-vis-cursor',behaviors:[PxVisBehavior.observerCheck,PxVisBehavior.sizing,PxVisBehaviorD3.svg,PxVisBehaviorD3.axes,PxVisBehavior.dataset,PxVisBehavior.commonMethods,PxVisBehavior.tooltipData,PxVisBehaviorD3.clipPath,PxVisBehavior.mutedCompleteSeriesConfig,PxVisBehavior.dynamicConfigProperties,PxVisBehavior.polarData,PxVisBehavior.updateStylesOverride],properties:{_cursor:{type:Object},_vLines:{type:Object},_hLines:{type:Object},_circles:{type:Object},_hLinesBuilder:{type:Object},_vLinesBuilder:{type:Object},horizontalLine:{type:String,value:'full'},verticalLine:{type:String,value:'full'},circlePoint:{type:String,value:'yes'},mutedOpacity:{type:Number},radial:{type:Boolean,value:!1},_radiusCursor:{type:Object},radialAreaCursor:{type:Boolean,value:!1}},observers:['drawElement(svg,chartData.*,_mutedCompleteSeriesConfig, width, height)','_cursorChange(tooltipData.*, _cursor)','_addClipPath(clipPath)','_processOpacity(mutedSeries.*, completeSeriesConfig)','_updateColors(_stylesUpdated)'],ready:function(){this._watchConfigProperty('mutedOpacity',0.3)},drawElement:function(){this.hasUndefinedArguments(arguments)||(!this._cursor&&(this._cursor=this.svg.append('g').attr('display','none')),'none'!==this.horizontalLine&&this._drawHorizontalLines(),'none'!==this.verticalLine&&this._drawVerticalLines(),this.radialAreaCursor&&this._drawRadiusCursor(),'yes'===this.circlePoint&&this._drawPointCircles(),this._addClipPath(),this._processOpacity())},_drawHorizontalLines:function(){this._hLinesBuilder=this._cursor.selectAll('.xline').data(Object.keys(this._mutedCompleteSeriesConfig)),this._hLinesBuilder.exit().remove(),this._hLines=this.radial?this._hLinesBuilder.enter().append('circle').attr('class','xline').attr('stroke',this._checkThemeVariable('--px-vis-cursor-line-color','rgb(0,0,0)')).attr('fill','none').attr('opacity',1).attr('cx',0).attr('cy',0).merge(this._hLinesBuilder).attr('r',0):this._hLinesBuilder.enter().append('line').attr('class','xline').attr('stroke',this._checkThemeVariable('--px-vis-cursor-line-color','rgb(0,0,0)')).attr('opacity',1).attr('x1',0).merge(this._hLinesBuilder).attr('x2',this.width)},_drawVerticalLines:function(){this._vLinesBuilder=this._cursor.selectAll('line.yline').data(Object.keys(this._mutedCompleteSeriesConfig)),this._vLinesBuilder.exit().remove(),this._vLines=this._vLinesBuilder.enter().append('line').attr('class','yline').attr('stroke',this._checkThemeVariable('--px-vis-cursor-line-color','rgb(0,0,0)')).attr('opacity',1).attr('x1',0).attr('x2',0).attr('y1',0).merge(this._vLinesBuilder).attr('y2',this.radial?this.height+20:this.height)},_drawPointCircles:function(){this._circles=this._cursor.selectAll('circle.tooltipPoint').data(Object.keys(this._mutedCompleteSeriesConfig)),this._circles.exit().remove(),this._circles.enter().append('circle').attr('class','tooltipPoint').attr('r',3).attr('stroke-width',12).attr('stroke-opacity',0.3).merge(this._circles).attr('fill',function(a){return this._mutedCompleteSeriesConfig[a].color}.bind(this)).attr('stroke',function(a){return this._mutedCompleteSeriesConfig[a].color}.bind(this)),this._circles=this._cursor.selectAll('circle.tooltipPoint')},_cursorChange:function(){this.hasUndefinedArguments(arguments)||!this._isD3Empty(this._cursor)&&(null===this.tooltipData.mouse||0===this.tooltipData.series.length?this._hideCursor():(this._circles&&this._nonMutedSeriesKeys.length!==this._circles.nodes().length&&this.drawElement(),this._showCursor(),this._moveCursor()))},_showCursor:function(){this._cursor.attr('display',null)},_hideCursor:function(){this._cursor.attr('display','none')},_moveCursor:function(){this._moveCircles(),this._moveHorizontalLines(),this._moveVerticalLines()},_moveCircles:function(){'yes'===this.circlePoint&&this._circles&&this._circles.style('visibility',function(a,b){return!this.tooltipData.series[b].coord||isNaN(this.tooltipData.series[b].coord[0])||isNaN(this.tooltipData.series[b].coord[1])?'hidden':'visible'}.bind(this)).attr('cx',function(a,b){return this.tooltipData.series[b].coord&&!isNaN(this.tooltipData.series[b].coord[0])?this.tooltipData.series[b].coord[0]:null}.bind(this)).attr('cy',function(a,b){return this.tooltipData.series[b].coord&&!isNaN(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this))},_moveHorizontalLines:function(){this.radial?this._moveHorizontalLinesRadial():this._moveHorizontalLinesCartesian()},_moveHorizontalLinesRadial:function(){'none'!==this.horizontalLine&&this._hLines&&this._hLines.style('visibility',function(a,b){return!this.tooltipData.series[b].coord||isNaN(this.tooltipData.series[b].coord[0])||isNaN(this.tooltipData.series[b].coord[1])?'hidden':'visible'}.bind(this)).attr('r',function(a,b){var c=this.tooltipData.series[b].coord[0],d=this.tooltipData.series[b].coord[1];return this._isValidData(c)&&this._isValidData(d)?Math.sqrt(c*c+d*d):null}.bind(this))},_moveHorizontalLinesCartesian:function(){this._hLines&&('full'===this.horizontalLine?this._hLines.attr('y1',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)).attr('y2',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)):'left'===this.horizontalLine?this._hLines.attr('x2',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[0])?this.tooltipData.series[b].coord[0]:null}.bind(this)).attr('y1',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)).attr('y2',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)):'right'===this.horizontalLine&&this._hLines.attr('x1',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[0])?this.tooltipData.series[b].coord[0]:null}.bind(this)).attr('y1',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)).attr('y2',function(a,b){return this._isValidData(this.tooltipData.series[b].coord[1])?this.tooltipData.series[b].coord[1]:null}.bind(this)))},_moveVerticalLines:function(){this.radial?this._moveVerticalLinesRadial():this._moveVerticalLinesCartesian()},_moveVerticalLinesRadial:function(){'none'!==this.verticalLine&&this._vLines&&this._vLines.style('visibility',function(a,b){return!this.tooltipData.series[b].coord||isNaN(this.tooltipData.series[b].coord[0])||isNaN(this.tooltipData.series[b].coord[1])?'hidden':'visible'}.bind(this)).attr('transform',function(a,b){var c=this._mutedCompleteSeriesConfig[this.tooltipData.series[b].name].x,d=this._mutedCompleteSeriesConfig[this.tooltipData.series[b].name].y,e=this.tooltipData.series[b].value[c];return e||0===e?(0>this.tooltipData.series[b].value[d]&&!this.allowNegativeValues&&(e=this.useDegrees?e-180:e-Math.PI),e=this._adjustAngleForPolarChart(e,this.useDegrees)):e=0,'rotate('+e+')'}.bind(this))},_moveVerticalLinesCartesian:function(){this._vLines&&('none'!==this.verticalLine&&this._vLines.attr('x1',function(a,b){return this.tooltipData.series[b].coord[0]?this.tooltipData.series[b].coord[0]:null}.bind(this)).attr('x2',function(a,b){return this.tooltipData.series[b].coord[0]?this.tooltipData.series[b].coord[0]:null}.bind(this)),'bottom'===this.verticalLine?this._vLines.attr('y1',Math.max.apply(null,this.tooltipData.yArr)):'top'===this.verticalLine&&this._vLines.attr('y1',Math.min.apply(null,this.tooltipData.yArr)).attr('y2',-this.height))},_addClipPath:function(){if(!this.hasUndefinedArguments(arguments)&&this.clipPath){if('none'!==this.verticalLine&&this._vLines&&this.addClipPath(this._vLines),'none'!==this.horizontalLine&&this._hLines)for(var a=this._hLines.nodes(),b=0;b<a.length;b++)this.addClipPath(Px.d3.select(a[b]));'no'!==this.circlePoint&&this._circles&&this.addClipPath(this._circles),this.radialAreaCursor&&this._radiusCursor&&this.addClipPath(this._radiusCursor)}},_processOpacity:function(){if(!this.hasUndefinedArguments(arguments)){for(var a=!0,b=Object.keys(this._mutedCompleteSeriesConfig),c=this,d=1<b.length,e=0;e<b.length;e++)if(!this.mutedSeries[b[e]]){a=!1;break}this._vLines&&this._vLines.attr('opacity',a?this._defaultmutedOpacity:1),this._hLines&&this._hLines.each(function(a){var b,d=c.mutedSeries&&!0===c.mutedSeries[a];b=d?c._mutedCompleteSeriesConfig[a]&&c._mutedCompleteSeriesConfig[a].mutedOpacity?c._mutedCompleteSeriesConfig[a].mutedOpacity:c._defaultmutedOpacity:1,this.setAttribute('opacity',b)}),this._circles&&this._circles.each(function(a){var b,d,e,f=c.mutedSeries&&!0===c.mutedSeries[a];b=f?c._mutedCompleteSeriesConfig[a]&&c._mutedCompleteSeriesConfig[a].mutedOpacity?c._mutedCompleteSeriesConfig[a].mutedOpacity:c._defaultmutedOpacity:1,d=f?1*b:1,e=f?0.3*b:0.3,this.setAttribute('opacity',d),this.setAttribute('stroke-opacity',e)})}},_updateColors:function(){this.hasUndefinedArguments(arguments)||(this._doesD3HaveValues(this._hLines)&&this._hLines.attr('stroke',this._checkThemeVariable('--px-vis-cursor-line-color','rgb(0,0,0)')),this._doesD3HaveValues(this._vLines)&&this._vLines.attr('stroke',this._checkThemeVariable('--px-vis-cursor-line-color','rgb(0,0,0)')))}});</script></body></html>