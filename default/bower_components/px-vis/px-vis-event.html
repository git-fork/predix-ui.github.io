<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="px-vis-behavior-datetime.html"><link rel="import" href="../px-tooltip/px-tooltip.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-event"><template><style include="px-vis-styles"></style><template is="dom-if" if="[[_thisConfig.enableTooltip]]"><px-tooltip id="eventTooltip" for="[[_getTooltiptarget(eventIcon)]]" smart-orientation="" delay="10" orientation="[[tooltipOrientation]]"><span><b>[[localize("Event")]]</b>: [[eventData.label]]<br><b>[[localize("ID")]]</b>: [[eventData.id]]<br><b>[[_getValueTitle(xAxisType, localize)]]</b>[[_value]]<br></span></px-tooltip></template></template></dom-module><script>Polymer({is:'px-vis-event',behaviors:[PxVisBehavior.observerCheck,PxVisBehaviorD3.svg,PxVisBehaviorD3.axes,PxVisBehavior.sizing,PxVisBehavior.axisTypes,PxVisBehaviorTime.datetime,PxVisBehaviorD3.clipPath,PxVisBehavior.commonMethods,PxVisBehavior.events,PxVisBehaviorD3.domainUpdate,Polymer.AppLocalizeBehavior,PxVisBehaviorD3.icons,PxVisBehavior.updateStylesOverride],properties:{eventGroup:{type:Object,value:function(){return{}}},eventLine:{type:Object,value:function(){return{}}},eventIcon:{type:Object,value:function(){return{}}},_thisConfig:{type:Object,value:function(){return{}}},tooltipOrientation:{type:String,value:'left'},xKey:{type:String,value:'x'},_eventConfigChanged:{type:Boolean,value:!1},_animationFrameDone:{type:Boolean,value:!1},_eventDrawn:{type:Boolean,value:!1},resources:{type:Object,value:function(){return{en:{Event:'Event',ID:'ID',Timestamp:'Timestamp',X:'X'}}}},language:{type:String,value:'en'},useKeyIfMissing:{type:Boolean,value:!0},_hasBeenDetached:{type:Boolean,value:!1},_reCalcValue:{type:Boolean,value:!0},_value:{type:String}},observers:['drawElement(svg, eventData.*, eventConfig.*, _animationFrameDone, height, _stylesUpdated)','_calcThemeOrConfig(_stylesUpdated)','_eventConfigChanged(eventConfig.*)','positionElement(x, domainChanged)','_addClipPath(clipPath)','_recalcValue(eventData, xAxisType, eventConfig.*)'],listeners:{"px-tooltip-request-show":'_tooltipRequest'},detached:function(){this._eventDrawn=!1,this.eventGroup&&this._doesD3HaveValues(this.eventGroup)&&(this.eventGroup.remove(),this.eventGroup=null,this.eventLine=null,this.eventIcon=null,this._hasBeenDetached=!0)},attached:function(){this._hasBeenDetached&&(this._hasBeenDetached=!1,this.drawElement())},ready:function(){window.requestAnimationFrame(function(){this.updateStyles()}.bind(this)),this._iconCallbackQueue=[this._addIcon,this.positionElement,this._addClipPath]},_tooltipRequest:function(){this._reCalcValue&&(this.set('_value',this._getValue()),this._reCalcValue=!1)},_eventConfigChanged:function(){this.hasUndefinedArguments(arguments)||this._processConfiguration()},_recalcValue:function(){this.hasUndefinedArguments(arguments)||(this._reCalcValue=!0)},_getTooltiptarget:function(){return this.hasUndefinedArguments(arguments)?void 0:this.eventIcon&&this.eventIcon.node?this.eventIcon.node():null},_calcThemeOrConfig:function(){this.defaultEventConfig||(this.defaultEventConfig={color:this._defaultDefaultEventConfig.fillColor,icon:this._defaultDefaultEventConfig.icon,type:this._defaultDefaultEventConfig.type,offset:this._defaultDefaultEventConfig.offset,size:this._defaultDefaultEventConfig.size,lineColor:this._defaultDefaultEventConfig.lineColor,lineWeight:this._defaultDefaultEventConfig.lineWeight,enableTooltip:this._defaultDefaultEventConfig.enableTooltip,firstDateTimeFormat:this._defaultDefaultEventConfig.firstDateTimeFormat,secondDateTimeFormat:this._defaultDefaultEventConfig.secondDateTimeFormat,separator:this._defaultDefaultEventConfig.separator,timezone:this._defaultDefaultEventConfig.timezone,tooltipOrientation:this._defaultDefaultEventConfig.tooltipOrientation}),this.defaultEventConfig.lineColor=this._checkThemeVariable('--px-vis-event-line-color',this._defaultDefaultEventConfig.lineColor),this.defaultEventConfig.eventColor=this._checkThemeVariable('--px-vis-event-icon-color',this._defaultDefaultEventConfig.fillColor),this.set('_animationFrameDone',!0)},drawElement:function(){this.hasUndefinedArguments(arguments)||this.svg&&this._doesObjHaveValues(this.eventData)&&this._animationFrameDone&&(this.eventGroup&&this._doesD3HaveValues(this.eventGroup)&&(this._eventDrawn=!1,this.eventGroup.remove(),this.eventGroup=null),this._processConfiguration(),this.eventGroup=this.svg.append('g').attr('class','event').attr('pointer-events','all'),this.eventLine=this.eventGroup.append('line').attr('stroke',this._checkColorType(this._thisConfig.lineColor)).attr('stroke-width',this._thisConfig.lineWeight),this._addIcon(),this.positionElement(),this._addClipPath(),this.notifyPath('_thisConfig.enableTooltip'))},positionElement:function(){this.hasUndefinedArguments(arguments)||this.x&&this._eventDrawn&&this._positionEvent()},_addClipPath:function(){this.hasUndefinedArguments(arguments)||(this.addClipPath(this.eventLine),this.addClipPath(this.eventIcon))},_positionEvent:function(){this.eventLine.attr('x1',this.x(this.eventData[this.xKey])).attr('x2',this.x(this.eventData[this.xKey])).attr('y1',Math.max(this.height-this.margin.top,0)).attr('y2',0);var a=this.x(this.eventData[this.xKey])-+this._thisConfig.size/2+this._thisConfig.offset[0],b=-5+this._thisConfig.offset[1],c='image'===this._thisConfig.type?b:b-this._thisConfig.size;translate='translate('+a+','+c+')',scale='image'===this._thisConfig.type?'':' scale('+this._iconScale+')',this.eventIcon.attr('transform',translate+scale)},_addIcon:function(){if('image'===this._thisConfig.type)this.eventIcon=this.eventGroup.append('image').attr('xlink:href',this._thisConfig.icon).attr('width',this._thisConfig.size+'px').attr('height',this._thisConfig.size+'px').style('cursor','pointer');else{var a=this._getIcon(this._thisConfig.icon,this._thisConfig.size,'px-utl','information');if(!a)return void(this._eventDrawn=!1);this.eventIcon=Px.d3.select(this.eventGroup.node().appendChild(a)).attr('fill','transparent').attr('stroke',this._thisConfig.color).style('cursor','pointer')}this._eventDrawn=!0},_processConfiguration:function(){if(this.eventConfig[this.eventData.label]){var a,b=Object.keys(this.defaultEventConfig),c=b.length;for(a=0;a<c;a++)this._thisConfig[b[a]]=this.eventConfig[this.eventData.label][b[a]]||0===this.eventConfig[this.eventData.label][b[a]]||!1===this.eventConfig[this.eventData.label][b[a]]?this.eventConfig[this.eventData.label][b[a]]:this.defaultEventConfig[b[a]];this._thisConfig.firstDateTimeFormat&&(this.firstDateTimeFormat=this._thisConfig.firstDateTimeFormat),this._thisConfig.secondDateTimeFormat&&(this.secondDateTimeFormat=this._thisConfig.secondDateTimeFormat),this._thisConfig.timezone&&(this.timezone=this._thisConfig.timezone),this._thisConfig.tooltipOrientation&&this.set('tooltipOrientation',this._thisConfig.tooltipOrientation),this._thisConfig.separator&&(this.separator=this._thisConfig.separator),'undefined'!==typeof this._thisConfig.enableTooltip&&this.notifyPath('_thisConfig.enableTooltip')}else this._thisConfig=this.defaultEventConfig},_formatDatetime:function(a,b){return this.formatTimestamp(a,this.timezone,b)},_getValueTitle:function(a){return'time'===a||'timeLocal'===a?this.localize('Timestamp'):this.localize('X')},_getValue:function(){return'time'===this.xAxisType||'timeLocal'===this.xAxisType?': '+this._formatDatetime(this.eventData[this.xKey],this.firstDateTimeFormat)+' '+this.separator+' '+this._formatDatetime(this.eventData[this.xKey],this.secondDateTimeFormat):': '+this.eventData[this.xKey]}});</script></body></html>