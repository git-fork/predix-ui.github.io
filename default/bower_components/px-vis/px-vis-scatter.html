<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-scatter"><template><style include="px-vis-styles"></style></template></dom-module><script>Polymer({is:'px-vis-scatter',behaviors:[PxVisBehavior.observerCheck,PxVisBehaviorD3.svg,PxVisBehaviorD3.axes,PxVisBehavior.dataset,PxVisBehavior.mutedSeries,PxVisBehavior.commonMethods,PxVisBehaviorD3.clipPath,PxVisBehavior.completeSeriesConfig,PxVisBehaviorD3.radialLineGenerator,PxVisBehaviorD3.domainUpdate,PxVisBehavior.polarData,PxVisBehavior.seriesId,PxVisBehavior.dynamicConfigProperties,PxVisBehaviorD3.serieToRedrawOnTopSVG,PxVisBehavior.isAttached,PxVisBehaviorD3.scatterMarkers,PxVisBehaviorD3.scatterArrow],properties:{seriesNumber:{type:Number,value:0},scatterGroup:{type:Object,value:function(){return{}}},scatterDots:{type:Object},scatterBuilder:{type:Object},arrowDots:{type:Object},arrowBuilder:{type:Object},radial:{type:Boolean,value:!1},timeData:{type:String,value:'Timestamp'},drawDebounceTime:{type:Number,value:10}},observers:['drawElement(svg, domainChanged, chartData.*, completeSeriesConfig.*, radial, counterClockwise,markerSymbol, markerScale, markerSize, markerFillOpacity, markerStrokeOpacity)','isIdInMuted(mutedSeries.*)','_addClipPath(clipPath)','_drawOnTop(serieToRedrawOnTop)'],ready:function(){this._watchConfigProperty('markerSymbol','circle'),this._watchConfigProperty('markerScale',1),this._watchConfigProperty('markerSize',64),this._watchConfigProperty('markerFillOpacity',0.6),this._watchConfigProperty('markerStrokeOpacity',1),this._watchConfigProperty('mutedOpacity',0.3)},attached:function(){this._isDirty&&this.drawElement(),this._isDirty=!1},detached:function(){this._isDirty=!0,this.scatterDots=null,this._doesD3HaveValues(this.scatterGroup)&&(this.scatterGroup.remove(),this.scatterGroup=null)},drawElement:function(){this.hasUndefinedArguments(arguments)||!this.preventInitialDrawing&&(0<this.drawDebounceTime?this.debounce('draw',function(){this._drawElementDebounced()}.bind(this),this.drawDebounceTime):this._drawElementDebounced())},_drawElementDebounced:function(){this.y&&'undefined'!==typeof this.domainChanged&&null!==this.domainChanged&&this._isAttached&&this.chartData&&(this._isObjEmpty(this.scatterGroup)&&(this.scatterGroup=this.svg.append('g').attr('series-id','scatter_'+this.seriesId).attr('class','series-scatter')),this.radial&&(this._defineRadialLine(!1,this.multiPath,this.counterClockwise,this.useDegrees),this.showArrows&&this._buildArrows()),this.scatterBuilder=this.scatterGroup.selectAll('path.symbol').data(this.chartData),this.scatterBuilder.exit().remove(),this.scatterBuilder.enter().append('path').attr('class','symbol').merge(this.scatterBuilder).attr('d',Px.d3.symbol().type(this.markerMapping[this.markerSymbol]).size(this.markerSize)).attr('transform',this._applyTransform.bind(this)).each(function(a,b,c){this._isValidData(a[this.completeSeriesConfig[this.seriesId].y])&&this._isValidData(a[this.completeSeriesConfig[this.seriesId].x])||c[b].remove()}.bind(this)),this.scatterDots=this.scatterGroup.selectAll('path.symbol'),this._colorScatter(),this._addClipPath(),this.isIdInMuted(),this.fire('px-vis-scatter-rendering-ended'))},_addClipPath:function(){this.hasUndefinedArguments(arguments)||this.addClipPath(this.scatterGroup)},isIdInMuted:function(){this.hasUndefinedArguments(arguments)||this.mutedSeries.hasOwnProperty(this.seriesId)&&this._doesD3HaveValues(this.scatterDots)&&this._colorScatter()},_applyTransform:function(a){if(!this._isValidData(a[this.completeSeriesConfig[this.seriesId].y])||!this._isValidData(a[this.completeSeriesConfig[this.seriesId].x]))return'';if(this.radial){var b=this.line([a]),c=b.slice(1).slice(0,-1);return'translate('+c+') scale('+this.markerScale+')'}var d=this.x(a[this.completeSeriesConfig[this.seriesId].x]),e=this.y(a[this.completeSeriesConfig[this.seriesId].y]);return'translate('+d+','+e+') scale('+this.markerScale+')'},_colorScatter:function(){var a=this.mutedSeries[this.seriesId];this.scatterGroup.attr('fill',this.completeSeriesConfig[this.seriesId].color).attr('fill-opacity',a?this.mutedOpacity:this.markerFillOpacity).attr('stroke',this.completeSeriesConfig[this.seriesId].color).attr('stroke-opacity',a?0:this.markerStrokeOpacity)},_drawOnTop:function(a){this.hasUndefinedArguments(arguments)||this.scatterGroup&&this.seriesId&&this._drawSVGOnTop(a,this.seriesId,this.scatterGroup)},_buildArrows:function(){this.arrowBuilder=this.scatterGroup.selectAll('path.arrow').data(this.chartData),this.arrowBuilder.exit().remove(),this.arrowBuilder.enter().append('path').attr('class','arrow').merge(this.arrowBuilder).attr('d',Px.d3.symbol().type(this.markerMapping[this.arrowConfig.symbol]).size(this.arrowConfig.size)).attr('transform',this._transformArrow.bind(this)).each(function(a,b,c){this._isValidData(a[this.completeSeriesConfig[this.seriesId].x])&&this._isValidData(a[this.completeSeriesConfig[this.seriesId].y])&&0!==b&&this._isValidData(this.chartData[b-1][this.completeSeriesConfig[this.seriesId].x])&&this._isValidData(this.chartData[b-1][this.completeSeriesConfig[this.seriesId].y])||c[b].remove()}.bind(this)),this.arrowDots=this.scatterGroup.selectAll('path.arrow')},_transformArrow:function(a,b){var c=Math.PI;if(!this._isValidData(a[this.completeSeriesConfig[this.seriesId].x])||!this._isValidData(a[this.completeSeriesConfig[this.seriesId].y])||0===b||!this._isValidData(this.chartData[b-1][this.completeSeriesConfig[this.seriesId].x])||!this._isValidData(this.chartData[b-1][this.completeSeriesConfig[this.seriesId].y]))return'';var d,e,f,g,i=this.line([this.chartData[b-1]]),j=this.line([a]),k=i.slice(1).slice(0,-1).split(','),l=j.slice(1).slice(0,-1).split(','),m=(+l[0]-+k[0])/2,n=(+l[1]-+k[1])/2,o=Math.sqrt(m*m+n*n);return o<this.arrowConfig.minLength?'':(d=m+ +k[0],e=n+ +k[1],f=Math.atan2(n,m)+c/2,g=180*f/c,'rotate('+g+' '+d+','+e+') translate('+d+','+e+') scale('+this.arrowConfig.scale+')')}});</script></body></html>