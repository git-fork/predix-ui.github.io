<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-chart.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="px-vis-interactive-axis.html"><link rel="import" href="css/px-vis-styles.html"></head><body><dom-module id="px-vis-multi-axis"><template><style include="px-vis-styles"></style><template id="bof" is="dom-repeat" items="[[_internalDimensions]]"><px-vis-interactive-axis id="ia_[[item]]" prevent-initial-drawing="[[preventInitialDrawing]]" class="multiAxis" svg="[[svg]]" x="[[x]]" y="[[_returnY(item, _internalDimensionsChanged)]]" category-key="[[categoryKey]]" dimension="[[item]]" axes="[[axes]]" dimensions="[[dimensions]]" series-key="[[seriesKey]]" height="[[_heightOrLen]]" width="[[width]]" margin="[[margin]]" chart-data="[[chartData]]" radial="[[radial]]" orientation="[[_getOrientation(item, orientationFromDimensions, domainChanged, _pokeOrientation)]]" title="[[_getTitle(item,completeSeriesConfig, axisConfig)]]" title-location="[[_computeTitleLocation(item, titleLocation, _pokeTitleLocation)]]" title-type-size="[[titleTypeSize]]" label-type-size="[[labelTypeSize]]" stroke-width="[[strokeWidth]]" outer-tick-size="0" truncation-length="[[truncationLength]]" complete-series-config="[[completeSeriesConfig]]" append-unit-in-title="[[appendUnitInTitle]]" unit="[[_getUnit(item, completeSeriesConfig)]]" prevent-series-bar="[[preventSeriesBar]]" domain-changed="[[_internalDimensionsChanged]]" selected-domain="[[selectedDomain]]" title-truncation="true" disable-ticks="[[_calcDisableTicks(item,recalcTicks)]]" label-position="[[labelPosition]]" axis-color="[[axisColor]]" ticks="[[ticks]]" tick-values="[[_returnTickValues(item, tickValues.*)]]" label-rotation="[[labelRotation]]" label-translation="[[labelTranslation]]" series-on-axis="[[_returnSeriesArray(seriesToAxes, item)]]" muted-series="[[mutedSeries]]" combined-muted-series="[[combinedMutedSeries]]" hard-mute="[[hardMute]]" drawn-tick-values="[[drawnTickValues]]" rebuild-on-draw="[[_rebuildOnDraw]]" disable-brush="[[disableBrush]]" drag-behavior="[[dragBehavior]]" redraw-series="[[redrawSeries]]" brush-domains="[[brushDomains]]" hide-and-show-on-hover="[[_isFirst(index, commonAxis)]]" cartesian-drag-behavior="[[cartesianDragBehavior]]" brush-to-remove="[[brushToRemove]]" action-config="[[actionConfig]]" interaction-space-config="[[interactionSpaceConfig]]" center-offset="[[centerOffset]]" smaller-side="[[smallerSide]]" time-domain="[[timeDomain]]"></px-vis-interactive-axis></template></template></dom-module><script>Polymer({is:'px-vis-multi-axis',behaviors:[PxVisBehavior.observerCheck,PxVisBehavior.svgDefinition,PxVisBehavior.sizing,PxVisBehavior.completeSeriesConfig,PxVisBehavior.commonMethods,PxVisBehaviorD3.axisConfig,PxVisBehavior.dataset,PxVisBehavior.dimensions,PxVisBehavior.mutedSeries,PxVisBehaviorD3.dynamicRedraw,PxVisBehavior.commonAxis,PxVisBehaviorD3.domainUpdate,PxVisBehaviorD3.selectedDomain,PxVisBehavior.radial,PxVisBehaviorD3.radialAxisConfig,PxVisBehavior.seriesToAxes,PxVisBehaviorChart.subConfiguration,PxVisBehavior.preventInitialDrawing,PxVisBehavior.categories,PxVisBehavior.actionConfigGeneric,PxVisBehavior.interactionSpaceConfigGeneric,PxVisBehavior.combinedMutedSeries,PxVisBehavior.brushDomains,PxVisBehavior.timeDomain,PxVisBehavior.titleTruncation],properties:{matchTicks:{type:Boolean,value:!1},gridTicks:{type:Object,notify:!0},gridAxis:{type:Object,notify:!0},appendUnitInTitle:{type:Boolean,value:!1},displayedValues:{type:Object,notify:!0},_internalDimensions:{type:Array},_internalDimensionsChanged:{type:Boolean,value:!1},singleDomain:{type:Boolean,value:!1},labelOneAxis:{type:Boolean,value:!1},length:{type:Number,value:null},_heightOrLen:{type:Number,computed:'_calcH(height,length)'},brushToRemove:{type:Boolean,value:!1},_lastDomainChanged:{type:Boolean,value:null},_pokeTitleLocation:{type:Boolean,value:!1},recalcTicks:{type:Boolean,value:!1},orientationFromDimensions:{type:Boolean,value:!1},leftAxisSize:{type:Number},rightAxisSize:{type:Number},disableBrush:{type:Boolean,value:!1},preventSeriesBar:{type:Boolean,value:!1},cartesianDragBehavior:{type:Boolean,value:!1},_pokeOrientation:{type:Boolean,value:!1},axisConfig:{type:Object,value:function(){return{}}},allowEmptyTitle:{type:Boolean,value:!1},_axisDoneCounter:{type:Number,value:0},_rebuildOnDraw:{type:Boolean,value:!0},_mutedSeriesPerBrush:{type:Object,value:function(){return{}}},_displayedTitlesCounter:{type:Number,value:0},_displayedTitlesBuilder:{type:Object,value:function(){return{}}},_drawnTickValuesChangedCounter:{type:Number,value:0},_normalizedTicks:{type:Boolean,value:!1},smallerSide:{type:Number,value:0}},observers:['_axisConfigChanged(axisConfig.*)','_computedInternalDimensions(domainChanged, x, dimensions)','_recalcGTransforms(leftAxisSize, rightAxisSize)','_toggleTitleLocation(length)'],listeners:{"px-vis-drag-dimension-swapped":'_axisDragged',"px-vis-axis-displayed-title-changed":'_displayedTitleChanged',"px-vis-recalc-title-location":'_toggleTitleLocation',"px-axis-orientation-changed":'_toggleOrientation',"dom-change":'_axisConfigChanged',"px-vis-axis-drawn-tick-values-changed":'_drawnTickValuesChanged'},_axisConfigChanged:function(){if(!this.hasUndefinedArguments(arguments)&&this.axisConfig&&this._doesObjHaveValues(this.dimensions)){for(var b,c=Object.keys(this.axisConfig),d=!1,e=!1,f={},g=[],h={},k=[],l=0;l<c.length;l++)if(b=c[l],-1===this.dimensions.indexOf(b))f[b]=this.axisConfig[b],g.push(b),d=!0;else{var i={};i[b]=this.axisConfig[b],k.push(i),e=!0}if(!d&&e){for(var l=0;l<k.length;l++){var m=k[l],n=Object.keys(m);this.$$('#ia_'+n)&&this.$$('#ia_'+n).set('axisConfig',m)}return}if(d)for(var l=0;l<this.dimensions.length;l++)h[this.dimensions[l]]=this._copyConfig(g,f);if(e)for(var l=0;l<k.length;l++){var m=k[l],n=Object.keys(m),a=Object.keys(k[l][n]);h[n]=h[n]||{};for(var o=0;o<a.length;o++)h[n][a[o]]=m[n][a[o]]}for(var n,l=0;l<this.dimensions.length;l++)n=this.dimensions[l],this.$$('#ia_'+n)&&this.$$('#ia_'+n).set('axisConfig',h[n])}},_copyConfig:function(a,b){for(var d={},c=0;c<a.length;c++)d[a[c]]=b[a[c]];return d},_axisDragged:function(a){this.cartesianDragBehavior?(this.x.leftDomain(a.detail.lDims),this.x.rightDomain(a.detail.rDims),this.set('dimensions',a.detail.dimensions)):this.x.domain(this.dimensions),this.$$('px-vis-interactive-axis#ia_'+a.detail.swappedDim).recalcTranform()},_computeTitleLocation:function(a,b){var c=Math.cos,d=Math.sin,e=Math.PI;if(!this.hasUndefinedArguments(arguments)){if(this.radial){var f=180*this.x(a)/e,g={x:null,y:null,r:-1*(f+180),anchor:null};return 10<f&&100>=f?(g.anchor='start',g.x=0,g.y=this.length+10):100<f&&170>f?(g.anchor='start',g.x=-12*d(e-this.x(a)),g.y=this.length+10+12*c(e-this.x(a))):170<=f&&190>=f?(g.anchor='middle',g.x=-12*d(e-this.x(a)),g.y=this.length+10+12):190<f&&260>f?(g.anchor='end',g.x=-12*d(e-this.x(a)),g.y=this.length+10+12*c(e-this.x(a))):260<=f&&355>f?(g.anchor='end',g.x=0,g.y=this.length+10):(g.anchor='middle',g.x=-12*d(e-this.x(a)),g.y=this.length+10),g}return b}},_toggleTitleLocation:function(){this.hasUndefinedArguments(arguments)||this.set('_pokeTitleLocation',!this._pokeTitleLocation)},_calcH:function(a,b){return this.hasUndefinedArguments(arguments)?void 0:b?b:a},_returnY:function(a){return this.hasUndefinedArguments(arguments)?void 0:this.singleDomain?this.y:this.y[a]},_calcDisableTicks:function(a){return this.hasUndefinedArguments(arguments)?void 0:!!this.labelOneAxis&&this.dimensions[0]!==a},_computedInternalDimensions:function(){if(!this.hasUndefinedArguments(arguments))if(this._lastDomainChanged!==this.domainChanged){this._lastDomainChanged=this.domainChanged,this._rebuildOnDraw=!0;var a=!!this._internalDimensions,b=a&&this.dimensions.join()===this._internalDimensions.join()?!1:!0;this.set('_internalDimensions',this.dimensions),b&&a&&(this.$.bof.render(),this.set('_pokeTitleLocation',!this._pokeTitleLocation)),this.set('_internalDimensionsChanged',!this._internalDimensionsChanged)}else 0===this.dimensions.length&&this._internalDimensions&&0<this._internalDimensions.length&&(this.set('_internalDimensions',[]),this.set('_internalDimensionsChanged',[]))},_getTitle:function(a){return this.hasUndefinedArguments(arguments)?void 0:this.completeSeriesConfig?this.axisConfig&&this.axisConfig[a]&&this.axisConfig[a].title?this.axisConfig[a].title:this.completeSeriesConfig[a]&&this.completeSeriesConfig[a].title?this.completeSeriesConfig[a].title:this.allowEmptyTitle?'':a:void 0},deleteAllBrushes:function(){this.$.axisBrush.deleteAllBrushes()},_getOrientation:function(a,b){if(!this.hasUndefinedArguments(arguments)){if(b){var c=this.x.rightDomain();return-1===c.indexOf(a)?'left':'right'}return'left'}},_recalcGTransforms:function(a,b){this.hasUndefinedArguments(arguments)||a&&b&&this._doesD3HaveValues(this.svg)&&this._doesD3HaveValues(this.svg.selectAll('.dimension'))&&this.svg.selectAll('.dimension').attr('transform',function(a){return this.x(a)||0===this.x(a)?'translate('+this.x(a)+',0)':''}.bind(this))},_returnSeriesArray:function(a,b){return this.hasUndefinedArguments(arguments)?void 0:a&&a[b]?a[b]:[]},_toggleOrientation:function(){this.set('_pokeOrientation',!this._pokeOrientation)},_getUnit:function(a){if(!this.hasUndefinedArguments(arguments)){if(this.completeSeriesConfig[a]&&this.completeSeriesConfig[a].yAxisUnit)return this.completeSeriesConfig[a].yAxisUnit;if(this.seriesToAxes&&this.seriesToAxes[a])for(var b,c=0;c<this.seriesToAxes[a].length;c++)if(b=this.seriesToAxes[a][c],this.completeSeriesConfig[b]&&this.completeSeriesConfig[b].yAxisUnit)return this.completeSeriesConfig[b].yAxisUnit;return''}},_drawnTickValuesChanged:function(a){this._drawnTickValuesChangedCounter++,this.debounce('_drawnTickValuesChangedFallback',function(){this._applyDrawnTickValuesChanged(a.detail.drawnTickValues)}.bind(this),10),this._drawnTickValuesChangedCounter===this._internalDimensions.length&&(this.cancelDebouncer('_drawnTickValuesChangedFallback'),this._applyDrawnTickValuesChanged(a.detail.drawnTickValues))},_applyDrawnTickValuesChanged:function(a){this.set('drawnTickValues',a),this._drawnTickValuesChangedCounter=0},_displayedTitleChanged:function(a){this._displayedTitlesCounter++,this._displayedTitlesBuilder[a.detail.id]=a.detail.displayedTitle,this.debounce('_displayedTitleChangedFallback',function(){if(this.displayedValues)for(var a=Object.keys(this.displayedValues),b=0;b<a.length;b++)this._displayedTitlesBuilder[a[b]]||(this._displayedTitlesBuilder[a[b]]=this.displayedValues[a[b]]);this._applyDisplayedTitlesChanged()}.bind(this),50),this._displayedTitlesCounter===this._internalDimensions.length&&(this.cancelDebouncer('_displayedTitleChangedFallback'),this._applyDisplayedTitlesChanged()),a.stopPropagation(),a.stopImmediatePropagation()},_applyDisplayedTitlesChanged:function(){this.set('displayedValues',this._displayedTitlesBuilder),this._displayedTitlesCounter=0,this._displayedTitlesBuilder={}},_isFirst:function(a){return this.hasUndefinedArguments(arguments)?void 0:!!this.commonAxis&&0!==a},_returnTickValues:function(a){if(this.tickValues)return this.tickValues[a]}});</script></body></html>