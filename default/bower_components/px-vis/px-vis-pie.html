<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-vis-behavior-common.html"><link rel="import" href="px-vis-behavior-d3.html"><link rel="import" href="px-vis-behavior-colors.html"><link rel="import" href="../px-tooltip/px-tooltip.html"><link rel="import" href="../px-popover/px-popover.html"><link rel="import" href="css/px-vis-pie-styles.html"></head><body><dom-module id="px-vis-pie"><template><style include="px-vis-pie-styles"></style></template></dom-module><script>Polymer({is:'px-vis-pie',behaviors:[PxVisBehavior.observerCheck,PxVisBehaviorD3.svg,PxVisBehavior.dataset,PxVisBehavior.mutedSeries,PxVisBehavior.commonMethods,PxVisBehavior.sizing,PxVisBehavior.dataset,PxVisBehavior.completeSeriesConfig,PxColorsBehavior.getSeriesColors,PxColorsBehavior.dataVisColorTheming,PxVisBehavior.updateStylesOverride],properties:{empty:{type:Boolean,value:!1,observer:'_emptyChanged'},seriesNumber:{type:Number,value:0},innerRadius:{type:Number,value:0},_innerRadiusPx:{type:Number,computed:'_calcInnerRadiusPx(innerRadius, radius, donut)'},donut:{type:Boolean,value:!1},pieGroup:{type:Object,value:function(){return{}}},total:{Type:Number,value:0},radius:{type:Number},_arcs:{type:Object},_currentRotationAngle:{type:Number,value:0},usePercentage:{type:Boolean,value:!1},preserveDataOrder:{type:Boolean,value:!1}},observers:['drawElement(radius,svg,chartData.*,completeSeriesConfig, usePercentage, donut, innerRadius, _stylesUpdated)'],drawElement:function(){this.hasUndefinedArguments(arguments)||(this._checkInitialGroupCreation(),this._updateDrawing())},_checkInitialGroupCreation:function(){this._isObjEmpty(this.pieGroup)&&(this.pieGroup=this.svg.append('g').attr('series-id','pie_').attr('class','pie-slice'))},_updateDrawing:function(){this.debounce('_updateDrawing',function(){var a=this,b=this.chartData,c=!this._arcs;if(xKey=this.empty?'':this.completeSeriesConfig[Object.keys(this.completeSeriesConfig)[0]].x,this.empty)this._pie=Px.d3.pie()([1]);else{var d=Px.d3.pie().value(function(a){return a[xKey]});this.preserveDataOrder&&d.sort(null).sortValues(null),this._pie=d(b)}this._arcs=this.pieGroup.selectAll('.slice').property('_previousData',function(a){return{startAngle:a.startAngle,endAngle:a.endAngle,innerRadius:a.innerRadius,outerRadius:a.outerRadius}}).data(this._pie,function(a){return a.data.y});this._arcs.exit().remove(),this._arcs.enter().append('svg:path').attr('class','slice').on('tap',this._onSliceClick.bind(this)).on('mouseenter',this._sliceMouseEnter.bind(this)).on('mouseleave',this._mouseLeaveSlice.bind(this)).merge(this._arcs).attr('fill',function(a){return a.innerRadius=this._innerRadiusPx,a.outerRadius=this._radius,this.empty?this._checkThemeVariable('--px-vis-pie-empty-color','rgb(0,0,0)'):this._getColor(a.data.colorIndex)}.bind(this)).attr('opacity',this.empty?0.5:1).transition().duration(750).attrTween('d',function(d){d.innerRadius=a._innerRadiusPx,d.outerRadius=a.radius,this._previousData||(this._previousData={startAngle:c?0:d.startAngle,endAngle:c?0:d.startAngle,innerRadius:d.innerRadius?d.innerRadius:0,outerRadius:d.outerRadius?d.outerRadius:a._radius});var b=Px.d3.interpolateObject(this._previousData,d);return function(a){return Px.d3.arc()(b(a))}}),this.empty?this._arcs.selectAll('path').attr('fill',this._checkThemeVariable('--px-vis-pie-empty-color','rgb(0,0,0)')):this._arcs.selectAll('path').attr('fill',function(a){return this._getColor(a.data.colorIndex)}.bind(this)),this._positionChart(0)}.bind(this),5)},_sliceMouseEnter:function(a){var b={startAngle:a.startAngle+this._currentRotationAngle,endAngle:a.endAngle+this._currentRotationAngle,innerRadius:this._innerRadiusPx,outerRadius:this.radius};this.fire('px-vis-pie-mouse-enter-slice',{datum:a,rotatedDatum:b})},_mouseLeaveSlice:function(a){this.fire('px-vis-pie-mouse-leave-slice',{datum:a})},_positionChart:function(a){this.pieGroup.transition().duration(a).attr('transform','rotate('+this._radToDeg(this._currentRotationAngle)+')')},_onSliceClick:function(a,b,c){this.fire('px-vis-pie-slice-clicked',{datum:a}),this._centerOnSlice(a,b,c)},_centerOnSlice:function(a){this.empty||(this.set('_currentRotationAngle',this._getRotationAngle(a)),this._positionChart(750),window.setTimeout(function(){this.fire('px-vis-pie-centered-on-slice',{datum:a})}.bind(this),750))},_radToDeg:function(a){return 180*a/Math.PI},_getRotationAngle:function(a){var b=Math.PI,c=a.startAngle,d=a.endAngle,e=c+(d-c)/2,f=e<b?-e:2*b-e;return f},_calcInnerRadiusPx:function(){return this.hasUndefinedArguments(arguments)?void 0:this.donut?0===this.innerRadius?this.radius-30:this.innerRadius*this.radius:0},_emptyChanged:function(){this.hasUndefinedArguments(arguments)||this.empty&&this.drawElement()}});</script></body></html>