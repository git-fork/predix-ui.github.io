<html><head><script>(function(){'use strict';window.PxAppBehavior=window.PxAppBehavior||{},PxAppBehavior.AssetActivatable={properties:{active:{type:Object,notify:!0,value:function(){return this.multiActivate?[]:null}},activeRoute:{type:Array,notify:!0,value:function(){return this.multiActivate?[]:null}},activeMeta:{type:Object,notify:!0,readOnly:!0,value:null,computed:'_getActiveMeta(active.*)'}},created(){this._lastActivation={source:null,reason:null,item:null}},observers:['_activeChanged(active.*)','_activeRouteChanged(activeRoute.*)'],listeners:{"px-app-asset-should-be-activated":'_assetActivatedByEvent',"px-app-asset-should-be-deactivated":'_assetDeactivatedByEvent'},_multiActivate:!1,get multiActivate(){return this._multiActivate},set multiActivate(a){a!==this._multiActivate&&(this._multiActivate=a,this._toggleMultiActivate(a))},_toggleMultiActivate(a){a&&!Array.isArray(this.active)&&(this.active=[],this.activeRoute=[]),!a&&Array.isArray(this.active)&&(this.active=this.active.length?this.active[0]:null)},activate(a,b='METHOD'){if(!this.multiActivate&&null===a&&null!==this._lastActivation.item||this.multiActivate&&null===a&&this.active.length||this.multiActivate&&Array.isArray(a)&&!a.length&&this.active.length)return this.deactivate(Array.isArray(this.active)?[...this.active]:this.active),this.active;if(!a||!this.multiActivate&&a===this._lastActivation.item||this.multiActivate&&-1<this.active.indexOf(a))return this.active;if(this.multiActivate&&Array.isArray(a)&&a.length){for(let c=0;c<a.length;c++)this.activate(a[c],b);return this.active}if(this._assetGraph.hasNode(a))return this._activateAsset(a,b),this.active;throw new Error(`The following item could not be found in the items graph:
          ${JSON.stringify(a)}`)},deactivate(a,b='METHOD'){if(!this.multiActivate&&(!a||this.active===a))return this._deactivateAsset(this.active),this.active;if(this.multiActivate&&!a)return this.deactivate([...this.active]),this.active;if(this.multiActivate&&Array.isArray(a)&&this.active.length){for(let c=0;c<a.length;c++)this.deactivate(a[c],b);return this.active}return this.multiActivate&&a&&-1<this.active.indexOf(a)?(this._deactivateAsset(a),this.active):void 0},_getActiveMeta(a){if(a.base&&!Array.isArray(a.base)&&this._assetGraph&&this._assetGraph.hasNode(a.base)){const{path:b,route:c,parent:d,children:e,siblings:f}=this._assetGraph.getInfo(a.base,this.keys.id);return{item:a.base,path:b,route:c,parent:d,children:e,siblings:f}}return a.base&&Array.isArray(a.base)&&a.base.length?a.base.map((a)=>{const{path:b,route:c,parent:d,children:e,siblings:f}=this._assetGraph.getInfo(a,this.keys.id);return{item:a,path:b,route:c,parent:d,children:e,siblings:f}}):{item:null,path:null,route:null,parent:null,children:null,siblings:null}},_assetActivatedByEvent(a){a.stopPropagation(),a.detail.item&&this.activate(a.detail.item,'DOM_EVENT')},_assetDeactivatedByEvent(a){a.stopPropagation(),a.detail.item&&this.deactivate(a.detail.item,'DOM_EVENT')},_activeRouteChanged(a){if(a&&a.path&&this._assetGraph&&!this._squashActiveRouteChange){if(!this.multiActivate&&'activeRoute'===a.path){if(this.active&&(null===a.base||Array.isArray(a.base)&&!a.base.length))return this._squashActiveChange=!0,this.deactivate(this.active,'ROUTE_CHANGED'),void(this._squashActiveChange=!1);const b=this._assetGraph.getNodeAtRoute(a.base,this.keys.id);if(b===this.active)return;if(b)this.activate(b,'ROUTE_CHANGED');else throw new Error(`The route ${JSON.stringify(a.base)} could not be found in the items graph.`)}if(this.multiActivate&&('activeRoute'===a.path||'activeRoute.splices'==a.path)){if(this.active.length&&(null===a.base||Array.isArray(a.base)&&!a.base.length))return this._squashActiveChange=!0,this.deactivate(null,'ROUTE_CHANGED'),void(this._squashActiveChange=!1);if(Array.isArray(a.base))for(let b=0;b<a.base.length;b++)this._squashActiveChange=!0,this.active=a.base.map((a)=>{const b=this._assetGraph.getNodeAtRoute(a,this.keys.id);if(!b)throw new Error(`The following item could not be found in the items graph:
                    ${JSON.stringify(b)}`);return b}),this._squashActiveChange=!1}}},_activeChanged(a){a&&a.path&&!this._squashActiveChange&&(!this.multiActivate&&'active'===a.path&&this._updateActiveRoute(a.base),this.multiActivate&&('active'===a.path||'active.splices'===a.path)&&this._updateActiveRouteMulti(a.base))},_updateActiveRoute(a){if(a){if(!this._assetGraph.hasNode(a)){throw new Error(`The following item could not be found in the items graph:
              ${JSON.stringify(a)}`)}const b=this._assetGraph.getRoute(a,this.keys.id);this._routeIsDifferent(b,this.activeRoute)&&(this._squashActiveRouteChange=!0,this.activeRoute=b,this._squashActiveRouteChange=!1)}else this._squashActiveRouteChange=!0,this.activeRoute=null,this._squashActiveRouteChange=!1},_updateActiveRouteMulti(a){a&&Array.isArray(a)&&a.length?(this._squashActiveRouteChange=!0,this.activeRoute=a.map((a)=>{if(!this._assetGraph.hasNode(a))throw new Error(`The following item could not be found in the items graph:
                ${JSON.stringify(a)}`);return this._assetGraph.getRoute(a,this.keys.id)}),this._squashActiveRouteChange=!1):(this._squashActiveRouteChange=!0,this.activeRoute=[],this._squashActiveRouteChange=!1)},_activateAsset(a,b){const{route:c,path:d}=this._assetGraph.getInfo(a,this.keys.id);this._lastActivation={item:a,source:b,route:c},this.multiActivate||(this.active=a),this.multiActivate&&this.push('active',a),this.fire('px-app-asset-activated',{source:b,item:a,route:c,path:d})},_deactivateAsset(a,b){const{route:c,path:d}=this._assetGraph.getInfo(a,this.keys.id);this._lastActivation={item:null,source:null,route:null},this.multiActivate||(this.set('active',null),this.fire('px-app-asset-deactivated',{source:b,item:a,route:c,path:d})),this.multiActivate&&(this.splice('active',this.active.indexOf(a),1),this.fire('px-app-asset-deactivated',{source:b,item:a,route:c,path:d}))}}})();</script></head><body></body></html>