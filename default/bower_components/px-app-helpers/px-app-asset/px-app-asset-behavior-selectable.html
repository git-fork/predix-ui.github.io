<html><head><script>(function(){'use strict';window.PxAppBehavior=window.PxAppBehavior||{},PxAppBehavior.AssetSelectable={properties:{selected:{type:Object,notify:!0,value:function(){return this.multiSelect?[]:null}},selectedRoute:{type:Array,notify:!0,value:function(){return this.multiSelect?[]:null}},selectedMeta:{type:Object,notify:!0,readOnly:!0,value:null,computed:'_getSelectedMeta(selected.*)'}},created(){this._lastSelection={source:null,reason:null,item:null}},observers:['_selectedChanged(selected.*)','_selectedRouteChanged(selectedRoute.*)'],listeners:{"px-app-asset-graph-created":'__selectInitialAssets',"px-app-asset-should-be-selected":'_assetSelectedByEvent',"px-app-asset-should-be-deselected":'_assetDeselectedByEvent'},_multiSelect:!1,get multiSelect(){return this._multiSelect},set multiSelect(a){a!==this._multiSelect&&(this._multiSelect=a,this._toggleMultiSelect(a))},_toggleMultiSelect(a){a&&!Array.isArray(this.selected)&&(this.selected=[],this.selectedRoute=[]),!a&&Array.isArray(this.selected)&&(this.selected=this.selected.length?this.selected[0]:null)},select(a,b='METHOD'){if(!this.multiSelect&&null===a&&null!==this._lastSelection.item||this.multiSelect&&null===a&&this.selected.length||this.multiSelect&&Array.isArray(a)&&!a.length&&this.selected.length)return this.deselect(Array.isArray(this.selected)?[...this.selected]:this.selected),this.selected;if(!a||!this.multiSelect&&a===this._lastSelection.item||this.multiSelect&&-1<this.selected.indexOf(a))return this.selected;if(this.multiSelect&&Array.isArray(a)&&a.length){for(let c=0;c<a.length;c++)this.select(a[c],b);return this.selected}if(this._assetGraph.hasNode(a))return this._selectAsset(a,b),this.selected;throw new Error(`The following item could not be found in the items graph:
          ${JSON.stringify(a)}`)},deselect(a,b='METHOD'){if(!this.multiSelect&&(!a||this.selected===a))return this._deselectAsset(this.selected),this.selected;if(this.multiSelect&&!a)return this.deselect([...this.selected]),this.selected;if(this.multiSelect&&Array.isArray(a)&&this.selected.length){for(let c=0;c<a.length;c++)this.deselect(a[c],b);return this.selected}return this.multiSelect&&a&&-1<this.selected.indexOf(a)?(this._deselectAsset(a),this.selected):void 0},_getSelectedMeta(a){if(a.base&&!Array.isArray(a.base)&&this._assetGraph&&this._assetGraph.hasNode(a.base)){const{path:b,route:c,parent:d,children:e,siblings:f}=this._assetGraph.getInfo(a.base,this.keys.id);return{item:a.base,path:b,route:c,parent:d,children:e,siblings:f}}return a.base&&Array.isArray(a.base)&&a.base.length?a.base.map((a)=>{const{path:b,route:c,parent:d,children:e,siblings:f}=this._assetGraph.getInfo(a,this.keys.id);return{item:a,path:b,route:c,parent:d,children:e,siblings:f}}):{item:null,path:null,route:null,parent:null,children:null,siblings:null}},_assetSelectedByEvent(a){a.stopPropagation(),a.detail.item&&this.select(a.detail.item,'DOM_EVENT')},_assetDeselectedByEvent(a){a.stopPropagation(),a.detail.item&&this.deselect(a.detail.item,'DOM_EVENT')},_selectedRouteChanged(a){a&&a.path&&this._assetGraph&&!this._squashSelectedRouteChange&&(!this.multiSelect&&'selectedRoute'===a.path&&this._updateSelectedFromRoute(a.base),this.multiSelect&&('selectedRoute'===a.path||'selectedRoute.splices'==a.path)&&this._updateSelectedFromRouteMulti(a.base))},_updateSelectedFromRoute(a){if(this.selected||null!==a&&(!Array.isArray(a)||a.length)){if(this.selected&&(null===a||Array.isArray(a)&&!a.length))return this._squashSelectedChange=!0,this.deselect(this.selected,'ROUTE_CHANGED'),void(this._squashSelectedChange=!1);const b=this._assetGraph.getNodeAtRoute(a,this.keys.id);if(b!==this.selected)if(b)this.select(b,'ROUTE_CHANGED');else throw new Error(`The route ${JSON.stringify(a)} could not be found in the items graph.`)}},_updateSelectedFromRouteMulti(a){if(this.selected.length&&(null===a||Array.isArray(a)&&!a.length))return this._squashSelectedChange=!0,this.deselect(null,'ROUTE_CHANGED'),void(this._squashSelectedChange=!1);if(Array.isArray(a))for(let b=0;b<a.length;b++)this._squashSelectedChange=!0,this.selected=a.map((a)=>{const b=this._assetGraph.getNodeAtRoute(a,this.keys.id);if(!b)throw new Error(`The following item could not be found in the items graph:
                  ${JSON.stringify(b)}`);return b}),this._squashSelectedChange=!1},_selectedChanged(a){a&&a.path&&!this._squashSelectedChange&&this._assetGraph&&(!this.multiSelect&&'selected'===a.path&&'undefined'!==typeof this.selectedRoute&&this._updateSelectedRoute(a.base),this.multiSelect&&('selected'===a.path||'selected.splices'===a.path)&&'undefined'!==typeof this.selectedRoute&&this._updateSelectedRouteMulti(a.base))},_checkIfEmpty(a){return Array.isArray(a)?!!a.length:!!a},_updateSelectedRoute(a){if(this._checkIfEmpty(a)){if(!this._assetGraph.hasNode(a)){throw new Error(`The following item could not be found in the items graph:
              ${JSON.stringify(a)}`)}const b=this._assetGraph.getRoute(a,this.keys.id);this._routeIsDifferent(b,this.selectedRoute)&&(this._squashSelectedRouteChange=!0,this.selectedRoute=b,this._squashSelectedRouteChange=!1)}else this._squashSelectedRouteChange=!0,this.selectedRoute=null,this._squashSelectedRouteChange=!1},_updateSelectedRouteMulti(a){a&&Array.isArray(a)&&a.length?(this._squashSelectedRouteChange=!0,this.selectedRoute=a.map((a)=>{if(!this._assetGraph.hasNode(a))throw new Error(`The following item could not be found in the items graph:
                ${JSON.stringify(a)}`);return this._assetGraph.getRoute(a,this.keys.id)}),this._squashSelectedRouteChange=!1):(this._squashSelectedRouteChange=!0,this.selectedRoute=[],this._squashSelectedRouteChange=!1)},__selectInitialAssets(){this.multiSelect||!this.selected||this.selectedRoute?this.multiSelect||this.selected||!this.selectedRoute?this.multiSelect&&!!this.selected&&this.selected.length&&!this.selectedRoute.length?this._updateSelectedRouteMulti(this.selected):this.multiSelect&&!!this.selected&&!this.selected.length&&this.selectedRoute.length&&this._updateSelectedFromRouteMulti(this.selected):this._updateSelectedFromRoute(this.selectedRoute):this._updateSelectedRoute(this.selected)},_routeIsDifferent(a,b){if(!a||!b)return!0;if(a.length!==b.length)return!0;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!0;return!1},_selectAsset(a,b){const{route:c,path:d}=this._assetGraph.getInfo(a,this.keys.id);this._lastSelection={item:a,source:b,route:c},this.multiSelect||(this.selected=a),this.multiSelect&&this.push('selected',a),this.fire('px-app-asset-selected',{source:b,item:a,route:c,path:d})},_deselectAsset(a,b){const{route:c,path:d}=this._assetGraph.getInfo(a,this.keys.id);this._lastSelection={item:null,source:null,route:null},this.multiSelect||(this.set('selected',null),this.fire('px-app-asset-deselected',{source:b,item:a,route:c,path:d})),this.multiSelect&&(this.splice('selected',this.selected.indexOf(a),1),this.fire('px-app-asset-deselected',{source:b,item:a,route:c,path:d}))}}})();</script></head><body></body></html>