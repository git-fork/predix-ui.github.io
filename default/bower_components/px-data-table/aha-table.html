<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="px-pagination.html"><link rel="import" href="px-data-table-cell.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="css/aha-table-styles.html"></head><body><dom-module id="aha-table"><template><style include="aha-table-styles"></style><content id="columndefs"></content><template is="dom-if" if="{{showColumnChooser}}"><div class="flex columnChooser u-mb-"><px-dropdown class="u-ml--" display-value="{{localize('Show/Hide Column')}}" items="{{_columnChooserItems}}" multi="" hide-selected="" clear-selections-on-change=""></px-dropdown></div></template><div class="scroll-body"><div id="scrollBodyTableContainer" class$="table {{_getTableClass(tableCells, tableColumns)}}" role="grid"><div class="tr tr--header" role="row"><template is="dom-repeat" items="{{meta}}" as="column"><template is="dom-if" if="{{!column.hide}}"><span role="columnheader" class$="{{_getHeaderClass(column)}}" draggable="{{enableColumnReorder}}" on-touchstart="_dragStartColumnHeader" on-touchmove="_touchMoveHeader" on-touchleave="_dragLeave" on-touchend="_touchDropColumnHeader" on-dragleave="_dragLeave" on-dragstart="_dragStartColumnHeader" on-dragover="_dragOverHeader" on-drop="_dragDropColumnHeader" on-dragend="_dragEndColumnHeader"><div class="flex header--container"><span class$="{{_getTextSortingClass(sortable, column, sortedColumn)}}" on-tap="_sort">{{column.label}}<px-icon icon$="{{_getSortingIcon(sortable, column, sortedColumn, descending)}}" class$="{{_getSortingClass(sortable, column, sortedColumn, descending)}}"></px-icon></span><template is="dom-if" if="{{!_isEqual(column.type, 'selected')}}"><template is="dom-if" if="{{enableColumnResize}}"><div class="header--drag-handle" on-down="_headerResizeMouseDown" on-track="_headerTrack"></div></template></template></div></span></template></template></div><div class$="{{_getSecondHeaderClass(_enableFilterRow)}}" role="row"><template is="dom-repeat" items="{{meta}}" as="column" id="filterRepeat"><span class$="{{_getFilterHeaderClass(column)}}" role="gridcell" hidden$="{{column.hide}}"><template is="dom-if" if="{{_isEqual(column.type, 'selected')}}"><span class="flex" hidden$="{{column.hide}}"><template is="dom-if" if="{{!singleSelect}}"><input id="selectAllCheckbox" role="checkbox" aria-label="Click to select or deselect all rows" type="checkbox" on-change="_clickSelectAll"></template></span></template><template is="dom-if" if="{{_isFilterableColumn(column, filterable)}}"><input role="textbox" aria-label="Enter text to filter column" placeholder="{{localize('Filter')}}" class="text-input text-input--filter" type="text" on-input="_filter"></template></span></template></div><template id="recordList" is="dom-repeat" items="{{displayedRows}}" as="internalRow" strip-whitespace=""><div role="row" class$="{{_getRowClass(internalRow,striped)}}"><template is="dom-repeat" items="{{meta}}" as="column"><template is="dom-if" if="{{_isEqual(column.type, 'selected')}}"><span role="gridcell" class$="{{_getSelectedCellClass(internalRow._selected, internalRow._highlight)}}" hidden$="{{column.hide}}" on-tap="_clickRow"><span class="flex flex--middle"><template is="dom-if" if="{{!singleSelect}}"><input role="checkbox" aria-label="Click to select row" type="checkbox" checked="{{internalRow._selected::change}}"></template><template is="dom-if" if="{{singleSelect}}"><input role="checkbox" aria-label="Click to select row" type="radio" name="selected" checked="{{internalRow._selected::change}}"></template></span></span></template><template id="cellRepeat" is="dom-if" if="{{!_isEqual(column.type, 'selected')}}"><template is="dom-if" if="{{!column.hide}}"><px-data-table-cell on-save="_save" row-highlighted="[[internalRow._highlight]]" cell-highlighted="[[_getHighlightValue(internalRow, column, column.highlightdefined)]]" cell-selected="[[internalRow._selected]]" on-validate="_handleValidateEvent" cell-type="{{column.type}}" dropdown-items="{{column.dropdownItems}}" placeholder="{{column.placeholder}}" cell-display-value="{{_readContent(internalRow, column)}}" cell-value="{{_getInternalDataAt(internalRow, column.name)}}" cell-display-tooltip="{{_shouldClipDatumString(internalRow, column)}}" cell-editable="{{column.editable}}" cell-validation="{{_getInternalCellValidationStateAt(internalRow, column.name)}}" column-name="{{column.name}}" on-tap="_clickCell"></px-data-table-cell></template></template></template></div></template></div><template is="dom-if" if="{{!displayedRows.length}}"><div class="flex flex--center no-results">{{localize('No Results')}}</div></template></div><div class="pagination"><px-pagination class$="{{_getPaginationVisibility(hidePaginationControl)}}" id="pagination" data-remote="{{dataRemote}}" number-of-items="{{_adaptedNumberOfItems}}" page-size="{{pageSize}}" page-size-options="{{pageSizeOptions}}" first-item-index-to-display="{{firstItemIndex}}" language="{{language}}" use-key-if-missing="{{useKeyIfMissing}}" resources="{{resources}}"></px-pagination></div></template></dom-module><script>Polymer({is:"aha-table",behaviors:[Polymer.AppLocalizeBehavior],properties:{data:{type:Array,notify:!0,value:function(){return[]}},meta:{type:Array,value:function(){return[]}},selectedRows:{type:Array,value:function(){return[]},notify:!0},selectable:{type:Boolean,value:!1,observer:"_selectableChanged"},singleSelect:{type:Boolean,value:!1,observer:"_singleSelectChanged"},striped:{type:Boolean,value:!1},tableCells:{type:Boolean,value:!1},tableColumns:{type:Boolean,value:!1},filterable:{type:Boolean,value:!1},sortable:{type:Boolean,value:!1},includeAllColumns:{type:Boolean,value:!1,observer:"_includeAllColumnsChanged"},_enableFilterRow:{type:Boolean,value:!1},sortedColumn:{type:String,value:""},filteredColumns:{type:Array,value:function(){return[]}},displayedRows:{type:Array,value:function(){return[]}},descending:{type:Boolean,value:!1},totalEntries:{type:Number,value:10,observer:"_calculateAdaptedNumberOfItems"},firstItemIndex:{type:Number,value:1},dataRemote:{type:Boolean,value:!1},pageSize:{type:Number,value:10,observer:"_setPageSize"},_adaptedNumberOfItems:{type:Number},numberOfItems:{type:Number,observer:"_calculateAdaptedNumberOfItems"},hidePaginationControl:{type:Boolean,value:!1},showColumnChooser:{type:Boolean,value:!1},enableColumnReorder:{type:Boolean,value:!1},enableColumnResize:{type:Boolean,value:!1},_internalData:{type:Array,value:function(){return[]}},_columnChooserItems:{type:Array,value:function(){return[]}},_displayingInsertion:{type:Boolean,value:!1},_requestInsertionIndicatorRemoval:{type:Boolean,value:!1},_headerInitialSize:{type:Number,value:0},_columnDragged:{type:String,value:""},_isAttached:{type:Boolean,value:!1},scrollBody:{type:String,value:"#scrollBodyTableContainer"},pageSizeOptions:{type:Array,value:function(){return[{key:"1",val:"10"},{key:"2",val:"20"},{key:"3",val:"50"},{key:"4",val:"100"}]}}},observers:["_updateDisplayedRows(firstItemIndex)","_updateDisplayedRows(pageSize)","_dataChanged(data.*)","_computeColumnChooserItems(meta, meta.*)","_computeIfColumnFilterEnabled(meta.splices, filterable, meta.*, selectable, singleSelect)"],listeners:{validate:"_handleValidateEvent","px-dropdown-selection-changed":"_columnChooserChanged"},ready:function(){this.addEventListener("px-data-table-highlight-loaded",this._highlightLoaded.bind(this));var a=this._columnChanged.bind(this);this._observer=Polymer.dom(this.$.columndefs).observeNodes(a)},attached:function(){this._isAttached=!0},_columnChanged:function(a){this.selectable&&0===this.meta.length&&this.push("meta",this._generateMetaForColumn("_selected","selected",!0,this.localize("Selected")+" (0)"));var b=a.addedNodes.filter(function(a){return a.nodeType===Node.ELEMENT_NODE&&"PX-DATA-TABLE-COLUMN"===a.nodeName}),c=a.removedNodes.filter(function(a){return a.nodeType===Node.ELEMENT_NODE&&"PX-DATA-TABLE-COLUMN"===a.nodeName});if(0<b.length)for(var d=0;d<b.length;d++){if(b[d].type||(b[d].type="string"),!b[d].label){var e=b[d].name||"";b[d].label=e.charAt(0).toUpperCase()+e.slice(1)}this._addColumn(b[d])}c.forEach(function(a){this.meta.forEach(function(b,c){a===b&&this.splice("meta",c,1)}.bind(this))}.bind(this))},_addColumn:function(a){var b,c=this.getEffectiveChildren().every(function(c){return c.name!==a.name&&(b=c,!0)});if(!c){var d=0;b?(this.meta.forEach(function(a,c){a.name===b.name&&(d=c+1)}),this.splice("meta",d,0,a)):(this.selectable&&(d+=1),this.splice("meta",d,1,a))}else this.push("meta",a)},_selectedColumnExists:function(){return this.meta&&this.meta[0]&&"_selected"===this.meta[0].name},_highlightLoaded:function(a){a=Polymer.dom(a);var b=this._findFirstMatchingElementNameFromEventPath(a,"PX-DATA-TABLE-COLUMN");if(b._highLightElLoadedCount+=1,b._highLightElLoadedCount===Polymer.dom(b).querySelectorAll("px-data-table-highlight").length){var c=this._findMetaIndexFromColumnElement(b);0<c&&this.set("meta."+c+".highlightdefined",!0)}},_findMetaIndexFromColumnElement:function(a){var b=-1;return this.meta.some(function(c,d){if(c===a)return b=d,!0}),b},_findFirstMatchingElementNameFromEventPath:function(a,b){var c;return a.path.some(function(a){if(a.nodeName===b)return c=a,!0}),c},_dataChanged:function(a){if(void 0===this.data||null===this.data||!this._isAttached&&0===a.base.length)return void(this._internalData=[]);if(!this._isAttached){var b=this;return void this.debounce("attach",function(){b._dataChanged(a)},10)}(this.includeAllColumns||0===this.meta.length||1===this.meta.length&&"_selected"===this.meta[0].name)&&this._generateMetaFromData(),this._internalData=this._typeofComparison(this._internalData,"undefined")||0!==this._internalData.length?this._refreshInternalData():this._initializeInternalData(),this.selectedRows=this._internalData.filter(function(a){return!0===a._selected}),this._filterSortAndUpdateDisplayedTable();var c=/([#])([0-9])+/;if(c.test(a.path)){var d,e=c.exec(a.path)[0].slice(1),f=a.path.split("."),g=f[f.length-1];this.meta.some(function(a){if(a.name===g)return d=a,!0}),this._cellChanged(this._readContent(this._internalData[e],d),a.value)&&this._handleValidateEvent(evt)}},_getNumberOfItems:function(a,b,c){return c?b:a},_includeAllColumnsChanged:function(a){!0===a?this._generateMetaFromData():!1===a&&this._isAttached&&0<this.getContentChildren("#columndefs").length&&(this.meta=this.getContentChildren("#columndefs").filter(function(a){return a.nodeType===Node.ELEMENT_NODE&&"PX-DATA-TABLE-COLUMN"===a.nodeName}),this._selectableChanged(this.selectable))},_selectableChanged:function(a){!0===a&&null!==this.meta&&this.meta!==void 0&&0<this.meta.length?this.splice("meta",0,0,this._generateMetaForColumn("_selected","selected",!0,this.localize("Selected")+" (0)")):!1===a&&null!==this.meta&&this.meta!==void 0&&0<this.meta.length&&"_selected"===this.meta[0].name&&this.shift("meta")},_singleSelectChanged:function(){this._internalData&&1<this.selectedRows.length&&this._setAllRows(!1)},_generateMetaFromData:function(){for(var a in this.data[0]){var b=this.meta.every(function(b){return b.name!==a});if(b){var c=this._generateMetaForColumn(a,"string",!1,a.charAt(0).toUpperCase()+a.slice(1));this.push("meta",c)}}},_generateMetaForColumn:function(a,b,c,d){return Polymer.Base.create("px-data-table-column",{name:a,label:d,type:b,sortable:this.sortable,filterable:this.filterable,editable:!1,required:!1,hide:!1,selectAll:c,validate:function(){return{passedValidation:!0}}})},_filterSortAndUpdateDisplayedTable:function(){var a,b,c,d=0,e=this;for(this.filteredSortedData=this._internalData,a=0,c=this._internalData.length;a<c;a++)this._setInternalDataAt(this._internalData[a],"_filtered",!1);if(!this.dataRemote){for(b in this.sortedColumn&&(this.filteredSortedData=this._sortByColumn(this.filteredSortedData)),this.filteredColumns)this.filteredSortedData=this._filterByColumn(this.filteredColumns[b].name,this.filteredColumns[b].userEntry,this.filteredSortedData);e=this,this._internalData.forEach(function(a){e._getInternalCellStateAt(a,"_filtered")||d++}),this.set("numberOfItems",d),this.$.pagination.goToPageNumber(1)}else this.$.pagination.updateDisplay(),this.set("numberOfItems",this.totalEntries);this._updateDisplayedRows();var f=Polymer.dom(this.root).querySelector("#selectAllCheckbox");null!==f&&f!==void 0&&f.checked&&(f.checked=!1)},_refreshInternalData:function(a){var b,c,d=[];for(b=0,c=this.data.length;b<c;b++){var e=this.data[b],f={dataIndex:b},g=a||b>=this._internalData.length;for(var h in e)Object.prototype.hasOwnProperty.call(e,h)&&(f[h]={},f[h].value=e[h],g?f[h]._validation={passedValidation:!0}:this._internalData[b].row[h]._validation&&(f[h]._validation=this._internalData[b].row[h]._validation));d.push({row:f,_filtered:!g&&this._internalData[b]._filtered,_selected:!g&&this._internalData[b]._selected,_highlight:g?{value:!1,highlightColor:""}:this._internalData[b]._highlight})}return d},_initializeInternalData:function(){return this._refreshInternalData(!0)},_setInternalDataAt:function(a,b,c){"_selected"===b||"_filtered"===b||"_highlight"===b?(this.set("displayedRows."+this.displayedRows.indexOf(a)+"."+b,c),a[b]=c):a.row[b].value=c},_getInternalDataAt:function(a,b){return this._getInternalCellStateAt(a,b).value},_getInternalCellValidationStateAt:function(a,b){return this._getInternalCellStateAt(a,b)._validation},_setInternalCellValidationStateAt:function(a,b,c){a.row[b]._validation=c},_getInternalCellStateAt:function(a,b){return"_selected"===b||"_filtered"===b?a[b]:a.row[b]?a.row[b]:{}},_setPageSize:function(){this.$.pagination.setPageSize(this.pageSize)},_getInternalRowStateAt:function(a,b){return"_selected"===b||"_filtered"===b?a:a.row},_updateDisplayedRows:function(){var a,b;null===this.firstItemIndex||this.firstItemIndex===void 0||null===this.pageSize||this.pageSize===void 0||this.filteredSortedData===void 0||null===this.filteredSortedData||this.hidePaginationControl?this.filteredSortedData!==void 0&&null!==this.filteredSortedData&&this.hidePaginationControl&&(this.filteredSortedData=this.filteredSortedData.map((a)=>(a.isNew=!0,a)),this.set("displayedRows",this.filteredSortedData)):(a=this.firstItemIndex-1,b=a+parseInt(this.pageSize,10),this.filteredSortedData=this.filteredSortedData.map((a)=>(a.isNew=!0,a)),this.dataRemote?this.set("displayedRows",this.filteredSortedData):this.set("displayedRows",this.filteredSortedData.slice(a,b)))},_triggerSortChangeRequest:function(){this.debounce("_debounceTriggerSortChangeRequest",function(){this.fire("px-sort-change-intent",this.sortedColumn?JSON.stringify([{name:this.sortedColumn,direction:this.descending?"descending":"ascending"}]):"[]")},300)},_sort:function(a){if(this.sortable){var b,c=a.model.column;c&&c.sortable&&(b=c.name,b!==this.sortedColumn||this.descending?b===this.sortedColumn&&this.descending?this.set("sortedColumn",""):(this.set("sortedColumn",b),this.set("descending",!1)):this.set("descending",!this.descending)),this.dataRemote?this._triggerSortChangeRequest():this._filterSortAndUpdateDisplayedTable()}},_sortByColumn:function(a){var b,c=this._getSortFunction();return b=a.map(function(a,b){var c;return c="_selected"===this.sortedColumn?this._getInternalCellStateAt(a,this.sortedColumn):this._getInternalDataAt(a,this.sortedColumn),(void 0===c||null===c)&&(c=""),{index:b,value:this._typeofComparison(c,"string")?c.toLowerCase():c}},this).sort(c.bind(this)).map(function(b){return a[b.index]}),b},_getSortFunction:function(){var a;return"_selected"!==this.sortedColumn&&this.meta.forEach(function(b){this.sortedColumn===b.name&&(a=this._resolveFunctionOnWindow("sort-function-name",b))},this),a||("_selected"===this.sortedColumn?a=this._defaultSortSelected:a=this._defaultSortAlphabetically),a},_resolveFunctionOnWindow:function(a,b){var c,d,e=window,f=b[a];if((null===f||void 0===f)&&(b instanceof HTMLElement&&(f=b.attributes[a]),null===f||void 0===f))return null;for(d in c=f.value.split("."),c)if(e=e[c[d]],void 0===e)return console.warn("px-data-table: Custom function was used, but was not found on window. Is the path correct?"),null;return e},_defaultSortAlphabetically:function(c,a){return this.descending?c.value<a.value?1:-1:c.value>a.value?1:-1},_defaultSortSelected:function(c,a){return this.descending?c.value&&!a.value?1:!c.value&&a.value?-1:0:c.value&&!a.value?-1:!c.value&&a.value?1:0},_triggerFilterChangeRequest:function(){this.debounce("_debounceTriggerFilterChangeRequest",function(){this.fire("px-filter-change-intent",JSON.stringify(this.filteredColumns))},300)},_filter:function(a){var b,c,d,e,f=this.$.filterRepeat.modelForElement(a.target).column;if(f&&f.filterable){for(d in b=a.target.value,c=!0,this.filteredColumns)e=this.filteredColumns[d],e.name===f.name&&(c=!1,""===b||void 0===b||null===b?this.filteredColumns.splice(d,1):e.userEntry=b);c&&""!==b&&void 0!==b&&null!==b&&this.filteredColumns.push({name:f.name,userEntry:b}),this.dataRemote?this._triggerFilterChangeRequest():this._filterSortAndUpdateDisplayedTable()}},_filterByColumn:function(a,b,c){var d,e,f,g,h=this._getFilterFunction(a),i=this;for(d=0,e=c.length;d<e;d++)!1===c[d]._filtered&&(f=h(b,this._getInternalDataAt(c[d],a)),f||this._setInternalDataAt(c[d],"_filtered",!0));return this.filtered=c.some(function(a){return i._getInternalCellStateAt(a,"_filtered")}),g=c.filter(function(a){return!i._getInternalCellStateAt(a,"_filtered")}),g},_getFilterFunction:function(a){var b;return this.meta.forEach(function(c){a===c.name&&(b=this._resolveFunctionOnWindow("filter-function-name",c))},this),b||(b=this._defaultFilter),b},_defaultFilter:function(a,b){return void 0===a||null===a||""===a||(b?-1<b.toString().toLowerCase().indexOf(a.toString().toLowerCase()):void 0)},_save:function(a){var b=a.model.internalRow,c=a.model.column,d=a.detail.newValue;b&&(this.fire("before-save",{event:a,row:b,column:c}),this._setInternalDataAt(b,c.name,d),a.currentTarget.cellValue=this._getInternalDataAt(b,c.name),a.currentTarget.cellDisplayValue=this._readContent(b,c),this.data[b.row.dataIndex][c.name]=d),c.required&&!a.target.validity.valid&&this.fire("after-invalid",{event:a,row:b,column:c}),this.fire("after-save",{event:a,row:b,column:c})},_cellChanged:function(a,b){return a!==b},_handleValidateEvent:function(a){var b=a.model.column,c=b.validate(a.detail.newValue);a.currentTarget.cellValidation=c,this._setInternalCellValidationStateAt(a.model.internalRow,b.name,c)},_clickRow:function(a){var b,c=a.model.column,d=a.model.internalRow;c.editable||"dropdown"===c.type||(this.selectable&&(this._selectRow(d,this.$.recordList.indexForElement(a.currentTarget)),!this.singleSelect&&(b=Polymer.dom(this.root).querySelector("#selectAllCheckbox"),b.checked=!1),"_selected"===this.sortedColumn&&this.set("sortedColumn","")),this.fire("px-row-click",{row:d,column:c}))},_clickCell:function(a){var b=a.model.column,c=a.model.internalRow,d={row:c,column:b,rowIndex:this.$.recordList.indexForElement(a.currentTarget)};this._clickRow(a),this.fire("px-cell-click",d)},_clickSelectAll:function(a){a.target.checked?this._setAllRows(!0):this._setAllRows(!1)},_setAllRows:function(a){var b,c;if(a)for(b=0,c=this._internalData.length;b<c;b++)this.filteredSortedData.includes(this._internalData[b])&&this._setInternalDataAt(this._internalData[b],"_selected",a);else for(b=0,c=this._internalData.length;b<c;b++)this._setInternalDataAt(this._internalData[b],"_selected",a);for(b=0,c=this.displayedRows.length;b<c;b++)this.notifyPath("displayedRows."+b+"._selected",this.displayedRows[b]._selected);if(this.splice("selectedRows",0,this.selectedRows.length),a)for(b=0,c=this._internalData.length;b<c;b++)this._internalData[b]._selected&&this.push("selectedRows",this._internalData[b]);this.set("meta.0.label",this.localize("Selected")+" ("+this.selectedRows.length+")"),this.fire("px-select-all-click",this.selectedRows)},_selectRow:function(a,b){this.fire("before-select",a),-1<this.selectedRows.indexOf(a)?(a._selected=!1,this.notifyPath("displayedRows."+b+"._selected",a._selected),this.splice("selectedRows",this.selectedRows.indexOf(a),1)):(this.singleSelect&&this._setAllRows(!1),a._selected=!0,this.notifyPath("displayedRows."+b+"._selected",a._selected),this.push("selectedRows",a)),this.set("meta.0.label",this.localize("Selected")+" ("+this.selectedRows.length+")"),this.fire("after-select",a)},_dragDropColumnHeader:function(a){this.enableColumnReorder&&this._dropColumnHeader(this._findHeaderFromChild(a.target))},_touchDropColumnHeader:function(){if(this.enableColumnReorder){this._removeDragFromSourceHeader();var a=document.elementFromPoint(event.changedTouches[0].clientX,event.changedTouches[0].clientY);a=this._findHeaderFromChild(a),this._dropColumnHeader(a)}},_dropColumnHeader:function(a){var b,c,d,e,f,g,h=this._columnDragged;c=a.classList.toString().match(/.*aha-(.*)-th/),d=c&&1<c.length?c[1]:null,null!=d&&(d===h?a.classList.remove("dragged"):(f=this.getEffectiveChildren(),f.forEach(function(a){a.name===h&&(b=a),a.name===d&&(e=a)}),(b&&"_selected"!==d||b!==f[0])&&(g=Polymer.dom(b).parentNode,Polymer.dom(g).removeChild(b),Polymer.dom.flush(),"_selected"===d?Polymer.dom(g).insertBefore(b,f[0]):Polymer.dom(g).insertBefore(b,e.nextSibling)))),this._removeInsertionDisplay()},_dragOverHeader:function(a){if(this.enableColumnReorder){var b=this._findHeaderFromChild(a.target);b.classList.contains("aha-insertion-indicator-th")||(a.preventDefault(),this._allowColumnDrop(b,this._requestInsertionIndicatorRemoval&&this._displayingInsertion))}},_touchMoveHeader:function(a){if(this.enableColumnReorder){var b=document.elementFromPoint(event.changedTouches[0].clientX,event.changedTouches[0].clientY);b=this._findHeaderFromChild(b),b.classList.contains("aha-insertion-indicator-th")||this._allowColumnDrop(b,b!==this._findHeaderFromChild(a.target))}},_allowColumnDrop:function(a,b){if(b){this.set("_requestInsertionIndicatorRemoval",!1);var c,d,e=a.classList.toString().match(/.*aha-(.*)-th/),f=e&&1<e.length?e[1]:null;if(null!=f&&(this.meta.forEach(function(a,b){a.name===f?c=b:"insertion-indicator"===a.name&&(d=b)}),void 0!==c&&c+1!==d)){var g=this.splice("meta",d,1)[0];c+1>d&&c--,this.splice("meta",c+1,0,g)}}else if(!this._displayingInsertion){var e=a.classList.toString().match(/.*aha-(.*)-th/),f=e&&1<e.length?e[1]:null;if(null!==f){var c;this.meta.forEach(function(a,b){a.name===f&&(c=b)});var h=this._generateMetaForColumn("insertion-indicator","string",!1,"");h.filterable=!1,h.sortable=!1,this.splice("meta",c+1,0,h),this.set("_displayingInsertion",!0)}}},_dragLeave:function(){this._removeInsertionDisplay()},_dragEndColumnHeader:function(){this._removeDragFromSourceHeader()},_removeInsertionDisplay:function(){var a=this;this.set("_requestInsertionIndicatorRemoval",!0),window.setTimeout(function(){if(a.enableColumnReorder&&a._displayingInsertion&&a._requestInsertionIndicatorRemoval){var b;a.meta.forEach(function(a,c){"insertion-indicator"===a.name&&(b=c)}),a.splice("meta",b,1),a.set("_displayingInsertion",!1),this._columnDragged=""}},100)},_dragStartColumnHeader:function(a){var b=this._findHeaderFromChild(a.target);if(this.enableColumnReorder&&b.classList.contains("moveable")){var c=b.classList.toString().match(/.*aha-(.*)-th/)[1];this._columnDragged=c,b.classList.add("dragged"),a.changedTouches&&(a.preventDefault(),this._allowColumnDrop(b,!1))}else a.preventDefault()},_removeDragFromSourceHeader:function(){var a=Polymer.dom(this.root).querySelector(".dragged");a&&a.classList.remove("dragged")},_columnChooserChanged:function(a){a.detail.selected?this.showColumn(a.detail.key):this.hideColumn(a.detail.key)},_computeColumnChooserItems:function(){this.debounce("computeItems",function(){var a=[];this.meta.forEach(function(b){"_selected"===b.name||"insertion-indicator"===b.name||b.disableHide||a.push({key:b.name,val:b.label,selected:!b.hide})}),JSON.stringify(this._columnChooserItems)!==JSON.stringify(a)&&this.set("_columnChooserItems",a)},5)},_calculateAdaptedNumberOfItems:function(){this.set("_adaptedNumberOfItems",this.dataRemote?this.totalEntries:this.numberOfItems)},hideColumn:function(a){this.meta.forEach(function(b,c){b.name===a&&(b.hide=!0,this.notifyPath("meta."+c+".hide",!0))},this)},showColumn:function(a){this.meta.forEach(function(b,c){b.name===a&&(b.hide=!1,this.notifyPath("meta."+c+".hide",!1))},this)},_headerTrack:function(a){var b=this._findHeaderFromChild(a.target);b!==this&&(b.style.width=this._headerInitialSize+a.detail.dx+"px")},_headerResizeMouseDown:function(a){var b,c=this._findHeaderFromChild(a.target);c!==this&&(b=c.getBoundingClientRect(),this._headerInitialSize=b.width,a.preventDefault(),a.stopPropagation())},_getRowClass:function(a){return["tr","rows",this.striped?"striped":"",a.isNew?"is-new":""].join(" ")},_getHighlightValue:function(a,b){var c=Polymer.dom(b).querySelectorAll("px-data-table-highlight"),d=!1,e={value:!1};return c.forEach(function(c){var f=this._getInternalRowStateAt(a,b.name),g=this._getInternalDataAt(a,b.name);d=c.highlight(g,f,b.name),e.value&&d?"low"===e.highlightValue?e.highlightClass="px-data-table-highlight--"+c.highlightValue:"medium"===e.highlightValue?"high"===c.highlightValue&&(e.highlightClass="px-data-table-highlight--"+c.highlightValue):e.highlightClass="px-data-table-highlight--"+c.highlightValue:!e.value&&(e.value=d,e.highlightClass="px-data-table-highlight--"+c.highlightValue),"row"===c.highlightType&&(this._setInternalDataAt(a,"_highlight",e),e={value:!1})}.bind(this)),e},_isSelectAllColumn:function(a){return a.selectAll},_isFilterableColumn:function(a){return!a.selectAll&&a.filterable&&this.filterable},_readContent:function(a,b){var c=this._getInternalDataAt(a,b.name);return null===c||void 0===c||this._typeofComparison(c,"string")&&0===c.trim().length?"":this._shouldClipDatumString(a,b)?this._clipDatumString(c,b):c},_shouldClipDatumString:function(a,b){var c=this._getInternalDataAt(a,b.name),d=b.maxColumnCharacterWidth;return 0===d||null===c||void 0===c||this._typeofComparison(c,"string")&&0===c.trim().length?!1:void 0!==d&&null!==d&&c.length>d},_clipDatumString:function(a,b){var c,d,e=b.maxColumnCharacterWidth,f=b.ellipsisClipPosition;return"left"===f?a="\u2026"+a.substr(a.length-e,a.length):"center"===f?(c=Math.floor(e/2),d=e-c,a=a.substr(0,c)+"\u2026"+a.substr(a.length-d,a.length)):a=a.substr(0,e)+"\u2026",a},_isEqual:function(a,b){return a===b},_getHeaderClass:function(a){var b=["th","aha-"+a.name+"-th","u-p0"];return this.sortable&&a.sortable&&b.push("sortable"),this.enableColumnReorder&&"selected"!==a.type&&b.push("moveable"),b.join(" ")},_getSecondHeaderClass:function(a){var b=["tr","tr--filter"];return a||b.push("hidden"),b.join(" ")},_getFilterHeaderClass:function(a){return"insertion-indicator"===a.name?"td insertion-indicator":"td"},_getSortingIcon:function(a,b,c,d){var e=" ";return a&&c===b.name&&(e=d?"px-nav:down":"px-nav:up"),e},_getSortingClass:function(a,b,c){var d="sorting";return a&&c!==b.name&&(d+=" visuallyhidden"),d},_getTextSortingClass:function(a,b,c){var d=["column-head","u-mv--","u-mh-"];return"_selected"===b.name&&d.push("column-head--selected"),a&&b.sortable&&d.push("sorted-text-hover"),a&&c===b.name&&d.push("sorted-text"),d.join(" ")},_getTableClass:function(a,b){var c=[];return a&&c.push("table--cells"),b&&c.push("table--columns"),c.join(" ")},_getPaginationVisibility:function(a){return a?"visuallyhidden":""},_getSelectedCellClass:function(a,b){var c=["td",a?"selected-cell__selected":"",b.value?b.highlightClass:""];return c.join(" ")},_findHeaderFromChild:function(a){for(var b=a;!b.classList.contains("th")&&b!==this;)b=Polymer.dom(b).parentNode;return b},_computeIfColumnFilterEnabled:function(a,b){this._enableFilterRow=a&&(this.selectable&&!this.singleSelect||b&&this.meta.some(function(a){return this._isFilterableColumn(a)}.bind(this)))},_typeofComparison:function(a,b){return typeof a===b||!1}});</script></body></html>