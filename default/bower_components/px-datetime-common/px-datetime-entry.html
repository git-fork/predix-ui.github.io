<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="px-datetime-validate.html"><link rel="import" href="px-datetime-behavior.html"><link rel="import" href="px-datetime-entry-cell.html"><link rel="import" href="../px-icon-set/px-icon-set.html"><link rel="import" href="../px-icon-set/px-icon.html"><link rel="import" href="../px-dropdown/px-dropdown.html"><link rel="import" href="css/px-datetime-entry-styles.html"></head><body><dom-module id="px-datetime-entry"><template><style include="px-datetime-entry-styles"></style><div id="wrapper" class="flex flex--middle"><div class="flex flex--middle dt-flex--no-shrink"><div class$="{{_getIconClass(hideIcon)}}" on-tap="_iconClicked"><span class="a11y">{{dateOrTime}}</span><template is="dom-if" if="{{!hideIcon}}"><px-icon id="icon" class="dt-icon" icon="[[_setIcon(dateOrTime)]]"></px-icon></template></div><template is="dom-repeat" items="{{_cellFormatArray}}"><px-datetime-entry-cell id="cell{{index}}" class="cell" order="{{index}}" moment-obj="[[momentObj]]" moment-format="[[item]]" symbol="[[_returnSymbol(index,_symbolCharArray)]]" time-zone="[[timeZone]]" is-selected="{{isSelected}}" resources="[[resources]]" language="[[language]]" formats="[[formats]]"></px-datetime-entry-cell><template is="dom-if" if="{{_isSymbol(index,_symbolCharArray)}}"><div class="dt-entry-symbol">{{_returnSymbol(index,_symbolCharArray)}}</div></template></template></div><div class$="{{_getTimeZoneTextClass(showTimeZone, isValid)}}"><template is="dom-if" if="{{_showTimeZoneDropdown(showTimeZone)}}"><px-dropdown id="dropdown" class="dropdown" display-value="[[timeZone]]" button-style="bare" search-mode="" disable-clear="" items="[[_getTimeZoneList(showTimeZone)]]" on-focus="_handleDropdownFocus" on-blur="_handleDropdownBlur"></px-dropdown></template><template is="dom-if" if="{{_showTimeZoneText(showTimeZone)}}"><span id="timeZoneText" class="dt-text-input--non-editable">{{_getTimeZoneText(timeZone, showTimeZone)}}</span></template></div></div></template></dom-module><script>Polymer({is:'px-datetime-entry',behaviors:[PxDatetimeBehavior.SingleMoment,PxDatetimeBehavior.Validate],properties:{dateOrTime:{type:String,value:'Date'},momentFormat:{type:String,value:'YYYY/MM/DD',observer:'_formatChanged'},hideIcon:{type:Boolean,value:!1},_cellFormatArray:{type:Array,notify:!0},_symbolCharArray:{type:Array,notify:!0,value:function(){return[]}},showTimeZone:{type:String,value:''},isSelected:{type:Boolean,notify:!0}},listeners:{"px-entry-cell-move":'_entryCellMove',"px-cell-blurred":'_handleBlur',"px-request-datetime-entry-copy":'_handleCopy',"px-request-datetime-entry-paste":'_handlePaste',"px-dropdown-selection-changed":'_updateTimeZone'},attached:function(){'string'===typeof this.momentFormat&&this._formatChanged(this.momentFormat)},clear:function(){var a=Polymer.dom(this.root).querySelectorAll('.cell');a.forEach(function(a){a.clear()})},setValueFromMoment:function(){var a=Polymer.dom(this.root).querySelectorAll('.cell');a.forEach(function(a){a.setValueFromMoment()})},_formatChanged:function(a){if(a!==void 0){var b=this._splitFormat(a);(b._cellFormatArray!==this._cellFormatArray||b._symbolCharArray!==this._symbolCharArray)&&(this._cellFormatArray=b._cellFormatArray,this._symbolCharArray=b._symbolCharArray,this.notifyPath('_cellFormatArray',this._cellFormatArray),this.notifyPath('_symbolCharArray',this._symbolCharArray),this._sizeSymbols())}},_sizeSymbols:function(){var a,b=window.getComputedStyle(this,null),d=b.getPropertyValue('font-size'),e=b.getPropertyValue('font-family'),f=document.createElement('canvas'),c=f.getContext('2d'),g=Polymer.dom(this.root).querySelectorAll('.dt-entry-symbol');c.font=d+' '+e,g.forEach(function(b){a=c.measureText(b.innerHTML.trim().replace('&nbsp;',' ')).width,b.style.width=a+'px'})},_splitFormat:function(a){var b=/[MDYAaHhkmsSZXx]+/g,c=/\W+/g;return{_cellFormatArray:a.match(b),_symbolCharArray:a.match(c)}},_isSymbol:function(a,b){return null===b||'undefined'===typeof b[a]?!1:!0},_returnSymbol:function(a,b){return null===b||'undefined'===typeof b[a]?'':b[a].split(' ').join('\xA0')},_setIcon:function(){return'date'===this.dateOrTime.toLowerCase()?'px-utl:calendar':'px-utl:clock'},_entryCellMove:function(a){var b=Polymer.dom(a),c=b.rootTarget.order;c===this._cellFormatArray.length-1&&1===a.detail.dir?this.fire('px-next-field',{dateOrTime:this.dateOrTime}):0===c&&-1===a.detail.dir?this.fire('px-previous-field',{dateOrTime:this.dateOrTime}):this._focusCell(parseInt(c)+a.detail.dir)},_focusCell:function(a){var b=this.$$('#cell'+a);b.$.dtEntry.focus()},_focusLastCell:function(){this._focusCell(this._cellFormatArray.length-1)},_handleBlur:function(){this._validateInput(this.momentFormat,this.timeZone)},_handleDropdownFocus:function(){this.fire('px-dropdown-focused',{},{cancelable:!0})},_handleDropdownBlur:function(){this.fire('px-dropdown-blurred',{},{cancelable:!0})},_showTimeZoneText:function(a){return'text'===a||'abbreviatedText'===a},_showTimeZoneDropdown:function(a){return'dropdown'===a||'extendedDropdown'===a},_getTimeZoneList:function(a){if('extendedDropdown'===a)return Px.moment.tz.names();return'dropdown'===a?['Etc/GMT','Etc/GMT+0','Etc/GMT+1','Etc/GMT+10','Etc/GMT+11','Etc/GMT+12','Etc/GMT+2','Etc/GMT+3','Etc/GMT+4','Etc/GMT+5','Etc/GMT+6','Etc/GMT+7','Etc/GMT+8','Etc/GMT+9','Etc/GMT-0','Etc/GMT-1','Etc/GMT-10','Etc/GMT-11','Etc/GMT-12','Etc/GMT-13','Etc/GMT-14','Etc/GMT-2','Etc/GMT-3','Etc/GMT-4','Etc/GMT-5','Etc/GMT-6','Etc/GMT-7','Etc/GMT-8','Etc/GMT-9','Etc/GMT0','UCT','UTC']:[]},_updateTimeZone:function(a){this.set('timeZone',a.detail.val)},_handleCopy:function(a){a.detail.setData('Text',Px.moment.tz(this.momentObj,this.timeZone).format(this.momentFormat)),a.stopPropagation()},_handlePaste:function(a){var b=a.detail.getData('Text'),c=Px.moment(b,this.momentFormat);c.isValid()?this.momentObj=c:console.log('tried to paste non valid date format: '+b+'. Expecting: '+this.momentFormat),a.stopPropagation()},_getIconClass:function(a){return a?'':'u-mr--'},_getTimeZoneText:function(a,b){return void 0!==a&&'abbreviatedText'===b?(tempMomentObj=this.momentObj?this.momentObj:Px.moment(),Px.moment.tz.zone(a).abbr(tempMomentObj)):'text'===b?a:void 0},_getTimeZoneTextClass:function(a){var b='dt-flex--no-shrink ';return'text'===a||'abbreviatedText'===a?b+='u-ml- ':('dropdown'===a||'extendedDropdown'===a)&&(b+='u-ml-- '),b},_iconClicked:function(){this.fire('px-datetime-entry-icon-clicked',{dateOrTime:this.dateOrTime})}});</script></body></html>