!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b((a.Leaflet=a.Leaflet||{},a.Leaflet.markercluster=a.Leaflet.markercluster||{}))}(this,function(a){"use strict";var b=Math.sin,c=Math.cos,d=Math.floor,f=Math.round,e=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var b=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,b?this._withAnimation:this._noAnimation),this._markerCluster=b?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup)return this.addLayers([a]);if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this.fire("layeradd",{layer:a}),this;if(!this._map)return this._needsClustering.push(a),this.fire("layeradd",{layer:a}),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom),this.fire("layeradd",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var b=a,c=this._zoom;if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;return this._currentShownBounds.contains(b.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b)),this},removeLayer:function(a){return a instanceof L.LayerGroup?this.removeLayers([a]):a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this.fire("layerremove",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),a.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}),this):(this._nonPointGroup.removeLayer(a),this.fire("layerremove",{layer:a}),this)},addLayers:function(b,e){if(!L.Util.isArray(b))return this.addLayer(b);var g,j=this._featureGroup,k=this._nonPointGroup,n=this.options.chunkedLoading,f=this.options.chunkInterval,o=this.options.chunkProgress,a=b.length,h=0,l=!0;if(this._map){var q=new Date().getTime(),r=L.bind(function(){for(var d=new Date().getTime();a>h;h++){if(n&&0===h%200){var c=new Date().getTime()-d;if(c>f)break}if(g=b[h],g instanceof L.LayerGroup)l&&(b=b.slice(),l=!1),this._extractNonGroupLayers(g,b),a=b.length;else if(!g.getLatLng)k.addLayer(g),e||this.fire("layeradd",{layer:g});else if(!this.hasLayer(g)&&(this._addLayer(g,this._maxZoom),e||this.fire("layeradd",{layer:g}),g.__parent&&2===g.__parent.getChildCount())){var p=g.__parent.getAllChildMarkers(),s=p[0]===g?p[1]:p[0];j.removeLayer(s)}}o&&o(h,a,new Date().getTime()-q),h===a?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(r,this.options.chunkDelay)},this);r()}else for(var d=this._needsClustering;a>h;h++)g=b[h],g instanceof L.LayerGroup?(l&&(b=b.slice(),l=!1),this._extractNonGroupLayers(g,b),a=b.length):g.getLatLng?this.hasLayer(g)||d.push(g):k.addLayer(g);return this},removeLayers:function(b){var c,d,e=b.length,f=this._featureGroup,g=this._nonPointGroup,j=!0;if(!this._map){for(c=0;e>c;c++)d=b[c],d instanceof L.LayerGroup?(j&&(b=b.slice(),j=!1),this._extractNonGroupLayers(d,b),e=b.length):(this._arraySplice(this._needsClustering,d),g.removeLayer(d),this.hasLayer(d)&&this._needsRemoving.push({layer:d,latlng:d._latlng}),this.fire("layerremove",{layer:d}));return this}if(this._unspiderfy){this._unspiderfy();var k=b.slice(),a=e;for(c=0;a>c;c++)d=k[c],d instanceof L.LayerGroup?(this._extractNonGroupLayers(d,k),a=k.length):this._unspiderfyLayer(d)}for(c=0;e>c;c++)d=b[c],d instanceof L.LayerGroup?(j&&(b=b.slice(),j=!1),this._extractNonGroupLayers(d,b),e=b.length):d.__parent?(this._removeLayer(d,!0,!0),this.fire("layerremove",{layer:d}),f.hasLayer(d)&&(f.removeLayer(d),d.clusterShow&&d.clusterShow())):(g.removeLayer(d),this.fire("layerremove",{layer:d}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){a.off(this._childMarkerEventHandlers,this),delete a.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(var b=this._needsClustering.length-1;0<=b;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d,e,f=this._needsClustering.slice(),g=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(f),d=f.length-1;0<=d;d--){for(c=!0,e=g.length-1;0<=e;e--)if(g[e].layer===f[d]){c=!1;break}c&&a.call(b,f[d])}this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return a=parseInt(a,10),this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;0<=b;b--)if(c[b]===a)return!0;for(c=this._needsRemoving,b=c.length-1;0<=b;b--)if(c[b].layer===a)return!1;return a.__parent&&a.__parent._group===this||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){"function"!=typeof b&&(b=function(){});var c=function(){(a._icon||a.__parent._icon)&&!this._inZoomAnimation&&(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<f(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(a),this._nonPointGroup.addTo(a),this._gridClusters||this._generateInitialClusters(),this._maxLat=a.options.crs.projection.MAX_LATITUDE,b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],d.newlatlng=d.layer._latlng,d.layer._latlng=d.latlng;for(b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],this._removeLayer(d.layer,!0),d.layer._latlng=d.newlatlng;this._needsRemoving=[],this._zoom=f(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),c=this._needsClustering,this._needsClustering=[],this.addLayers(c,!0)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){for(var b=a;b&&!b._icon;)b=b.__parent;return b||null},_arraySplice:function(a,b){for(var c=a.length-1;0<=c;c--)if(a[c]===b)return a.splice(c,1),!0},_removeFromGridUnclustered:function(a,b){for(var c=this._map,e=this._gridUnclustered,f=d(this._map.getMinZoom());b>=f&&e[b].removeObject(a,c.project(a.getLatLng(),b));b--);},_childMarkerDragStart:function(a){a.target.__dragStart=a.target._latlng},_childMarkerMoved:function(a){if(!this._ignoreMove&&!a.target.__dragStart){var b=a.target._popup&&a.target._popup.isOpen();this._moveChild(a.target,a.oldLatLng,a.latlng),b&&a.target.openPopup()}},_moveChild:function(a,b,c){a._latlng=b,this.removeLayer(a),a._latlng=c,this.addLayer(a)},_childMarkerDragEnd:function(a){a.target.__dragStart&&this._moveChild(a.target,a.target.__dragStart,a.target._latlng),delete a.target.__dragStart},_removeLayer:function(b,c,e){var f=this._gridClusters,g=this._gridUnclustered,i=this._featureGroup,j=this._map,k=d(this._map.getMinZoom());c&&this._removeFromGridUnclustered(b,this._maxZoom);var a,h=b.__parent,l=h._markers;for(this._arraySplice(l,b);h&&(h._childCount--,h._boundsNeedUpdate=!0,!(h._zoom<k));)c&&1>=h._childCount?(a=h._markers[0]===b?h._markers[1]:h._markers[0],f[h._zoom].removeObject(h,j.project(h._cLatLng,h._zoom)),g[h._zoom].addObject(a,j.project(a.getLatLng(),h._zoom)),this._arraySplice(h.__parent._childClusters,h),h.__parent._markers.push(a),a.__parent=h.__parent,h._icon&&(i.removeLayer(h),e||i.addLayer(a))):h._iconNeedsUpdate=!0,h=h.__parent;delete b.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},fire:function(a,b,c){if(b&&b.layer instanceof L.MarkerCluster){if(b.originalEvent&&this._isOrIsParent(b.layer._icon,b.originalEvent.relatedTarget))return;a="cluster"+a}L.FeatureGroup.prototype.fire.call(this,a,b,c)},listens:function(a,b){return L.FeatureGroup.prototype.listens.call(this,a,b)||L.FeatureGroup.prototype.listens.call(this,"cluster"+a,b)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=10>b?"small":100>b?"medium":"large",new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){for(var b=a.layer,c=b;1===c._childClusters.length;)c=c._childClusters[0];c._zoom===this._maxZoom&&c._childCount===b._childCount&&this.options.spiderfyOnMaxZoom?b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds(),a.originalEvent&&13===a.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),2<a.layer.getChildCount()&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=f(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,d(this._map.getMinZoom()),this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,f(this._map._zoom),a),this._currentShownBounds=a}},_generateInitialClusters:function(){var a=Math.ceil(this._map.getMaxZoom()),b=d(this._map.getMinZoom()),c=this.options.maxClusterRadius,e=c;"function"!=typeof c&&(e=function(){return c}),null!==this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var f=a;f>=b;f--)this._gridClusters[f]=new L.DistanceGrid(e(f)),this._gridUnclustered[f]=new L.DistanceGrid(e(f));this._topClusterLevel=new this._markerCluster(this,b-1)},_addLayer:function(b,c){var e,f,g=this._gridClusters,i=this._gridUnclustered,j=d(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(b),b.on(this._childMarkerEventHandlers,this);c>=j;c--){e=this._map.project(b.getLatLng(),c);var k=g[c].getNearObject(e);if(k)return k._addChild(b),b.__parent=k,void 0;if(k=i[c].getNearObject(e)){var a=k.__parent;a&&this._removeLayer(k,!1);var h=new this._markerCluster(this,c,k,b);g[c].addObject(h,this._map.project(h._cLatLng,c)),k.__parent=h,b.__parent=h;var l=h;for(f=c-1;f>a._zoom;f--)l=new this._markerCluster(this,f,l),g[f].addObject(l,this._map.project(k.getLatLng(),f));return a._addChild(l),this._removeFromGridUnclustered(k,c),void 0}i[c].addObject(b,e)}this._topClusterLevel._addChild(b),b.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var a=f(this._map._zoom);this._processQueue(),this._zoom<a&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,d(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,a)):this._zoom>a?(this._animationStart(),this._animationZoomOut(this._zoom,a)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;return void 0!==b&&(a.getNorth()>=b&&(a._northEast.lat=1/0),a.getSouth()<=-b&&(a._southWest.lat=-1/0)),a},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()},_extractNonGroupLayers:function(a,b){var c,d=a.getLayers(),e=0;for(b=b||[];e<d.length;e++)c=d[e],c instanceof L.LayerGroup?this._extractNonGroupLayers(c,b):b.push(c);return b},_overrideMarkerIcon:function(a){var b=a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}});return b}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,d(this._map.getMinZoom()),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,d(this._map.getMinZoom()),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(b,c){var e,f=this._getExpandedVisibleBounds(),g=this._featureGroup,a=d(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(f,b,a,function(d){var i,j=d._latlng,a=d._markers;for(f.contains(j)||(j=null),d._isSingleParent()&&b+1===c?(g.removeLayer(d),d._recursivelyAddChildrenToMap(null,c,f)):(d.clusterHide(),d._recursivelyAddChildrenToMap(j,c,f)),e=a.length-1;0<=e;e--)i=a[e],f.contains(i._latlng)||g.removeLayer(i)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(f,c),g.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.clusterShow()}),this._topClusterLevel._recursively(f,b,c,function(a){a._recursivelyRestoreChildPositions(c)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(f,b,a,function(a){g.removeLayer(a),a.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,d(this._map.getMinZoom()),a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(2<b._childCount?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.clusterHide(),this._enqueue(function(){d.removeLayer(a),a.clusterShow(),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(a,b,c){var f=this._getExpandedVisibleBounds(),g=d(this._map.getMinZoom());a._recursivelyAnimateChildrenInAndAddSelfToMap(f,g,b+1,c);var e=this;this._forceLayout(),a._recursivelyBecomeVisible(f,c),this._enqueue(function(){if(1===a._childCount){var d=a._markers[0];this._ignoreMove=!0,d.setLatLng(d.getLatLng()),this._ignoreMove=!1,d.clusterShow&&d.clusterShow()}else a._recursively(f,c,g,function(a){a._recursivelyRemoveChildrenFromMap(f,g,b+1)});e._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)};var g=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this,pane:a.options.clusterPane}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;0<=b;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;0<=c;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(b){for(var c,d=this._childClusters.slice(),e=this._group._map,f=e.getBoundsZoom(this._bounds),g=this._zoom+1,h=e.getZoom();0<d.length&&f>g;){g++;var i=[];for(c=0;c<d.length;c++)i=i.concat(d[c]._childClusters);d=i}f>g?this._group._map.setView(this._latlng,g):h>=f?this._group._map.setView(this._latlng,h+1):this._group._map.fitBounds(this._bounds,b)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=1/0,a._southWest.lng=1/0),a._northEast&&(a._northEast.lat=-1/0,a._northEast.lng=-1/0)},_recalculateBounds:function(){var b,c,d,e,f=this._markers,g=this._childClusters,i=0,j=0,a=this._childCount;if(0!==a){for(this._resetBounds(),b=0;b<f.length;b++)d=f[b]._latlng,this._bounds.extend(d),i+=d.lat,j+=d.lng;for(b=0;b<g.length;b++)c=g[b],c._boundsNeedUpdate&&c._recalculateBounds(),this._bounds.extend(c._bounds),d=c._wLatLng,e=c._childCount,i+=d.lat*e,j+=d.lng*e;this._latlng=this._wLatLng=new L.LatLng(i/a,j/a),this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,this._group._map.getMinZoom(),c-1,function(a){var c,d,e=a._markers;for(c=e.length-1;0<=c;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())},function(a){var c,d,e=a._childClusters;for(c=e.length-1;0<=c;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c,d){this._recursively(a,d,b,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),c),e._isSingleParent()&&c-1===d?(e.clusterShow(),e._recursivelyRemoveChildrenFromMap(a,b,c)):e.clusterHide(),e._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,this._group._map.getMinZoom(),b,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,this._group._map.getMinZoom()-1,b,function(d){if(b!==d._zoom)for(var e,f=d._markers.length-1;0<=f;f--)e=d._markers[f],c.contains(e._latlng)&&(a&&(e._backupLatlng=e.getLatLng(),e.setLatLng(a),e.clusterHide&&e.clusterHide()),d._group._featureGroup.addLayer(e))},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b,c=this._markers.length-1;0<=c;c--)b=this._markers[c],b._backupLatlng&&(b.setLatLng(b._backupLatlng),delete b._backupLatlng);if(a-1===this._zoom)for(var d=this._childClusters.length-1;0<=d;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;0<=e;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c,d){var f,g;this._recursively(a,b-1,c-1,function(a){for(g=a._markers.length-1;0<=g;g--)f=a._markers[g],d&&d.contains(f._latlng)||(a._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())},function(a){for(g=a._childClusters.length-1;0<=g;g--)f=a._childClusters[g],d&&d.contains(f._latlng)||(a._group._featureGroup.removeLayer(f),f.clusterShow&&f.clusterShow())})},_recursively:function(b,c,d,e,f){var g,i,j=this._childClusters,a=this._zoom;if(a>=c&&(e&&e(this),f&&a===d&&f(this)),c>a||d>a)for(g=j.length-1;0<=g;g--)i=j[g],b.intersects(i._bounds)&&i._recursively(b,c,d,e,f)},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var a=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,a}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(b,c){var d=this._getCoord(c.x),e=this._getCoord(c.y),f=this._grid,g=f[e]=f[e]||{},h=g[d]=g[d]||[],i=L.Util.stamp(b);this._objectPoint[i]=c,h.push(b)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(b,c){var d,e,f=this._getCoord(c.x),g=this._getCoord(c.y),i=this._grid,j=i[g]=i[g]||{},a=j[f]=j[f]||[];for(delete this._objectPoint[L.Util.stamp(b)],d=0,e=a.length;e>d;d++)if(a[d]===b)return a.splice(d,1),1===e&&delete j[f],!0},eachObject:function(b,c){var d,e,f,g,i,j,a,h=this._grid;for(d in h)for(e in i=h[d],i)for(j=i[e],f=0,g=j.length;g>f;f++)a=b.call(c,j[f]),a&&(f--,g--)},getNearObject:function(b){var e,f,g,i,j,k,m,a,h=this._getCoord(b.x),l=this._getCoord(b.y),n=this._objectPoint,o=this._sqCellSize,d=null;for(e=l-1;l+1>=e;e++)if(i=this._grid[e])for(f=h-1;h+1>=f;f++)if(j=i[f])for(g=0,k=j.length;k>g;g++)m=j[g],a=this._sqDist(n[L.Util.stamp(m)],b),(o>a||o>=a&&null===d)&&(o=a,d=m);return d},_getCoord:function(a){var b=d(a/this._cellSize);return isFinite(b)?b:a},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat,d=b[0].lng-b[1].lng;return d*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(b,c){var d,e,f,g=0,h=null,i=[];for(d=c.length-1;0<=d;d--)e=c[d],f=this.getDistant(e,b),0<f&&(i.push(e),f>g&&(g=f,h=e));return{maxPoint:h,newPoints:i}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);return d.maxPoint?(c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints))):[a[0]]},getConvexHull:function(b){var e,f=!1,g=!1,i=!1,j=!1,k=null,m=null,a=null,h=null,l=null,n=null;for(e=b.length-1;0<=e;e--){var o=b[e];(!1===f||o.lat>f)&&(k=o,f=o.lat),(!1===g||o.lat<g)&&(m=o,g=o.lat),(!1===i||o.lng>i)&&(a=o,i=o.lng),(!1===j||o.lng<j)&&(h=o,j=o.lng)}g===f?(n=h,l=a):(n=m,l=k);var d=[].concat(this.buildConvexHull([n,l],b),this.buildConvexHull([l,n],b));return d}}}(),L.MarkerCluster.include({getConvexHull:function(){var a,b,c=this.getAllChildMarkers(),d=[];for(b=c.length-1;0<=b;b--)a=c[b].getLatLng(),d.push(a);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(),c=this._group,d=c._map,e=d.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,e):(e.y+=10,a=this._generatePointsCircle(b.length,e)),this._animationSpiderfy(b,a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(d,e){var f,g,h=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+d),i=h/this._2PI,j=this._2PI/d,k=[];for(i=Math.max(i,35),k.length=d,f=0;d>f;f++)g=this._circleStartAngle+f*j,k[f]=new L.Point(e.x+i*c(g),e.y+i*b(g))._round();return k},_generatePointsSpiral:function(d,e){var f,g=this._group.options.spiderfyDistanceMultiplier,i=g*this._spiralLengthStart,j=g*this._spiralFootSeparation,k=g*this._spiralLengthFactor*this._2PI,l=0,a=[];for(a.length=d,f=d;0<=f;f--)d>f&&(a[f]=new L.Point(e.x+i*c(l),e.y+i*b(l))._round()),l+=j/i+5e-4*f,i+=k/l;return a},_noanimationUnspiderfy:function(){var a,b,c=this._group,d=c._map,e=c._featureGroup,f=this.getAllChildMarkers();for(c._ignoreMove=!0,this.setOpacity(1),b=f.length-1;0<=b;b--)a=f[b],e.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(d.removeLayer(a._spiderLeg),delete a._spiderLeg);c.fire("unspiderfied",{cluster:this,markers:f}),c._ignoreMove=!1,c._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(b,c){var d,f,g,i,j=this._group,k=j._map,a=j._featureGroup,h=this._group.options.spiderLegPolylineOptions;for(j._ignoreMove=!0,d=0;d<b.length;d++)i=k.layerPointToLatLng(c[d]),f=b[d],g=new L.Polyline([this._latlng,i],h),k.addLayer(g),f._spiderLeg=g,f._preSpiderfyLatlng=f._latlng,f.setLatLng(i),f.setZIndexOffset&&f.setZIndexOffset(1e6),a.addLayer(f);this.setOpacity(.3),j._ignoreMove=!1,j.fire("spiderfied",{cluster:this,markers:b})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(b,g){var j,i,k,n,q,o,a=this,r=this._group,l=r._map,s=r._featureGroup,t=this._latlng,d=l.latLngToLayerPoint(t),c=L.Path.SVG,p=L.extend({},this._group.options.spiderLegPolylineOptions),f=p.opacity;for(void 0===f&&(f=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),c?(p.opacity=0,p.className=(p.className||"")+" leaflet-cluster-spider-leg"):p.opacity=f,r._ignoreMove=!0,j=0;j<b.length;j++)i=b[j],o=l.layerPointToLatLng(g[j]),k=new L.Polyline([t,o],p),l.addLayer(k),i._spiderLeg=k,c&&(n=k._path,q=n.getTotalLength()+.1,n.style.strokeDasharray=q,n.style.strokeDashoffset=q),i.setZIndexOffset&&i.setZIndexOffset(1e6),i.clusterHide&&i.clusterHide(),s.addLayer(i),i._setPos&&i._setPos(d);for(r._forceLayout(),r._animationStart(),j=b.length-1;0<=j;j--)o=l.layerPointToLatLng(g[j]),i=b[j],i._preSpiderfyLatlng=i._latlng,i.setLatLng(o),i.clusterShow&&i.clusterShow(),c&&(k=i._spiderLeg,n=k._path,n.style.strokeDashoffset=0,k.setStyle({opacity:f}));this.setOpacity(.3),r._ignoreMove=!1,setTimeout(function(){r._animationEnd(),r.fire("spiderfied",{cluster:a,markers:b})},200)},_animationUnspiderfy:function(b){var f,g,e,i,j,k,m=this,n=this._group,h=n._map,l=n._featureGroup,o=b?h._latLngToNewLayerPoint(this._latlng,b.zoom,b.center):h.latLngToLayerPoint(this._latlng),p=this.getAllChildMarkers(),q=L.Path.SVG;for(n._ignoreMove=!0,n._animationStart(),this.setOpacity(1),g=p.length-1;0<=g;g--)f=p[g],f._preSpiderfyLatlng&&(f.closePopup(),f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng,k=!0,f._setPos&&(f._setPos(o),k=!1),f.clusterHide&&(f.clusterHide(),k=!1),k&&l.removeLayer(f),q&&(e=f._spiderLeg,i=e._path,j=i.getTotalLength()+.1,i.style.strokeDashoffset=j,e.setStyle({opacity:0})));n._ignoreMove=!1,setTimeout(function(){var b=0;for(g=p.length-1;0<=g;g--)f=p[g],f._spiderLeg&&b++;for(g=p.length-1;0<=g;g--)f=p[g],f._spiderLeg&&(f.clusterShow&&f.clusterShow(),f.setZIndexOffset&&f.setZIndexOffset(0),1<b&&l.removeLayer(f),h.removeLayer(f._spiderLeg),delete f._spiderLeg);n._animationEnd(),n.fire("unspiderfied",{cluster:m,markers:p})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(a){return a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(a),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a),this},_flagParentsIconsNeedUpdate:function(a){var b,c;for(b in a)for(c=a[b].__parent;c;)c._iconNeedsUpdate=!0,c=c.__parent},_refreshSingleMarkerModeMarkers:function(a){var b,c;for(b in a)c=a[b],this.hasLayer(c)&&c.setIcon(this._overrideMarkerIcon(c))}}),L.Marker.include({refreshIconOptions:function(a,b){var c=this.options.icon;return L.setOptions(c,a),this.setIcon(c),b&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),a.MarkerClusterGroup=e,a.MarkerCluster=g});