<link defer rel="import" href="../../bower_components/polymer/polymer-element.html" />
<link defer rel="import" href="../../bower_components/polymer/lib/utils/gestures.html" />
<link defer rel="import" href="../../bower_components/px-demo/px-demo-footer.html" />
<link defer rel="import" href="../../elements/px-catalog-page/px-catalog-page-behavior.html" />
<link defer rel="import" href="../../elements/px-catalog-page/px-catalog-page-elements.html" />
<link defer rel="import" href="../../elements/px-catalog-code-snippet/px-catalog-code-snippet.html" />
<link defer rel="import" href="../../css/px-catalog-page-styles.html" />
<link defer rel="import" href="../../css/px-catalog-theme-styles.html" />
<link async rel="import" href="../../css/px-cla-styles.html">
<link defer rel="import" href="../../bower_components/px-datetime-field/px-datetime-field.html">
<script async src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>

<dom-module id="dev-cla">
  <template>
    <style include="px-catalog-theme-styles px-catalog-page-styles"></style>
    <style include="px-cla-styles"></style>

    <div class="page">
      <div class="page-content">
        <h2 class="page-title">General Electric Contributor License Agreement</h2>

        <p>Want to contribute your suggestions to the Predix Design System? <strong>Here's how you can help.</strong></p>
        <p>Please signn in via GitHub below so we can retrieve your details</p>
        <button on-tap="_signin" class="u-mt btn btn--primary">Sign in with GitHub</button></p>
        <p>To avoid any confusion, except for the licenses granted by You pursuant to this Agreement, You reserve all ownership rights, title, and interest in and to Your Contributions.</p>
        <p>You accept and agree to the following terms and conditions for Your Contributions to GE.</p>
        <p> 1.       Definitions</p>
        <p>“You” or “Your” means the individual or legal entity that is entering into this Agreement.</p>
        <p>“Contribution” means any past, present, or future original work of authorship that You submit to GE through any form of communication for inclusion in any Work, including but not limited to source code, object code, machine code, updates, patches, samples, tools, documentation, manuals, graphics, pictures, specifications, or standards.</p>
        <p>“Work” means any work of authorship or product that GE owns, manages, or makes available to third parties.</p>
        <p>2.       Copyright License:  You hereby grant to GE, to the fullest extent permitted by law, a perpetual, worldwide, non-exclusive, no-charge, royalty-free, transferrable, irrevocable copyright license to use, copy, modify, merge, prepare derivative works of, publicly display, publicly perform, sublicense (through multiple tiers of sublicensees), publish, sell, and/or distribute Your Contributions and such derivative works.</p>
        <p>3.       Patent License:  You hereby grant to GE, and agree to grant to GE, to the fullest extent permitted by law, a perpetual, worldwide, transferrable, non-exclusive, royalty-free, irrevocable patent license to any patent claims that are now, or become, licensable by You to make, have made, use, offer to sell, sell, import, and otherwise transfer the Contribution and the Contribution in combination with any Work, including the right to sublicense these same rights to third parties through multiple tiers of sublicensees.</p>
        <p>4.       Moral Rights:  If applicable, You hereby agree, to the fullest extent permitted by law, to waive and not to assert moral rights associated with Your Contribution against GE or any of GE’s direct and indirect licensees.</p>
        <p>5.       You further agree that:</p>
        <p>a.       You have the full power and authority to grant the rights granted pursuant to this Agreement without the consent of any third party and Your grant of rights pursuant to this Agreement does not contradict or violate any grant of rights You have made to third parties, including but not limited to (if applicable) Your employer.</p>
        <p>b.       If You are entering this Agreement as a legal entity, each of Your employees listed on Schedule 1 to this Agreement is authorized to submit Contributions on Your behalf.</p>
        <p>c.        You own the copyright and patent claims covering Your Contribution that are required to grant the rights granted pursuant to this Agreement.</p>
        <p>d.       To the best of Your Knowledge, Your Contribution does not violate the intellectual property rights of any third party.</p>
        <p>e.        You are in compliance with applicable export control laws.</p>
        <p>f.         If You are entering into this Agreement as an individual, You are over eighteen years old.  (if You are under eighteen years old, You must have a parent or guardian sign this Agreement)</p>
        <p>g.       GE may publicly display the “Contributor User Name” that You provide in this Agreement as well as the fact that You have entered into this Agreement.</p>
        <p>h.       You will promptly notify GE of any facts or circumstances that you become aware of that would make any representations made by You in this Agreement inaccurate.</p>
        <p>6.       This Agreement shall be governed by and interpreted in accordance with the laws of the State of New York, U.S.A. and applicable U.S. Federal law, excluding choice or conflicts of law provisions.</p>
        <p>7.       Failure by either You or GE at any time to exercise a right under, or require performance of, any provision of this Agreement shall not affect the right to subsequently exercise that right or require full performance thereof (as the case may be) at any time thereafter.  The waiver by You or GE of a breach of any provision of this Agreement shall not be taken or held to be a waiver of any subsequent breach or as nullifying the effectiveness of such provision.</p>
        <p>8.       If any part, term or provision of this Agreement is held by any court of competent jurisdiction to be unenforceable or prohibited by any law applicable to this Agreement, the rights and obligations herein shall be construed and enforced with that part, term or provision limited so as to make it enforceable to the greatest extent allowed by law, or, if it is totally unenforceable, as if this Agreement did not contain that particular part, term or provision.</p>
        <p>This Agreement constitutes the entire Agreement between You and GE with regard to Your Contributions to GE and shall supersede all other agreements, negotiations, offers, exceptions, and understandings.</p>
        <legend>You will submit contributions on behalf of:</legend>
        <div class="u-mt btn-group">
          <input id="individual" name="btn-group" type="radio" checked={{_isIndividual}} on-change="_contributorTypeClicked">
          <label for="individual" class="btn">Individual</label>
          <input id="employer" name="btn-group" type="radio" checked={{!_isIndividual}} on-change="_contributorTypeClicked">
          <label for="employer" class="btn">Your Employer</label>
        </div>
        <form>
          <fieldset class="u-mt form-field" style="max-width:400px;">
              <legend>{{_formLabel(_isIndividual)}}</legend>
              <ol class="list-bare">
                <template is="dom-if" if="{{!_isIndividual}}">
                  <li class="form-field">
                    <label for="contributor-company">Company’s Legal Name</label>
                    <input class="text-input" name="contributor-company" id="contributor-company" type="text"/>
                  </li>
                </template>
                <li class="form-field">
                  <label for="contributor-name">Your full legal name</label>
                  <input class="text-input" name="contributor-name" id="contributor-name" type="text"/>
                </li>
                <template is="dom-if" if="{{!_isIndividual}}">
                  <li class="form-field">
                    <label for="contributor-title">Your Title</label>
                    <input class="text-input" name="contributor-title" id="contributor-title" type="text"/>
                  </li>
                </template>
                <li class="form-field">
                  <label for="contributor-github">Your GitHub User Name</label>
                  <input class="text-input" readonly name="contributor-github" id="contributor-github" type="text" value="[[_github]]"/>
                </li>
                <li class="form-field">
                  <label for="contributor-email">Email address</label>
                  <input class="text-input" readonly name="contributor-email" id="contributor-email" type="email" value="[[_email]]"/>
                </li>
                <li class="form-field">
                  <label for="contributor-address">Physical Mailing Address</label>
                  <textarea name="contributor-address" id="contributor-address"></textarea>
                </li>
                <li class="form-field">
                  <label for="contributor-country">Country</label>
                  <input class="text-input" name="contributor-country" id="contributor-country" type="text"/>
                </li>
                <li class="form-field">
                  <label for="contributor-phone">Telephone number</label>
                  <input class="text-input" name="contributor-phone" id="contributor-phone" type="text" />
                </li>
                <li class="form-field">
                  <label for="contributor-date">Date</label>
                  <px-datetime-field tabindex="-1" name="contributor-date" style="pointer-events: none;" hide-time value="{{_signingDateString(_signingDate)}}" moment-obj="[[_signingDate]]"></px-datetime-field>
                </li>
              </ol>
            <!-- </template> -->
            <input class="btn" type="reset" value="Reset" on-tap="_clearData">
            <button class$="btn btn--primary {{_isDisabled(_hasData)}}" on-tap="_submitData">Sign Up</button>
          </fieldset>
        </form>
      </div>
    </div>
    <px-demo-footer></px-demo-footer>
  </template>
  <script>
    class DevCla extends Polymer.GestureEventListeners(Polymer.Element) {
      static get is() {return 'dev-cla';}
      static get properties() {
        return {
          _email:{
            type: String,
            value: ''
          },
          _github:{
            type: String,
            value: ''
          },
          _hasData:{
            type: Boolean,
            value: true
          },
          _firebaseApp:{
            type: Object,
            value: () => ({})
          },
          _signingDate:{
            type: Object,
            value: () => window.Px.moment()
          },
          _isIndividual:{
            type: Boolean,
            value: true
          }
        };
      }
      _signin(){
        // Initialize Firebase
        var config = {
          apiKey: 'AIzaSyDsENz1M-2W9zOEYuTIZUyL1GARGhT9afQ',
          authDomain: 'px-cla.firebaseapp.com',
          databaseURL: 'https://px-cla.firebaseio.com',
          projectId: 'px-cla',
          storageBucket: 'px-cla.appspot.com',
          messagingSenderId: '400881384782'
        };
        this._firebaseApp = firebase.initializeApp(config);
        var provider = new firebase.auth.GithubAuthProvider();

        this._firebaseApp
          .auth()
          .signInWithPopup(provider)
          .then(result => {
            // This gives you a GitHub Access Token. You can use it to access the GitHub API.
            var token = result.credential.accessToken;
            // The signed-in user info.
            var user = result.user;

            // this._contributor = user.displayName;
            // this._hasData = true;
            this._email = user.email;
            this._github = result.additionalUserInfo.username;
          })
          .catch(error => {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
          });
      }
      _clearData(){
        this._hasData = false;
      }
      _isDisabled(val){
        return val ? '' : 'btn--disabled';
      }
      _submitData(evt){
        evt.preventDefault(); //Prevent the default form submit action
        let formData = {};
        this.shadowRoot.querySelector('form').querySelectorAll('[name]').forEach(
          inputEl => {
            let attrName = inputEl.attributes.name.value;
            let key = attrName.substr(attrName.indexOf("-") + 1,  attrName.length);
            formData[key] = inputEl.value;
          }
        );
        this._firebaseApp.database().ref('users/' + this._github).set(formData);
      }
      _contributorTypeClicked(evt){
        evt = Polymer.dom(evt);
        this._isIndividual = (evt.localTarget.id === "individual");
      }
      _formLabel(){
        return this._isIndividual ? "Individual" : "Company";
      }
      _signingDateString(momentObj){
        return momentObj.toString();
      }
    }
    customElements.define(DevCla.is, DevCla);
  </script>
</dom-module>
